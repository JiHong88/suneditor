!function(e){var t={};function i(n){if(t[n])return t[n].exports;var l=t[n]={i:n,l:!1,exports:{}};return e[n].call(l.exports,l,l.exports,i),l.l=!0,l.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)i.d(n,l,function(t){return e[t]}.bind(null,l));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s="XJR1")}({"3FqI":function(e,t,i){},P6u4:function(e,t,i){"use strict";var n,l;n="undefined"!=typeof window?window:this,l=function(e,t){const i={toolbar:{default:"Default",save:"Save",font:"Font",formats:"Formats",fontSize:"Size",bold:"Bold",underline:"Underline",italic:"Italic",strike:"Strike",subscript:"Subscript",superscript:"Superscript",removeFormat:"Remove Format",fontColor:"Font Color",hiliteColor:"Highlight Color",indent:"Indent",outdent:"Outdent",align:"Align",alignLeft:"Align left",alignRight:"Align right",alignCenter:"Align center",alignJustify:"Align justify",list:"List",orderList:"Ordered list",unorderList:"Unordered list",horizontalRule:"Horizontal line",hr_solid:"Solid",hr_dotted:"Dotted",hr_dashed:"Dashed",table:"Table",link:"Link",math:"Math",image:"Image",video:"Video",fullScreen:"Full screen",showBlocks:"Show blocks",codeView:"Code view",undo:"Undo",redo:"Redo",preview:"Preview",print:"print",tag_p:"Paragraph",tag_div:"Normal (DIV)",tag_h:"Header",tag_blockquote:"Quote",tag_pre:"Code",template:"Template",lineHeight:"Line height",paragraphStyle:"Paragraph style",textStyle:"Text style"},dialogBox:{linkBox:{title:"Insert Link",url:"URL to link",text:"Text to display",newWindowCheck:"Open in new window"},mathBox:{title:"Math",inputLabel:"Mathematical Notation",fontSizeLabel:"Font Size",previewLabel:"Preview"},imageBox:{title:"Insert image",file:"Select from files",url:"Image URL",altText:"Alternative text"},videoBox:{title:"Insert Video",url:"Media embed URL, YouTube"},caption:"Insert description",close:"Close",submitButton:"Submit",revertButton:"Revert",proportion:"Constrain proportions",basic:"Basic",left:"Left",right:"Right",center:"Center",width:"Width",height:"Height",size:"Size",ratio:"Ratio"},controller:{edit:"Edit",unlink:"Unlink",remove:"Remove",insertRowAbove:"Insert row above",insertRowBelow:"Insert row below",deleteRow:"Delete row",insertColumnBefore:"Insert column before",insertColumnAfter:"Insert column after",deleteColumn:"Delete column",resize100:"Resize 100%",resize75:"Resize 75%",resize50:"Resize 50%",resize25:"Resize 25%",autoSize:"Auto size",mirrorHorizontal:"Mirror, Horizontal",mirrorVertical:"Mirror, Vertical",rotateLeft:"Rotate left",rotateRight:"Rotate right",maxSize:"Max size",minSize:"Min size",tableHeader:"Table header",mergeCells:"Merge cells",splitCells:"Split Cells",HorizontalSplit:"Horizontal split",VerticalSplit:"Vertical split"},menu:{spaced:"Spaced",bordered:"Bordered",neon:"Neon",translucent:"Translucent",shadow:"Shadow"}};return void 0===t&&(e.SUNEDITOR_LANG||(e.SUNEDITOR_LANG={}),e.SUNEDITOR_LANG.en=i),i},"object"==typeof e.exports?e.exports=n.document?l(n,!0):function(e){if(!e.document)throw new Error("SUNEDITOR_LANG a window with a document");return l(e)}:l(n)},WUQj:function(e,t,i){},XJR1:function(e,t,i){"use strict";i.r(t);i("3FqI"),i("WUQj");var n={name:"colorPicker",add:function(e){const t=e.context;t.colorPicker={colorListHTML:"",_colorInput:"",_defaultColor:"#000",_styleProperty:"color",_currentColor:"",_colorList:[]};let i=this.createColorList(e.context.option,e.lang,this._makeColorList);t.colorPicker.colorListHTML=i,i=null},createColorList:function(e,t,i){const n=e.colorList&&0!==e.colorList.length?e.colorList:["#ff0000","#ff5e00","#ffe400","#abf200","#00d8ff","#0055ff","#6600ff","#ff00dd","#000000","#ffd8d8","#fae0d4","#faf4c0","#e4f7ba","#d4f4fa","#d9e5ff","#e8d9ff","#ffd9fa","#f1f1f1","#ffa7a7","#ffc19e","#faed7d","#cef279","#b2ebf4","#b2ccff","#d1b2ff","#ffb2f5","#bdbdbd","#f15f5f","#f29661","#e5d85c","#bce55c","#5cd1e5","#6699ff","#a366ff","#f261df","#8c8c8c","#980000","#993800","#998a00","#6b9900","#008299","#003399","#3d0099","#990085","#353535","#670000","#662500","#665c00","#476600","#005766","#002266","#290066","#660058","#222222"];let l=[],s='<div class="se-list-inner">';for(let e,t=0,o=n.length;t<o;t++)e=n[t],e&&("string"==typeof e&&(l.push(e),t<o-1)||(l.length>0&&(s+='<div class="se-selector-color">'+i(l)+"</div>",l=[]),"object"==typeof e&&(s+='<div class="se-selector-color">'+i(e)+"</div>")));return s+='<form class="se-submenu-form-group"><input type="text" maxlength="7" class="_se_color_picker_input se-color-input"/><button type="submit" class="se-btn-primary se-tooltip _se_color_picker_submit"><i class="se-icon-checked"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+t.dialogBox.submitButton+'</span></span></button><button type="button" class="se-btn se-tooltip _se_color_picker_remove"><i class="se-icon-erase"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+t.toolbar.removeFormat+"</span></span></button></form></div>",s},_makeColorList:function(e){let t="";t+='<ul class="se-color-pallet">';for(let i,n=0,l=e.length;n<l;n++)i=e[n],"string"==typeof i&&(t+='<li><button type="button" data-value="'+i+'" title="'+i+'" style="background-color:'+i+';"></button></li>');return t+="</ul>",t},init:function(e,t){const i=this.plugins.colorPicker;let n=t||(i.getColorInNode.call(this,e)||this.context.colorPicker._defaultColor);n=i.isHexColor(n)?n:i.rgb2hex(n)||n;const l=this.context.colorPicker._colorList;if(l)for(let e=0,t=l.length;e<t;e++)n.toLowerCase()===l[e].getAttribute("data-value").toLowerCase()?this.util.addClass(l[e],"active"):this.util.removeClass(l[e],"active");i.setInputText.call(this,i.colorName2hex.call(this,n))},setCurrentColor:function(e){this.context.colorPicker._currentColor=e,this.context.colorPicker._colorInput.style.borderColor=e},setInputText:function(e){e=/^#/.test(e)?e:"#"+e,this.context.colorPicker._colorInput.value=e,this.plugins.colorPicker.setCurrentColor.call(this,e)},getColorInNode:function(e){let t="";const i=this.context.colorPicker._styleProperty;for(;e&&!this.util.isWysiwygDiv(e)&&0===t.length;)1===e.nodeType&&e.style[i]&&(t=e.style[i]),e=e.parentNode;return t},isHexColor:function(e){return/^#[0-9a-f]{3}(?:[0-9a-f]{3})?$/i.test(e)},rgb2hex:function(e){return(e=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===e.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):""},colorName2hex:function(e){if(/^#/.test(e))return e;var t=this.util.createElement("div");t.style.display="none",t.style.color=e;var i=this._w.getComputedStyle(this._d.body.appendChild(t)).color.match(/\d+/g).map((function(e){return parseInt(e,10)}));return this.util.removeItem(t),i.length>=3&&"#"+((1<<24)+(i[0]<<16)+(i[1]<<8)+i[2]).toString(16).substr(1)}},l={name:"dialog",add:function(e){const t=e.context;t.dialog={kind:"",updateModal:!1,_closeSignal:!1};let i=e.util.createElement("DIV");i.className="se-dialog sun-editor-common";let n=e.util.createElement("DIV");n.className="se-dialog-back",n.style.display="none";let l=e.util.createElement("DIV");l.className="se-dialog-inner",l.style.display="none",i.appendChild(n),i.appendChild(l),t.dialog.modalArea=i,t.dialog.back=n,t.dialog.modal=l,t.dialog.modal.addEventListener("mousedown",this.onMouseDown_dialog.bind(e)),t.dialog.modal.addEventListener("click",this.onClick_dialog.bind(e)),t.element.relative.appendChild(i),i=null,n=null,l=null},onMouseDown_dialog:function(e){/se-dialog-inner/.test(e.target.className)?this.context.dialog._closeSignal=!0:this.context.dialog._closeSignal=!1},onClick_dialog:function(e){e.stopPropagation(),(/close/.test(e.target.getAttribute("data-command"))||this.context.dialog._closeSignal)&&this.plugins.dialog.close.call(this)},open:function(e,t){if(this.modalForm)return!1;this.plugins.dialog._bindClose&&(this._d.removeEventListener("keydown",this.plugins.dialog._bindClose),this.plugins.dialog._bindClose=null),this.plugins.dialog._bindClose=function(e){/27/.test(e.keyCode)&&this.plugins.dialog.close.call(this)}.bind(this),this._d.addEventListener("keydown",this.plugins.dialog._bindClose),this.context.dialog.updateModal=t,"full"===this.context.option.popupDisplay?this.context.dialog.modalArea.style.position="fixed":this.context.dialog.modalArea.style.position="absolute",this.context.dialog.kind=e,this.modalForm=this.context[e].modal;const i=this.context[e].focusElement;"function"==typeof this.plugins[e].on&&this.plugins[e].on.call(this,t),this.context.dialog.modalArea.style.display="block",this.context.dialog.back.style.display="block",this.context.dialog.modal.style.display="block",this.modalForm.style.display="block",i&&i.focus()},_bindClose:null,close:function(){this.plugins.dialog._bindClose&&(this._d.removeEventListener("keydown",this.plugins.dialog._bindClose),this.plugins.dialog._bindClose=null);const e=this.context.dialog.kind;this.modalForm.style.display="none",this.context.dialog.back.style.display="none",this.context.dialog.modalArea.style.display="none",this.context.dialog.updateModal=!1,this.plugins[e].init.call(this),this.context.dialog.kind="",this.modalForm=null,this.focus()}},s={name:"resizing",add:function(e){const t=e.context;t.resizing={_resizeClientX:0,_resizeClientY:0,_resize_plugin:"",_resize_w:0,_resize_h:0,_origin_w:0,_origin_h:0,_rotateVertical:!1,_resize_direction:"",_move_path:null,_isChange:!1};let i=this.setController_resize.call(e);t.resizing.resizeContainer=i,t.resizing.resizeDiv=i.querySelector(".se-modal-resize"),t.resizing.resizeDot=i.querySelector(".se-resize-dot"),t.resizing.resizeDisplay=i.querySelector(".se-resize-display");let n=this.setController_button.call(e);t.resizing.resizeButton=n,n.addEventListener("mousedown",(function(e){e.stopPropagation()}),!1);let l=t.resizing.resizeHandles=t.resizing.resizeDot.querySelectorAll("span");t.resizing.resizeButtonGroup=n.querySelector("._se_resizing_btn_group"),t.resizing.rotationButtons=n.querySelectorAll("._se_resizing_btn_group ._se_rotation"),t.resizing.percentageButtons=n.querySelectorAll("._se_resizing_btn_group ._se_percentage"),t.resizing.alignMenu=n.querySelector(".se-resizing-align-list"),t.resizing.alignMenuList=t.resizing.alignMenu.querySelectorAll("button"),t.resizing.alignButton=n.querySelector("._se_resizing_align_button"),t.resizing.alignButtonIcon=t.resizing.alignButton.querySelector("i"),t.resizing.autoSizeButton=n.querySelector("._se_resizing_btn_group ._se_auto_size"),t.resizing.captionButton=n.querySelector("._se_resizing_caption_button"),l[0].addEventListener("mousedown",this.onMouseDown_resize_handle.bind(e)),l[1].addEventListener("mousedown",this.onMouseDown_resize_handle.bind(e)),l[2].addEventListener("mousedown",this.onMouseDown_resize_handle.bind(e)),l[3].addEventListener("mousedown",this.onMouseDown_resize_handle.bind(e)),l[4].addEventListener("mousedown",this.onMouseDown_resize_handle.bind(e)),l[5].addEventListener("mousedown",this.onMouseDown_resize_handle.bind(e)),l[6].addEventListener("mousedown",this.onMouseDown_resize_handle.bind(e)),l[7].addEventListener("mousedown",this.onMouseDown_resize_handle.bind(e)),n.addEventListener("click",this.onClick_resizeButton.bind(e)),t.element.relative.appendChild(i),t.element.relative.appendChild(n),i=null,n=null,l=null},setController_resize:function(){const e=this.util.createElement("DIV");return e.className="se-resizing-container",e.style.display="none",e.innerHTML='<div class="se-modal-resize"></div><div class="se-resize-dot"><span class="tl"></span><span class="tr"></span><span class="bl"></span><span class="br"></span><span class="lw"></span><span class="th"></span><span class="rw"></span><span class="bh"></span><div class="se-resize-display"></div></div>',e},setController_button:function(){const e=this.lang,t=this.util.createElement("DIV");return t.className="se-controller se-controller-resizing",t.innerHTML='<div class="se-arrow se-arrow-up"></div><div class="se-btn-group _se_resizing_btn_group"><button type="button" data-command="percent" data-value="1" class="se-tooltip _se_percentage"><span>100%</span><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.resize100+'</span></span></button><button type="button" data-command="percent" data-value="0.75" class="se-tooltip _se_percentage"><span>75%</span><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.resize75+'</span></span></button><button type="button" data-command="percent" data-value="0.5" class="se-tooltip _se_percentage"><span>50%</span><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.resize50+'</span></span></button><button type="button" data-command="auto" class="se-tooltip _se_auto_size"><i class="se-icon-auto-size"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.autoSize+'</span></span></button><button type="button" data-command="rotate" data-value="-90" class="se-tooltip _se_rotation"><i class="se-icon-rotate-left"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.rotateLeft+'</span></span></button><button type="button" data-command="rotate" data-value="90" class="se-tooltip _se_rotation"><i class="se-icon-rotate-right"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.rotateRight+'</span></span></button></div><div class="se-btn-group"><button type="button" data-command="mirror" data-value="h" class="se-tooltip"><i class="se-icon-mirror-horizontal"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.mirrorHorizontal+'</span></span></button><button type="button" data-command="mirror" data-value="v" class="se-tooltip"><i class="se-icon-mirror-vertical"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.mirrorVertical+'</span></span></button><button type="button" data-command="onalign" class="se-tooltip _se_resizing_align_button"><i class="se-icon-align-justify"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.toolbar.align+'</span></span></button><div class="se-btn-group-sub sun-editor-common se-list-layer se-resizing-align-list"><div class="se-list-inner"><ul class="se-list-basic"><li><button type="button" class="se-btn-list se-tooltip" data-command="align" data-value="basic"><i class="se-icon-align-justify"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.dialogBox.basic+'</span></span></button></li><li><button type="button" class="se-btn-list se-tooltip" data-command="align" data-value="left"><i class="se-icon-align-left"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.dialogBox.left+'</span></span></button></li><li><button type="button" class="se-btn-list se-tooltip" data-command="align" data-value="center"><i class="se-icon-align-center"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.dialogBox.center+'</span></span></button></li><li><button type="button" class="se-btn-list se-tooltip" data-command="align" data-value="right"><i class="se-icon-align-right"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.dialogBox.right+'</span></span></button></li></ul></div></div><button type="button" data-command="caption" class="se-tooltip _se_resizing_caption_button"><i class="se-icon-caption"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.dialogBox.caption+'</span></span></button><button type="button" data-command="revert" class="se-tooltip"><i class="se-icon-revert"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.dialogBox.revertButton+'</span></span></button><button type="button" data-command="update" class="se-tooltip"><i class="se-icon-modify"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.edit+'</span></span></button><button type="button" data-command="delete" class="se-tooltip"><i class="se-icon-delete"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.remove+"</span></span></button></div>",t},_module_getSizeX:function(e,t,i,n){return t||(t=e._element),i||(i=e._cover),n||(n=e._container),n&&i&&t?/%$/.test(t.style.width)?(this.util.getNumber(n.style.width,2)||100)+"%":t.style.width:""},_module_getSizeY:function(e,t,i,n){return t||(t=e._element),i||(i=e._cover),n||(n=e._container),n&&i&&t?this.util.getNumber(i.style.paddingBottom)>0&&!this.context.resizing._rotateVertical?i.style.height:/%$/.test(t.style.height)&&/%$/.test(t.style.width)?(this.util.getNumber(n.style.height,2)||100)+"%":t.style.height:""},_module_setModifyInputSize:function(e,t){const i=e._onlyPercentage&&this.context.resizing._rotateVertical;e.proportion.checked=e._proportionChecked="false"!==e._element.getAttribute("data-proportion");let n=i?"":this.plugins.resizing._module_getSizeX.call(this,e);if(n===e._defaultSizeX&&(n=""),e._onlyPercentage&&(n=this.util.getNumber(n,2)),e.inputX.value=n,t.setInputSize.call(this,"x"),!e._onlyPercentage){let t=i?"":this.plugins.resizing._module_getSizeY.call(this,e);t===e._defaultSizeY&&(t=""),e._onlyPercentage&&(t=this.util.getNumber(t,2)),e.inputY.value=t}e.inputX.disabled=!!i,e.inputY.disabled=!!i,e.proportion.disabled=!!i,t.setRatio.call(this)},_module_setInputSize:function(e,t){if(e._onlyPercentage)"x"===t&&e.inputX.value>100&&(e.inputX.value=100);else if(e.proportion.checked&&e._ratio&&/\d/.test(e.inputX.value)&&/\d/.test(e.inputY.value)){const i=e.inputX.value.replace(/\d+|\./g,"")||e.sizeUnit,n=e.inputY.value.replace(/\d+|\./g,"")||e.sizeUnit;if(i!==n)return;const l="%"===i?2:0;"x"===t?e.inputY.value=this.util.getNumber(e._ratioY*this.util.getNumber(e.inputX.value,l),l)+n:e.inputX.value=this.util.getNumber(e._ratioX*this.util.getNumber(e.inputY.value,l),l)+i}},_module_setRatio:function(e){const t=e.inputX.value,i=e.inputY.value;if(e.proportion.checked&&/\d+/.test(t)&&/\d+/.test(i)){if((t.replace(/\d+|\./g,"")||e.sizeUnit)!==(i.replace(/\d+|\./g,"")||e.sizeUnit))e._ratio=!1;else if(!e._ratio){const n=this.util.getNumber(t),l=this.util.getNumber(i);e._ratio=!0,e._ratioX=n/l,e._ratioY=l/n}}else e._ratio=!1},_module_sizeRevert:function(e){e._onlyPercentage?e.inputX.value=e._origin_w>100?100:e._origin_w:(e.inputX.value=e._origin_w,e.inputY.value=e._origin_h)},_module_saveCurrentSize:function(e){const t=this.plugins.resizing._module_getSizeX.call(this,e),i=this.plugins.resizing._module_getSizeY.call(this,e);e._element.setAttribute("data-size",t+","+i),e._videoRatio&&(e._videoRatio=i)},call_controller_resize:function(e,t){const i=this.context.resizing,n=this.context[t];i._resize_plugin=t;const l=i.resizeContainer,s=i.resizeDiv,o=this.util.getOffset(e,this.context.element.wysiwygFrame),a=i._rotateVertical=/^(90|270)$/.test(Math.abs(e.getAttribute("data-rotate")).toString()),r=a?e.offsetHeight:e.offsetWidth,c=a?e.offsetWidth:e.offsetHeight,d=o.top,u=o.left-this.context.element.wysiwygFrame.scrollLeft;l.style.top=d+"px",l.style.left=u+"px",l.style.width=r+"px",l.style.height=c+"px",s.style.top="0px",s.style.left="0px",s.style.width=r+"px",s.style.height=c+"px";let h=e.getAttribute("data-align")||"basic";h="none"===h?"basic":h;const p=this.util.getParentElement(e,this.util.isComponent),g=this.util.getParentElement(e,"FIGURE"),m=this.plugins.resizing._module_getSizeX.call(this,n,e,g,p)||"auto",f=n._onlyPercentage&&"image"===t?"":", "+(this.plugins.resizing._module_getSizeY.call(this,n,e,g,p)||"auto");this.util.changeTxt(i.resizeDisplay,this.lang.dialogBox[h]+" ("+m+f+")"),i.resizeButtonGroup.style.display=n._resizing?"":"none";const _=!n._resizing||n._resizeDotHide||n._onlyPercentage?"none":"flex",b=i.resizeHandles;for(let e=0,t=b.length;e<t;e++)b[e].style.display=_;if(n._resizing){const e=i.rotationButtons;e[0].style.display=e[1].style.display=n._rotation?"":"none"}const y=i.alignMenuList;this.util.removeClass(i.alignButtonIcon,"se-icon-align\\-[a-z]+"),this.util.addClass(i.alignButtonIcon,"se-icon-align-"+("basic"===h?"justify":h));for(let e=0,t=y.length;e<t;e++)y[e].getAttribute("data-value")===h?this.util.addClass(y[e],"on"):this.util.removeClass(y[e],"on");const v=i.percentageButtons,x=/%$/.test(e.style.width)&&/%$/.test(p.style.width)?this.util.getNumber(p.style.width)/100+"":"";for(let e=0,t=v.length;e<t;e++)v[e].getAttribute("data-value")===x?this.util.addClass(v[e],"active"):this.util.removeClass(v[e],"active");n._captionShow?(i.captionButton.style.display="",this.util.getChildElement(e.parentNode,"figcaption")?(this.util.addClass(i.captionButton,"active"),n._captionChecked=!0):(this.util.removeClass(i.captionButton,"active"),n._captionChecked=!1)):i.captionButton.style.display="none",this._resizingName=t,this.controllersOn(i.resizeContainer,i.resizeButton,t);const C=this.context.element.wysiwygFrame.offsetWidth-u-i.resizeButton.offsetWidth;i.resizeButton.style.top=c+d+60+"px",i.resizeButton.style.left=u+(C<0?C:0)+"px",i.resizeButton.firstElementChild.style.left=C<0?20-C+"px":"20px",i._resize_w=r,i._resize_h=c;const w=(e.getAttribute("origin-size")||"").split(",");return i._origin_w=w[0]||e.naturalWidth,i._origin_h=w[1]||e.naturalHeight,{w:r,h:c,t:d,l:u}},_closeAlignMenu:null,openAlignMenu:function(){this.util.addClass(this.context.resizing.alignButton,"on"),this.context.resizing.alignMenu.style.display="inline-table",this.plugins.resizing._closeAlignMenu=function(){this.util.removeClass(this.context.resizing.alignButton,"on"),this.context.resizing.alignMenu.style.display="none",this.removeDocEvent("mousedown",this.plugins.resizing._closeAlignMenu),this.plugins.resizing._closeAlignMenu=null}.bind(this),this.addDocEvent("mousedown",this.plugins.resizing._closeAlignMenu)},create_caption:function(){const e=this.util.createElement("FIGCAPTION");return e.setAttribute("contenteditable",!0),e.innerHTML="<div>"+this.lang.dialogBox.caption+"</div>",e},set_cover:function(e){const t=this.util.createElement("FIGURE");return t.appendChild(e),t},set_container:function(e,t){const i=this.util.createElement("DIV");return i.className="se-component "+t,i.setAttribute("contenteditable",!1),i.appendChild(e),i},onClick_resizeButton:function(e){e.stopPropagation();const t=e.target,i=t.getAttribute("data-command")||t.parentNode.getAttribute("data-command");if(!i)return;const n=t.getAttribute("data-value")||t.parentNode.getAttribute("data-value"),l=this.context.resizing._resize_plugin,s=this.context[l],o=s._element,a=this.plugins[l];if(e.preventDefault(),"function"!=typeof this.plugins.resizing._closeAlignMenu||(this.plugins.resizing._closeAlignMenu(),"onalign"!==i)){switch(i){case"auto":a.setAutoSize.call(this),a.onModifyMode.call(this,o,this.plugins.resizing.call_controller_resize.call(this,o,l));break;case"percent":let e=this.plugins.resizing._module_getSizeY.call(this,s);if(this.context.resizing._rotateVertical){const t=o.getAttribute("data-percentage");t&&(e=t.split(",")[1])}this.plugins.resizing.resetTransform.call(this,o),a.setPercentSize.call(this,100*n,e),a.onModifyMode.call(this,o,this.plugins.resizing.call_controller_resize.call(this,o,l));break;case"mirror":const t=o.getAttribute("data-rotate")||"0";let i=o.getAttribute("data-rotateX")||"",r=o.getAttribute("data-rotateY")||"";"h"===n&&!this.context.resizing._rotateVertical||"v"===n&&this.context.resizing._rotateVertical?r=r?"":"180":i=i?"":"180",o.setAttribute("data-rotateX",i),o.setAttribute("data-rotateY",r),this.plugins.resizing._setTransForm(o,t,i,r);break;case"rotate":const c=this.context.resizing,d=1*o.getAttribute("data-rotate")+1*n,u=this._w.Math.abs(d)>=360?0:d;o.setAttribute("data-rotate",u),c._rotateVertical=/^(90|270)$/.test(this._w.Math.abs(u).toString()),this.plugins.resizing.setTransformSize.call(this,o,null,null),a.onModifyMode.call(this,o,this.plugins.resizing.call_controller_resize.call(this,o,l));break;case"onalign":this.plugins.resizing.openAlignMenu.call(this);break;case"align":const h="basic"===n?"none":n;a.setAlign.call(this,h,null,null,null),a.onModifyMode.call(this,o,this.plugins.resizing.call_controller_resize.call(this,o,l));break;case"caption":const p=!s._captionChecked;if(a.openModify.call(this,!0),s._captionChecked=s.captionCheckEl.checked=p,"image"===l?a.update_image.call(this,!1,!1,!1):"video"===l&&(this.context.dialog.updateModal=!0,a.submitAction.call(this)),p){const e=this.util.getChildElement(s._caption,(function(e){return 3===e.nodeType}));e?this.setRange(e,0,e,e.textContent.length):s._caption.focus(),this.controllersOff()}else a.onModifyMode.call(this,o,this.plugins.resizing.call_controller_resize.call(this,o,l)),a.openModify.call(this,!0);break;case"revert":a.setOriginSize.call(this),a.onModifyMode.call(this,o,this.plugins.resizing.call_controller_resize.call(this,o,l));break;case"update":a.openModify.call(this),this.controllersOff();break;case"delete":a.destroy.call(this)}this.history.push(!1)}},resetTransform:function(e){const t=(e.getAttribute("data-size")||e.getAttribute("data-origin")||"").split(",");this.context.resizing._rotateVertical=!1,e.style.maxWidth="",e.style.transform="",e.style.transformOrigin="",e.setAttribute("data-rotate",""),e.setAttribute("data-rotateX",""),e.setAttribute("data-rotateY",""),this.plugins[this.context.resizing._resize_plugin].setSize.call(this,t[0]?t[0]:"auto",t[1]?t[1]:"",!0)},setTransformSize:function(e,t,i){let n=e.getAttribute("data-percentage");const l=this.context.resizing._rotateVertical,s=1*e.getAttribute("data-rotate");let o="";if(n&&!l)n=n.split(","),"auto"===n[0]&&"auto"===n[1]?this.plugins[this.context.resizing._resize_plugin].setAutoSize.call(this):this.plugins[this.context.resizing._resize_plugin].setPercentSize.call(this,n[0],n[1]);else{const n=this.util.getParentElement(e,"FIGURE"),a=t||e.offsetWidth,r=i||e.offsetHeight,c=(l?r:a)+"px",d=(l?a:r)+"px";if(this.plugins[this.context.resizing._resize_plugin].cancelPercentAttr.call(this),this.plugins[this.context.resizing._resize_plugin].setSize.call(this,a+"px",r+"px",!0),n.style.width=c,n.style.height=this.context[this.context.resizing._resize_plugin]._caption?"":d,l){let e=a/2+"px "+a/2+"px 0",t=r/2+"px "+r/2+"px 0";o=90===s||-270===s?t:e}}e.style.transformOrigin=o,this.plugins.resizing._setTransForm(e,s.toString(),e.getAttribute("data-rotateX")||"",e.getAttribute("data-rotateY")||""),e.style.maxWidth=l?"none":"",this.plugins.resizing.setCaptionPosition.call(this,e)},_setTransForm:function(e,t,i,n){let l=(e.offsetWidth-e.offsetHeight)*(/-/.test(t)?1:-1),s="";if(/[1-9]/.test(t)&&(i||n))switch(s=i?"Y":"X",t){case"90":s=i&&n?"X":n?s:"";break;case"270":l*=-1,s=i&&n?"Y":i?s:"";break;case"-90":s=i&&n?"Y":i?s:"";break;case"-270":l*=-1,s=i&&n?"X":n?s:"";break;default:s=""}t%180==0&&(e.style.maxWidth=""),e.style.transform="rotate("+t+"deg)"+(i?" rotateX("+i+"deg)":"")+(n?" rotateY("+n+"deg)":"")+(s?" translate"+s+"("+l+"px)":"")},setCaptionPosition:function(e){const t=this.util.getChildElement(this.util.getParentElement(e,"FIGURE"),"FIGCAPTION");t&&(t.style.marginTop=(this.context.resizing._rotateVertical?e.offsetWidth-e.offsetHeight:0)+"px")},onMouseDown_resize_handle:function(e){const t=this.context.resizing,i=t._resize_direction=e.target.classList[0];e.stopPropagation(),e.preventDefault();const n=this.context.resizing._resize_plugin,l=this.context[n]._element,s=this.plugins[n];t._resizeClientX=e.clientX,t._resizeClientY=e.clientY,this.context.element.resizeBackground.style.display="block",t.resizeButton.style.display="none",t.resizeDiv.style.float=/l/.test(i)?"right":/r/.test(i)?"left":"none";const o=function(e){if("keydown"===e.type&&27!==e.keyCode)return;const i=t._isChange;t._isChange=!1,this.removeDocEvent("mousemove",a),this.removeDocEvent("mouseup",o),this.removeDocEvent("keydown",o),"keydown"===e.type?(this.controllersOff(),this.context.element.resizeBackground.style.display="none",this.plugins[this.context.resizing._resize_plugin].init.call(this)):(this.plugins.resizing.cancel_controller_resize.call(this),i&&this.history.push(!1)),s.onModifyMode.call(this,l,this.plugins.resizing.call_controller_resize.call(this,l,t._resize_plugin))}.bind(this),a=this.plugins.resizing.resizing_element.bind(this,t,i,this.context[t._resize_plugin]);this.addDocEvent("mousemove",a),this.addDocEvent("mouseup",o),this.addDocEvent("keydown",o)},resizing_element:function(e,t,i,n){const l=n.clientX,s=n.clientY;let o=i._element_w,a=i._element_h;const r=i._element_w+(/r/.test(t)?l-e._resizeClientX:e._resizeClientX-l),c=i._element_h+(/b/.test(t)?s-e._resizeClientY:e._resizeClientY-s),d=i._element_h/i._element_w*r;/t/.test(t)&&(e.resizeDiv.style.top=i._element_h-(/h/.test(t)?c:d)+"px"),/l/.test(t)&&(e.resizeDiv.style.left=i._element_w-r+"px"),/r|l/.test(t)&&(e.resizeDiv.style.width=r+"px",o=r),/^(t|b)[^h]$/.test(t)?(e.resizeDiv.style.height=d+"px",a=d):/^(t|b)h$/.test(t)&&(e.resizeDiv.style.height=c+"px",a=c),e._resize_w=o,e._resize_h=a,this.util.changeTxt(e.resizeDisplay,this._w.Math.round(o)+" x "+this._w.Math.round(a)),e._isChange=!0},cancel_controller_resize:function(){const e=this.context.resizing._rotateVertical;this.controllersOff(),this.context.element.resizeBackground.style.display="none";let t=this._w.Math.round(e?this.context.resizing._resize_h:this.context.resizing._resize_w),i=this._w.Math.round(e?this.context.resizing._resize_w:this.context.resizing._resize_h);if(!e&&!/%$/.test(t)){const e=16,n=this.context.element.wysiwygFrame.clientWidth-2*e-2;this.util.getNumber(t)>n&&(i=this._w.Math.round(i/t*n),t=n)}this.plugins[this.context.resizing._resize_plugin].setSize.call(this,t,i,!1),this.plugins[this.context.resizing._resize_plugin].init.call(this)}},o={name:"notice",add:function(e){const t=e.context;t.notice={};let i=e.util.createElement("DIV"),n=e.util.createElement("SPAN"),l=e.util.createElement("BUTTON");i.className="se-notice",l.className="close",l.setAttribute("aria-label","Close"),l.setAttribute("title",e.lang.dialogBox.close),l.innerHTML='<i aria-hidden="true" data-command="close" class="se-icon-cancel"></i>',i.appendChild(n),i.appendChild(l),t.notice.modal=i,t.notice.message=n,l.addEventListener("click",this.onClick_cancel.bind(e)),t.element.relative.insertBefore(i,t.element.editorArea),i=null},onClick_cancel:function(e){e.preventDefault(),e.stopPropagation(),this.plugins.notice.close.call(this)},open:function(e){this.context.notice.message.textContent=e,this.context.notice.modal.style.display="block"},close:function(){this.context.notice.modal.style.display="none"}},a={blockquote:{name:"blockquote",display:"command",add:function(e,t){e.context.blockquote={targetButton:t,tag:e.util.createElement("BLOCKQUOTE")}},active:function(e){if(e){if(/blockquote/i.test(e.nodeName))return this.util.addClass(this.context.blockquote.targetButton,"active"),!0}else this.util.removeClass(this.context.blockquote.targetButton,"active");return!1},action:function(){const e=this.util.getParentElement(this.getSelectionNode(),"blockquote");e?this.detachRangeFormatElement(e,null,null,!1,!1):this.applyRangeFormatElement(this.context.blockquote.tag.cloneNode(!1))}},align:{name:"align",display:"submenu",add:function(e,t){const i=e.context;i.align={targetIcon:t.querySelector("i"),_alignList:null,currentAlign:""};let n=this.setSubmenu.call(e),l=n.querySelector("ul");l.addEventListener("click",this.pickup.bind(e)),i.align._alignList=l.querySelectorAll("li button"),t.parentNode.appendChild(n),n=null,l=null},setSubmenu:function(){const e=this.lang,t=this.util.createElement("DIV");return t.className="se-list-layer",t.innerHTML='<div class="se-submenu se-list-inner se-list-align"><ul class="se-list-basic"><li><button type="button" class="se-btn-list se-btn-align" data-command="justifyleft" data-value="left" title="'+e.toolbar.alignLeft+'"><span class="se-icon-align-left"></span>'+e.toolbar.alignLeft+'</button></li><li><button type="button" class="se-btn-list se-btn-align" data-command="justifycenter" data-value="center" title="'+e.toolbar.alignCenter+'"><span class="se-icon-align-center"></span>'+e.toolbar.alignCenter+'</button></li><li><button type="button" class="se-btn-list se-btn-align" data-command="justifyright" data-value="right" title="'+e.toolbar.alignRight+'"><span class="se-icon-align-right"></span>'+e.toolbar.alignRight+'</button></li><li><button type="button" class="se-btn-list se-btn-align" data-command="justifyfull" data-value="justify" title="'+e.toolbar.alignJustify+'"><span class="se-icon-align-justify"></span>'+e.toolbar.alignJustify+"</button></li></ul></div>",t},active:function(e){const t=this.context.align.targetIcon;if(e){if(this.util.isFormatElement(e)){const i=e.style.textAlign;return i&&(t.className="se-icon-align-"+i,t.setAttribute("data-focus",i)),!0}}else t.className="se-icon-align-left",t.removeAttribute("data-focus");return!1},on:function(){const e=this.context.align,t=e._alignList,i=e.targetIcon.getAttribute("data-focus")||"left";if(i!==e.currentAlign){for(let e=0,n=t.length;e<n;e++)i===t[e].getAttribute("data-value")?this.util.addClass(t[e],"active"):this.util.removeClass(t[e],"active");e.currentAlign=i}},pickup:function(e){e.preventDefault(),e.stopPropagation();let t=e.target,i=null;for(;!i&&!/UL/i.test(t.tagName);)i=t.getAttribute("data-value"),t=t.parentNode;if(!i)return;const n=this.getSelectedElements();for(let e=0,t=n.length;e<t;e++)this.util.setStyle(n[e],"textAlign","left"===i?"":i);this.submenuOff(),this.focus(),this.history.push(!1)}},font:{name:"font",display:"submenu",add:function(e,t){const i=e.context;i.font={targetText:t.querySelector(".txt"),targetTooltip:t.parentNode.querySelector(".se-tooltip-text"),_fontList:null,currentFont:""};let n=this.setSubmenu.call(e);n.querySelector(".se-list-font-family").addEventListener("click",this.pickup.bind(e)),i.font._fontList=n.querySelectorAll("ul li button"),t.parentNode.appendChild(n),n=null},setSubmenu:function(){const e=this.context.option,t=this.lang,i=this.util.createElement("DIV");let n,l,s,o;i.className="se-list-layer";let a=e.font?e.font:["Arial","Comic Sans MS","Courier New","Impact","Georgia","tahoma","Trebuchet MS","Verdana"],r='<div class="se-submenu se-list-inner se-list-font-family"><ul class="se-list-basic"><li><button type="button" class="default_value se-btn-list" title="'+t.toolbar.default+'">('+t.toolbar.default+")</button></li>";for(s=0,o=a.length;s<o;s++)n=a[s],l=n.split(",")[0],r+='<li><button type="button" class="se-btn-list" data-value="'+n+'" data-txt="'+l+'" title="'+l+'" style="font-family:'+n+';">'+l+"</button></li>";return r+="</ul></div>",i.innerHTML=r,i},active:function(e){const t=this.context.font.targetText,i=this.context.font.targetTooltip;if(e){if(e.style&&e.style.fontFamily.length>0){const n=e.style.fontFamily.replace(/["']/g,"");return this.util.changeTxt(t,n),this.util.changeTxt(i,n),!0}}else{const e=this.lang.toolbar.font;this.util.changeTxt(t,e),this.util.changeTxt(i,e)}return!1},on:function(){const e=this.context.font,t=e._fontList,i=e.targetText.textContent;if(i!==e.currentFont){for(let e=0,n=t.length;e<n;e++)i===t[e].getAttribute("data-value")?this.util.addClass(t[e],"active"):this.util.removeClass(t[e],"active");e.currentFont=i}},pickup:function(e){if(!/^BUTTON$/i.test(e.target.tagName))return!1;e.preventDefault(),e.stopPropagation();const t=e.target.getAttribute("data-value");if(t){const e=this.util.createElement("SPAN");e.style.fontFamily=t,this.nodeChange(e,["font-family"],null,null)}else this.nodeChange(null,["font-family"],["span"],!0);this.submenuOff()}},fontSize:{name:"fontSize",display:"submenu",add:function(e,t){const i=e.context;i.fontSize={targetText:t.querySelector(".txt"),_sizeList:null,currentSize:""};let n=this.setSubmenu.call(e),l=n.querySelector("ul");l.addEventListener("click",this.pickup.bind(e)),i.fontSize._sizeList=l.querySelectorAll("li button"),t.parentNode.appendChild(n),n=null,l=null},setSubmenu:function(){const e=this.context.option,t=this.lang,i=this.util.createElement("DIV");i.className="se-submenu se-list-layer";const n=e.fontSize?e.fontSize:[8,9,10,11,12,14,16,18,20,22,24,26,28,36,48,72];let l='<div class="se-list-inner se-list-font-size"><ul class="se-list-basic"><li><button type="button" class="default_value se-btn-list" title="'+t.toolbar.default+'">('+t.toolbar.default+")</button></li>";for(let t,i=0,s=e.fontSizeUnit,o=n.length;i<o;i++)t=n[i],l+='<li><button type="button" class="se-btn-list" data-value="'+t+s+'" title="'+t+s+'" style="font-size:'+t+s+';">'+t+"</button></li>";return l+="</ul></div>",i.innerHTML=l,i},active:function(e){if(e){if(e.style&&e.style.fontSize.length>0)return this.util.changeTxt(this.context.fontSize.targetText,e.style.fontSize),!0}else this.util.changeTxt(this.context.fontSize.targetText,this.lang.toolbar.fontSize);return!1},on:function(){const e=this.context.fontSize,t=e._sizeList,i=e.targetText.textContent;if(i!==e.currentSize){for(let e=0,n=t.length;e<n;e++)i===t[e].getAttribute("data-value")?this.util.addClass(t[e],"active"):this.util.removeClass(t[e],"active");e.currentSize=i}},pickup:function(e){if(!/^BUTTON$/i.test(e.target.tagName))return!1;e.preventDefault(),e.stopPropagation();const t=e.target.getAttribute("data-value");if(t){const e=this.util.createElement("SPAN");e.style.fontSize=t,this.nodeChange(e,["font-size"],null,null)}else this.nodeChange(null,["font-size"],["span"],!0);this.submenuOff()}},fontColor:{name:"fontColor",display:"submenu",add:function(e,t){e.addModule([n]);const i=e.context;i.fontColor={previewEl:null,colorInput:null,colorList:null};let l=this.setSubmenu.call(e);i.fontColor.colorInput=l.querySelector("._se_color_picker_input"),i.fontColor.colorInput.addEventListener("keyup",this.onChangeInput.bind(e)),l.querySelector("._se_color_picker_submit").addEventListener("click",this.submit.bind(e)),l.querySelector("._se_color_picker_remove").addEventListener("click",this.remove.bind(e)),l.addEventListener("click",this.pickup.bind(e)),i.fontColor.colorList=l.querySelectorAll("li button"),t.parentNode.appendChild(l),l=null},setSubmenu:function(){const e=this.context.colorPicker.colorListHTML,t=this.util.createElement("DIV");return t.className="se-submenu se-list-layer",t.innerHTML=e,t},on:function(){const e=this.context.colorPicker,t=this.context.fontColor;e._colorInput=t.colorInput,e._defaultColor="#333333",e._styleProperty="color",e._colorList=t.colorList,this.plugins.colorPicker.init.call(this,this.getSelectionNode(),null)},onChangeInput:function(e){this.plugins.colorPicker.setCurrentColor.call(this,e.target.value)},submit:function(){this.plugins.fontColor.applyColor.call(this,this.context.colorPicker._currentColor)},pickup:function(e){e.preventDefault(),e.stopPropagation(),this.plugins.fontColor.applyColor.call(this,e.target.getAttribute("data-value"))},remove:function(){this.nodeChange(null,["color"],["span"],!0),this.submenuOff()},applyColor:function(e){if(!e)return;const t=this.util.createElement("SPAN");t.style.color=e,this.nodeChange(t,["color"],null,null),this.submenuOff()}},hiliteColor:{name:"hiliteColor",display:"submenu",add:function(e,t){e.addModule([n]);const i=e.context;i.hiliteColor={previewEl:null,colorInput:null,colorList:null};let l=this.setSubmenu.call(e);i.hiliteColor.colorInput=l.querySelector("._se_color_picker_input"),i.hiliteColor.colorInput.addEventListener("keyup",this.onChangeInput.bind(e)),l.querySelector("._se_color_picker_submit").addEventListener("click",this.submit.bind(e)),l.querySelector("._se_color_picker_remove").addEventListener("click",this.remove.bind(e)),l.addEventListener("click",this.pickup.bind(e)),i.hiliteColor.colorList=l.querySelectorAll("li button"),t.parentNode.appendChild(l),l=null},setSubmenu:function(){const e=this.context.colorPicker.colorListHTML,t=this.util.createElement("DIV");return t.className="se-submenu se-list-layer",t.innerHTML=e,t},on:function(){const e=this.context.colorPicker,t=this.context.hiliteColor;e._colorInput=t.colorInput,e._defaultColor="#FFFFFF",e._styleProperty="backgroundColor",e._colorList=t.colorList,this.plugins.colorPicker.init.call(this,this.getSelectionNode(),null)},onChangeInput:function(e){this.plugins.colorPicker.setCurrentColor.call(this,e.target.value)},submit:function(){this.plugins.hiliteColor.applyColor.call(this,this.context.colorPicker._currentColor)},pickup:function(e){e.preventDefault(),e.stopPropagation(),this.plugins.hiliteColor.applyColor.call(this,e.target.getAttribute("data-value"))},remove:function(){this.nodeChange(null,["background-color"],["span"],!0),this.submenuOff()},applyColor:function(e){if(!e)return;const t=this.util.createElement("SPAN");t.style.backgroundColor=e,this.nodeChange(t,["background-color"],null,null),this.submenuOff()}},horizontalRule:{name:"horizontalRule",display:"submenu",add:function(e,t){let i=this.setSubmenu.call(e);i.querySelector("ul").addEventListener("click",this.horizontalRulePick.bind(e)),t.parentNode.appendChild(i),i=null},setSubmenu:function(){const e=this.lang,t=this.util.createElement("DIV");return t.className="se-submenu se-list-layer",t.innerHTML='<div class="se-list-inner se-list-line"><ul class="se-list-basic"><li><button type="button" class="se-btn-list btn_line se-tooltip" data-command="horizontalRule" data-value="solid"><hr style="border-width: 1px 0 0; border-style: solid none none; border-color: black; border-image: initial; height: 1px;" /><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.toolbar.hr_solid+'</span></span></button></li><li><button type="button" class="se-btn-list btn_line se-tooltip" data-command="horizontalRule" data-value="dotted"><hr style="border-width: 1px 0 0; border-style: dotted none none; border-color: black; border-image: initial; height: 1px;" /><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.toolbar.hr_dotted+'</span></span></button></li><li><button type="button" class="se-btn-list btn_line se-tooltip" data-command="horizontalRule" data-value="dashed"><hr style="border-width: 1px 0 0; border-style: dashed none none; border-color: black; border-image: initial; height: 1px;" /><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.toolbar.hr_dashed+"</span></span></button></li></ul></div>",t},appendHr:function(e){const t=this.util.createElement("HR");t.className=e,this.focus();let i=this.insertComponent(t,!1);this.setRange(i,0,i,0)},horizontalRulePick:function(e){e.preventDefault(),e.stopPropagation();let t=e.target,i=null;for(;!i&&!/UL/i.test(t.tagName);)i=t.getAttribute("data-value"),t=t.parentNode;i&&(this.plugins.horizontalRule.appendHr.call(this,"__se__"+i),this.submenuOff())}},list:{name:"list",display:"submenu",add:function(e,t){const i=e.context;i.list={targetButton:t,targetIcon:t.querySelector("i"),_list:null,currentList:""};let n=this.setSubmenu.call(e),l=n.querySelector("ul");l.addEventListener("click",this.pickup.bind(e)),i.list._list=l.querySelectorAll("li button"),t.parentNode.appendChild(n),n=null,l=null},setSubmenu:function(){const e=this.lang,t=this.util.createElement("DIV");return t.className="se-submenu se-list-layer",t.innerHTML='<div class="se-list-inner"><ul class="se-list-basic"><li><button type="button" class="se-btn-list se-tooltip" data-command="OL"><i class="se-icon-list-number"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.toolbar.orderList+'</span></span></button></li><li><button type="button" class="se-btn-list se-tooltip" data-command="UL"><i class="se-icon-list-bullets"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.toolbar.unorderList+"</span></span></button></li></ul></div>",t},active:function(e){const t=this.context.list.targetButton,i=this.context.list.targetIcon,n=this.util;if(e){if(n.isList(e)){const l=e.nodeName;return t.setAttribute("data-focus",l),n.addClass(t,"active"),/UL/i.test(l)?(n.removeClass(i,"se-icon-list-number"),n.addClass(i,"se-icon-list-bullets")):(n.removeClass(i,"se-icon-list-bullets"),n.addClass(i,"se-icon-list-number")),!0}}else t.removeAttribute("data-focus"),n.removeClass(i,"se-icon-list-bullets"),n.addClass(i,"se-icon-list-number"),n.removeClass(t,"active");return!1},on:function(){const e=this.context.list,t=e._list,i=e.targetButton.getAttribute("data-focus")||"";if(i!==e.currentList){for(let e=0,n=t.length;e<n;e++)i===t[e].getAttribute("data-command")?this.util.addClass(t[e],"active"):this.util.removeClass(t[e],"active");e.currentList=i}},editList:function(e,t,i){const n=t||this.getSelectedElementsAndComponents(!1);if(!n||0===n.length)return;const l=this.util;l.sortByDepth(n,!0);let s=!0,o=null,a=null,r=n[0],c=n[n.length-1],d=!l.isListCell(r)&&!l.isComponent(r)||r.previousElementSibling?r.previousElementSibling:r.parentNode.previousElementSibling,u=!l.isListCell(c)&&!l.isComponent(c)||c.nextElementSibling?c.nextElementSibling:c.parentNode.nextElementSibling;for(let e=0,t=n.length;e<t;e++)if(!l.isList(l.getRangeFormatElement(n[e],function(t){return this.getRangeFormatElement(t)&&t!==n[e]}.bind(l)))){s=!1;break}if(!s||d&&r.tagName===d.tagName&&e===d.tagName.toUpperCase()||u&&c.tagName===u.tagName&&e===u.tagName.toUpperCase()){const t=d?d.parentNode:d,i=u?u.parentNode:u;d=t&&!l.isWysiwygDiv(t)&&t.nodeName===e?t:d,u=i&&!l.isWysiwygDiv(i)&&i.nodeName===e?i:u;const s=d&&d.tagName===e,r=u&&u.tagName===e;let c=s?d:l.createElement(e),h=null,p=null,g=null,m=null;const f=function(e){return!this.isComponent(e)&&!this.isList(e)}.bind(l);for(let t,i,o,a,r,d,u,m,_,b=0,y=n.length;b<y;b++)if(i=n[b],0!==i.childNodes.length||l._isIgnoreNodeChange(i)){if(a=n[b+1],r=i.parentNode,d=a?a.parentNode:null,o=l.isListCell(i),_=l.isRangeFormatElement(r)?r:null,u=o&&!l.isWysiwygDiv(r)?r.parentNode:r,m=o&&!l.isWysiwygDiv(r)?a?r.nextSibling:r:i.nextSibling,t=l.createElement("LI"),l.copyFormatAttributes(t,i),l.isComponent(i)){const e=/^HR$/i.test(i.nodeName);e||(t.innerHTML="<br>"),t.innerHTML+=i.outerHTML,e&&(t.innerHTML+="<br>")}else{const e=i.childNodes;for(;e[0];)t.appendChild(e[0])}c.appendChild(t),a||(p=c),a&&u===d&&!l.isRangeFormatElement(m)||(h||(h=c),s&&a&&u===d||a&&l.isList(d)&&d===r||c.parentNode!==u&&u.insertBefore(c,m)),l.removeItem(i),s&&null===g&&(g=c.children.length-1),a&&l.getRangeFormatElement(d,f)!==l.getRangeFormatElement(r,f)&&(c=l.createElement(e)),_&&0===_.children.length&&l.removeItem(_)}else l.removeItem(i);g&&(h=h.children[g]),r&&(m=c.children.length-1,c.innerHTML+=u.innerHTML,p=c.children[m],l.removeItem(u)),o=a=l.getEdgeChildNodes(h.firstChild,p.lastChild)}else{if(i)for(let e=0,t=n.length;e<t;e++)for(let i=e-1;i>=0;i--)if(n[i].contains(n[e])){n.splice(e,1),e--,t--;break}const t=l.getRangeFormatElement(r),s=t&&t.tagName===e;let c,d,u;const h=function(e){return!this.isComponent(e)}.bind(l);s||(d=l.createElement(e));for(let t,r,p=0,g=n.length;p<g;p++)r=l.getRangeFormatElement(n[p],h),r&&l.isList(r)&&(t?t!==r?(u=i&&l.isListCell(r.parentNode)?this.plugins.list._detachNested.call(this,c.f):this.detachRangeFormatElement(c.f[0].parentNode,c.f,d,!1,!0),r=n[p].parentNode,o||(o=u),s||(d=l.createElement(e)),t=r,c={r:t,f:[l.getParentElement(n[p],"LI")]}):c.f.push(l.getParentElement(n[p],"LI")):(t=r,c={r:t,f:[l.getParentElement(n[p],"LI")]}),p===g-1&&(a=i&&l.isListCell(r.parentNode)?this.plugins.list._detachNested.call(this,c.f):this.detachRangeFormatElement(c.f[0].parentNode,c.f,d,!1,!0),o||(o=a)))}return{sc:o.sc,so:0,ec:a.ec,eo:a.ec.textContent.length}},_detachNested:function(e){const t=e[0],i=e[e.length-1],n=i.nextElementSibling,l=t.parentNode,s=l.parentNode.nextElementSibling,o=l.parentNode.parentNode;for(let t=0,i=e.length;t<i;t++)o.insertBefore(e[t],s);if(n&&l.children.length>0){const e=l.cloneNode(!1),t=l.childNodes,s=this.util.getPositionIndex(n);for(;t[s];)e.appendChild(t[s]);i.appendChild(e)}0===l.children.length&&this.util.removeItem(l);const a=this.util.getEdgeChildNodes(t,i);return{cc:t.parentNode,sc:a.sc,ec:a.ec}},editInsideList:function(e,t){const i=(t=t||this.getSelectedElements().filter(function(e){return this.isListCell(e)}.bind(this.util))).length;if(0===i||!e&&!this.util.isListCell(t[0].previousElementSibling)&&!this.util.isListCell(t[i-1].nextElementSibling))return{sc:t[0],so:0,ec:t[i-1],eo:1};let n=t[0].parentNode,l=t[i-1],s=null;if(e){if(n!==l.parentNode&&this.util.isList(l.parentNode.parentNode)&&l.nextElementSibling)for(l=l.nextElementSibling;l;)t.push(l),l=l.nextElementSibling;s=this.plugins.list.editList.call(this,n.nodeName.toUpperCase(),t,!0)}else{s={sc:t[0],so:i>1||!this.getRange().collapsed?0:1,ec:l,eo:1};let e=this.util.createElement(n.nodeName),o=s.sc.previousElementSibling,a=s.sc.nextElementSibling;for(let l,s=0,r=i;s<r;s++)l=t[s],l.parentNode!==n&&(this.plugins.list._insiedList.call(this,n,e,o,a),n=l.parentNode,e=this.util.createElement(n.nodeName)),o=l.previousElementSibling,a=l.nextElementSibling,e.appendChild(l);e=this.plugins.list._insiedList.call(this,n,e,o,a)}return s},_insiedList:function(e,t,i,n){let l=!1;if(i&&t.tagName===i.tagName){const e=t.children;for(;e[0];)i.appendChild(e[0]);t=i,l=!0}if(n&&t.tagName===n.tagName){const e=n.children;for(;e[0];)t.appendChild(e[0]);const i=n.nextElementSibling;n.parentNode.removeChild(n),n=i}return l||(this.util.isListCell(i)&&(e=i,n=null),e.insertBefore(t,n),this.util.mergeSameTags(e,null,null,!1),this.util.mergeNestedTags(e)),t},pickup:function(e){e.preventDefault(),e.stopPropagation();let t=e.target,i="";for(;!i&&!/^UL$/i.test(t.tagName);)i=t.getAttribute("data-command"),t=t.parentNode;if(!i)return;const n=this.plugins.list.editList.call(this,i,null,!1);this.setRange(n.sc,n.so,n.ec,n.eo),this.submenuOff(),this.history.push(!1)}},table:{name:"table",display:"submenu",add:function(e,t){const i=e.context;i.table={_element:null,_tdElement:null,_trElement:null,_trElements:null,_tableXY:[],_maxWidth:!0,resizeIcon:null,resizeText:null,headerButton:null,mergeButton:null,splitButton:null,splitMenu:null,maxText:e.lang.controller.maxSize,minText:e.lang.controller.minSize,_physical_cellCnt:0,_logical_cellCnt:0,_rowCnt:0,_rowIndex:0,_physical_cellIndex:0,_logical_cellIndex:0,_current_colSpan:0,_current_rowSpan:0};let n=this.setSubmenu.call(e),l=n.querySelector(".se-controller-table-picker");i.table.tableHighlight=n.querySelector(".se-table-size-highlighted"),i.table.tableUnHighlight=n.querySelector(".se-table-size-unhighlighted"),i.table.tableDisplay=n.querySelector(".se-table-size-display");let s=this.setController_table.call(e);i.table.tableController=s,i.table.resizeIcon=s.querySelector("._se_table_resize > i"),i.table.resizeText=s.querySelector("._se_table_resize > span > span"),i.table.headerButton=s.querySelector("._se_table_header"),s.addEventListener("mousedown",(function(e){e.stopPropagation()}),!1);let o=this.setController_tableEditor.call(e);i.table.resizeDiv=o,i.table.splitMenu=o.querySelector(".se-btn-group-sub"),i.table.mergeButton=o.querySelector("._se_table_merge_button"),i.table.splitButton=o.querySelector("._se_table_split_button"),o.addEventListener("mousedown",(function(e){e.stopPropagation()}),!1),l.addEventListener("mousemove",this.onMouseMove_tablePicker.bind(e)),l.addEventListener("click",this.appendTable.bind(e)),o.addEventListener("click",this.onClick_tableController.bind(e)),s.addEventListener("click",this.onClick_tableController.bind(e)),t.parentNode.appendChild(n),i.element.relative.appendChild(o),i.element.relative.appendChild(s),n=null,l=null,o=null,s=null},setSubmenu:function(){const e=this.util.createElement("DIV");return e.className="se-submenu se-selector-table",e.innerHTML='<div class="se-table-size"><div class="se-table-size-picker se-controller-table-picker"></div><div class="se-table-size-highlighted"></div><div class="se-table-size-unhighlighted"></div></div><div class="se-table-size-display">1 x 1</div>',e},setController_table:function(){const e=this.lang,t=this.util.createElement("DIV");return t.className="se-controller se-controller-table",t.innerHTML='<div><div class="se-btn-group"><button type="button" data-command="resize" class="se-tooltip _se_table_resize"><i class="se-icon-expansion"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.maxSize+'</span></span></button><button type="button" data-command="header" class="se-tooltip _se_table_header"><i class="se-icon-table-header"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.tableHeader+'</span></span></button><button type="button" data-command="remove" class="se-tooltip"><i class="se-icon-delete"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.remove+"</span></span></button></div></div>",t},setController_tableEditor:function(){const e=this.lang,t=this.util.createElement("DIV");return t.className="se-controller se-controller-table-cell",t.innerHTML='<div class="se-arrow se-arrow-up"></div><div><div class="se-btn-group"><button type="button" data-command="insert" data-value="row" data-option="up" class="se-tooltip"><i class="se-icon-insert-row-above"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.insertRowAbove+'</span></span></button><button type="button" data-command="insert" data-value="row" data-option="down" class="se-tooltip"><i class="se-icon-insert-row-below"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.insertRowBelow+'</span></span></button><button type="button" data-command="delete" data-value="row" class="se-tooltip"><i class="se-icon-delete-row"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.deleteRow+'</span></span></button><button type="button" data-command="merge" class="_se_table_merge_button se-tooltip" disabled><i class="se-icon-merge-cell"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.mergeCells+'</span></span></button></div></div><div><div class="se-btn-group"><button type="button" data-command="insert" data-value="cell" data-option="left" class="se-tooltip"><i class="se-icon-insert-column-left"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.insertColumnBefore+'</span></span></button><button type="button" data-command="insert" data-value="cell" data-option="right" class="se-tooltip"><i class="se-icon-insert-column-right"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.insertColumnAfter+'</span></span></button><button type="button" data-command="delete" data-value="cell" class="se-tooltip"><i class="se-icon-delete-column"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.deleteColumn+'</span></span></button><button type="button" data-command="onsplit" class="_se_table_split_button se-tooltip"><i class="se-icon-split-cell"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.splitCells+'</span></span></button><div class="se-btn-group-sub sun-editor-common se-list-layer"><div class="se-list-inner"><ul class="se-list-basic"><li class="se-btn-list" data-command="split" data-value="vertical" style="line-height:32px;" title="'+e.controller.VerticalSplit+'">'+e.controller.VerticalSplit+'</li><li class="se-btn-list" data-command="split" data-value="horizontal" style="line-height:32px;" title="'+e.controller.HorizontalSplit+'">'+e.controller.HorizontalSplit+"</li></ul></div></div></div></div>",t},appendTable:function(){const e=this.util.createElement("TABLE"),t=this.plugins.table.createCells,i=this.context.table._tableXY[0];let n=this.context.table._tableXY[1],l="<tbody>";for(;n>0;)l+="<tr>"+t.call(this,"td",i)+"</tr>",--n;l+="</tbody>",e.innerHTML=l,this.insertComponent(e,!1);const s=e.querySelector("td div");this.setRange(s,0,s,0),this.plugins.table.reset_table_picker.call(this)},createCells:function(e,t,i){if(e=e.toLowerCase(),i){const t=this.util.createElement(e);return t.innerHTML="<div><br></div>",t}{let i="";for(;t>0;)i+="<"+e+"><div><br></div></"+e+">",t--;return i}},onMouseMove_tablePicker:function(e){e.stopPropagation();let t=this._w.Math.ceil(e.offsetX/18),i=this._w.Math.ceil(e.offsetY/18);t=t<1?1:t,i=i<1?1:i,this.context.table.tableHighlight.style.width=t+"em",this.context.table.tableHighlight.style.height=i+"em";let n=t<5?5:t>9?10:t+1,l=i<5?5:i>9?10:i+1;this.context.table.tableUnHighlight.style.width=n+"em",this.context.table.tableUnHighlight.style.height=l+"em",this.util.changeTxt(this.context.table.tableDisplay,t+" x "+i),this.context.table._tableXY=[t,i]},reset_table_picker:function(){if(!this.context.table.tableHighlight)return;const e=this.context.table.tableHighlight.style,t=this.context.table.tableUnHighlight.style;e.width="1em",e.height="1em",t.width="5em",t.height="5em",this.util.changeTxt(this.context.table.tableDisplay,"1 x 1"),this.submenuOff()},init:function(){const e=this.context.table,t=this.plugins.table;if(t._removeEvents.call(this),t._selectedTable){const e=t._selectedTable.querySelectorAll(".se-table-selected-cell");for(let t=0,i=e.length;t<i;t++)this.util.removeClass(e[t],"se-table-selected-cell")}t._toggleEditor.call(this,!0),e._element=null,e._tdElement=null,e._trElement=null,e._trElements=null,e._tableXY=[],e._maxWidth=!0,e._physical_cellCnt=0,e._logical_cellCnt=0,e._rowCnt=0,e._rowIndex=0,e._physical_cellIndex=0,e._logical_cellIndex=0,e._current_colSpan=0,e._current_rowSpan=0,t._shift=!1,t._selectedCells=null,t._selectedTable=null,t._ref=null,t._fixedCell=null,t._selectedCell=null,t._fixedCellName=null},call_controller_tableEdit:function(e){if(!this.getSelection().isCollapsed)return this.controllersOff(),void this.util.removeClass(e,"se-table-selected-cell");const t=this.context.table,i=this.plugins.table,n=t.tableController;i.setPositionControllerDiv.call(this,e,i._shift);const l=t._element,s=this.util.getOffset(l,this.context.element.wysiwygFrame);t._maxWidth=!l.style.width||"100%"===l.style.width,i.resizeTable.call(this),n.style.left=s.left+"px",n.style.display="block",n.style.top=s.top-n.offsetHeight-2+"px",i._shift||this.controllersOn(t.resizeDiv,n,i.init.bind(this),"table")},setPositionControllerDiv:function(e,t){const i=this.context.table.resizeDiv;this.plugins.table.setCellInfo.call(this,e,t),i.style.display="block";const n=this.util.getOffset(e,this.context.element.wysiwygFrame);i.style.left=n.left-this.context.element.wysiwygFrame.scrollLeft+"px",i.style.top=n.top+e.offsetHeight+12+"px";const l=this.context.element.wysiwygFrame.offsetWidth-(i.offsetLeft+i.offsetWidth);l<0?(i.style.left=i.offsetLeft+l+"px",i.firstElementChild.style.left=20-l+"px"):i.firstElementChild.style.left="20px"},setCellInfo:function(e,t){const i=this.context.table,n=i._element=this.plugins.table._selectedTable||this.util.getParentElement(e,"TABLE");if(/THEAD/i.test(n.firstElementChild.nodeName)?this.util.addClass(i.headerButton,"active"):this.util.removeClass(i.headerButton,"active"),t||0===i._physical_cellCnt){i._tdElement!==e&&(i._tdElement=e,i._trElement=e.parentNode);const t=i._trElements=n.rows,l=e.cellIndex;let s=0;for(let e=0,i=t[0].cells,n=t[0].cells.length;e<n;e++)s+=i[e].colSpan;const o=i._rowIndex=i._trElement.rowIndex;i._rowCnt=t.length,i._physical_cellCnt=i._trElement.cells.length,i._logical_cellCnt=s,i._physical_cellIndex=l,i._current_colSpan=i._tdElement.colSpan-1,i._current_rowSpan,i._trElement.cells[l].rowSpan;let a=[],r=[];for(let e,n,s=0;s<=o;s++){e=t[s].cells,n=0;for(let t,c,d,u,h=0,p=e.length;h<p;h++){if(t=e[h],c=t.colSpan-1,d=t.rowSpan-1,u=h+n,r.length>0)for(let e,t=0;t<r.length;t++)e=r[t],e.row>s||(u>=e.index?(n+=e.cs,u+=e.cs,e.rs-=1,e.row=s+1,e.rs<1&&(r.splice(t,1),t--)):h===p-1&&(e.rs-=1,e.row=s+1,e.rs<1&&(r.splice(t,1),t--)));if(s===o&&h===l){i._logical_cellIndex=u;break}d>0&&a.push({index:u,cs:c+1,rs:d,row:-1}),n+=c}r=r.concat(a).sort((function(e,t){return e.index-t.index})),a=[]}a=null,r=null}},editTable:function(e,t){const i=this.plugins.table,n=this.context.table,l=n._element,s="row"===e;if(s){const e=n._trElement.parentNode;if(/^THEAD$/i.test(e.nodeName)){if("up"===t)return;if(!e.nextElementSibling||!/^TBODY$/i.test(e.nextElementSibling.nodeName))return void(l.innerHTML+="<tbody><tr>"+i.createCells.call(this,"td",n._logical_cellCnt,!1)+"</tr></tbody>")}}if(i._ref){const e=n._tdElement,l=i._selectedCells;if(s)if(t)i.setCellInfo.call(this,"up"===t?l[0]:l[l.length-1],!0),i.editRow.call(this,t,e);else{let e=l[0].parentNode;const n=[l[0]];for(let t,i=1,s=l.length;i<s;i++)t=l[i],e!==t.parentNode&&(n.push(t),e=t.parentNode);for(let e=0,l=n.length;e<l;e++)i.setCellInfo.call(this,n[e],!0),i.editRow.call(this,t)}else{const n=l[0].parentNode;if(t){let s=null;for(let e=0,t=l.length-1;e<t;e++)if(n!==l[e+1].parentNode){s=l[e];break}i.setCellInfo.call(this,"left"===t?l[0]:s||l[0],!0),i.editCell.call(this,t,e)}else{const e=[l[0]];for(let t,i=1,s=l.length;i<s&&(t=l[i],n===t.parentNode);i++)e.push(t);for(let n=0,l=e.length;n<l;n++)i.setCellInfo.call(this,e[n],!0),i.editCell.call(this,t)}}t||i.init.call(this)}else i[s?"editRow":"editCell"].call(this,t);if(!t){const e=l.children;for(let t=0;t<e.length;t++)0===e[t].children.length&&(this.util.removeItem(e[t]),t--);0===l.children.length&&this.util.removeItem(l)}},editRow:function(e,t){const i=this.context.table,n=!e,l="up"===e,s=i._rowIndex,o=n||l?s:s+i._current_rowSpan+1,a=n?-1:1,r=i._trElements;let c=i._logical_cellCnt;for(let e,t=0,i=s+(n?-1:0);t<=i;t++){if(e=r[t].cells,0===e.length)return;for(let i,n,l=0,s=e.length;l<s;l++)i=e[l].rowSpan,n=e[l].colSpan,i<2&&n<2||i+t>o&&o>t&&(e[l].rowSpan=i+a,c-=n)}if(n){const e=r[s+1];if(e){const t=[];let i=r[s].cells,n=0;for(let e,l,s=0,o=i.length;s<o;s++)e=i[s],l=s+n,n+=e.colSpan-1,e.rowSpan>1&&(e.rowSpan-=1,t.push({cell:e.cloneNode(!1),index:l}));if(t.length>0){let l=t.shift();i=e.cells,n=0;for(let s,o,a=0,r=i.length;a<r&&(s=i[a],o=a+n,n+=s.colSpan-1,!(o>=l.index)||(a--,n--,n+=l.cell.colSpan-1,e.insertBefore(l.cell,s),l=t.shift(),l));a++);if(l){e.appendChild(l.cell);for(let i=0,n=t.length;i<n;i++)e.appendChild(t[i].cell)}}}i._element.deleteRow(o)}else{i._element.insertRow(o).innerHTML=this.plugins.table.createCells.call(this,"td",c,!1)}n?this.controllersOff():this.plugins.table.setPositionControllerDiv.call(this,t||i._tdElement,!0)},editCell:function(e,t){const i=this.context.table,n=this.util,l=!e,s="left"===e,o=i._current_colSpan,a=l||s?i._logical_cellIndex:i._logical_cellIndex+o+1,r=i._trElements;let c=[],d=[],u=0;const h=[],p=[];for(let e,t,s,g,m,f,_=0,b=i._rowCnt;_<b;_++){e=r[_],t=a,m=!1,s=e.cells,f=0;for(let e,i,r,g,b=0,y=s.length;b<y&&(e=s[b],e);b++)if(i=e.rowSpan-1,r=e.colSpan-1,l){if(g=b+f,d.length>0){const e=!s[b+1];for(let t,i=0;i<d.length;i++)t=d[i],t.row>_||(g>=t.index?(f+=t.cs,g=b+f,t.rs-=1,t.row=_+1,t.rs<1&&(d.splice(i,1),i--)):e&&(t.rs-=1,t.row=_+1,t.rs<1&&(d.splice(i,1),i--)))}i>0&&c.push({rs:i,cs:r+1,index:g,row:-1}),g>=t&&g+r<=t+o?h.push(e):g<=t+o&&g+r>=t?e.colSpan-=n.getOverlapRangeAtIndex(a,a+o,g,g+r):i>0&&(g<t||g+r>t+o)&&p.push({cell:e,i:_,rs:_+i}),f+=r}else{if(b>=t)break;if(r>0){if(u<1&&r+b>=t){e.colSpan+=1,t=null,u=i+1;break}t-=r}if(!m){for(let e,i=0;i<d.length;i++)e=d[i],t-=e.cs,e.rs-=1,e.rs<1&&(d.splice(i,1),i--);m=!0}}if(d=d.concat(c).sort((function(e,t){return e.index-t.index})),c=[],!l){if(u>0){u-=1;continue}null!==t&&s.length>0&&(g=this.plugins.table.createCells.call(this,s[0].nodeName,0,!0),g=e.insertBefore(g,s[t]))}}if(l){let e,t;for(let i,l=0,s=h.length;l<s;l++)i=h[l].parentNode,n.removeItem(h[l]),0===i.cells.length&&(e||(e=n.getArrayIndex(r,i)),t=n.getArrayIndex(r,i),n.removeItem(i));for(let i,l=0,s=p.length;l<s;l++)i=p[l],i.cell.rowSpan=n.getOverlapRangeAtIndex(e,t,i.i,i.rs);this.controllersOff()}else this.plugins.table.setPositionControllerDiv.call(this,t||i._tdElement,!0)},_closeSplitMenu:null,openSplitMenu:function(){this.util.addClass(this.context.table.splitButton,"on"),this.context.table.splitMenu.style.display="inline-table",this.plugins.table._closeSplitMenu=function(){this.util.removeClass(this.context.table.splitButton,"on"),this.context.table.splitMenu.style.display="none",this.removeDocEvent("mousedown",this.plugins.table._closeSplitMenu),this.plugins.table._closeSplitMenu=null}.bind(this),this.addDocEvent("mousedown",this.plugins.table._closeSplitMenu)},splitCells:function(e){const t=this.util,i="vertical"===e,n=this.context.table,l=n._tdElement,s=n._trElements,o=n._trElement,a=n._logical_cellIndex,r=n._rowIndex,c=this.plugins.table.createCells.call(this,l.nodeName,0,!0);if(i){const e=l.colSpan;if(c.rowSpan=l.rowSpan,e>1)c.colSpan=this._w.Math.floor(e/2),l.colSpan=e-c.colSpan,o.insertBefore(c,l.nextElementSibling);else{let t=[],i=[];for(let o,r,c=0,d=n._rowCnt;c<d;c++){o=s[c].cells,r=0;for(let n,s,d,u,h=0,p=o.length;h<p;h++){if(n=o[h],s=n.colSpan-1,d=n.rowSpan-1,u=h+r,i.length>0)for(let e,t=0;t<i.length;t++)e=i[t],e.row>c||(u>=e.index?(r+=e.cs,u+=e.cs,e.rs-=1,e.row=c+1,e.rs<1&&(i.splice(t,1),t--)):h===p-1&&(e.rs-=1,e.row=c+1,e.rs<1&&(i.splice(t,1),t--)));if(u<=a&&d>0&&t.push({index:u,cs:s+1,rs:d,row:-1}),n!==l&&u<=a&&u+s>=a+e-1){n.colSpan+=1;break}if(u>a)break;r+=s}i=i.concat(t).sort((function(e,t){return e.index-t.index})),t=[]}o.insertBefore(c,l.nextElementSibling)}}else{const e=l.rowSpan;if(c.colSpan=l.colSpan,e>1){c.rowSpan=this._w.Math.floor(e/2);const i=e-c.rowSpan,n=[],r=t.getArrayIndex(s,o)+i;for(let e,t,i=0;i<r;i++){e=s[i].cells,t=0;for(let l,s,o,c=0,d=e.length;c<d&&(o=c+t,!(o>=a));c++)l=e[c],s=l.rowSpan-1,s>0&&s+i>=r&&o<a&&n.push({index:o,cs:l.colSpan}),t+=l.colSpan-1}const d=s[r],u=d.cells;let h=n.shift();for(let e,t,i,l,s=0,o=u.length,r=0;s<o;s++){if(i=s+r,e=u[s],t=e.colSpan-1,l=i+t+1,h&&l>=h.index&&(r+=h.cs,l+=h.cs,h=n.shift()),l>=a||s===o-1){d.insertBefore(c,e.nextElementSibling);break}r+=t}l.rowSpan=i}else{c.rowSpan=l.rowSpan;const e=t.createElement("TR");e.appendChild(c);for(let e,t=0;t<r;t++){if(e=s[t].cells,0===e.length)return;for(let i=0,n=e.length;i<n;i++)t+e[i].rowSpan-1>=r&&(e[i].rowSpan+=1)}const i=n._physical_cellIndex,a=o.cells;for(let e=0,t=a.length;e<t;e++)e!==i&&(a[e].rowSpan+=1);o.parentNode.insertBefore(e,o.nextElementSibling)}}this.focusEdge(l),this.plugins.table.setPositionControllerDiv.call(this,l,!0)},mergeCells:function(){const e=this.plugins.table,t=this.context.table,i=this.util,n=e._ref,l=e._selectedCells,s=l[0];let o=null,a=null,r=n.ce-n.cs+1,c=n.re-n.rs+1,d="",u=null;for(let e,t,n=1,s=l.length;n<s;n++){e=l[n],u!==e.parentNode&&(u=e.parentNode),t=e.children;for(let e=0,n=t.length;e<n;e++)i.isFormatElement(t[e])&&i.onlyZeroWidthSpace(t[e].textContent)&&i.removeItem(t[e]);d+=e.innerHTML,i.removeItem(e),0===u.cells.length&&(o?a=u:o=u,c-=1)}if(o){const e=t._trElements,n=i.getArrayIndex(e,o),l=i.getArrayIndex(e,a||o),s=[];for(let t,o=0;o<=l;o++)if(t=e[o].cells,0!==t.length)for(let e,s,a=0,r=t.length;a<r;a++)e=t[a],s=e.rowSpan-1,s>0&&o+s>=n&&(e.rowSpan-=i.getOverlapRangeAtIndex(n,l,o,o+s));else s.push(e[o]);for(let e=0,t=s.length;e<t;e++)i.removeItem(s[e])}s.innerHTML+=d,s.colSpan=r,s.rowSpan=c,this.controllersOff(),e.setActiveButton.call(this,!0,!1),e.call_controller_tableEdit.call(this,s),i.addClass(s,"se-table-selected-cell"),this.focusEdge(s)},toggleHeader:function(){const e=this.util,t=this.context.table.headerButton,i=e.hasClass(t,"active"),n=this.context.table._element;if(i)e.removeItem(n.querySelector("thead"));else{const t=e.createElement("THEAD");t.innerHTML="<tr>"+this.plugins.table.createCells.call(this,"th",this.context.table._logical_cellCnt,!1)+"</tr>",n.insertBefore(t,n.firstElementChild)}e.toggleClass(t,"active"),/TH/i.test(this.context.table._tdElement.nodeName)?this.controllersOff():this.plugins.table.setPositionControllerDiv.call(this,this.context.table._tdElement,!1)},resizeTable:function(){const e=this.context.table,t=e.resizeIcon,i=e.resizeText;let n="se-icon-expansion",l="se-icon-reduction",s=e.minText,o="100%";e._maxWidth||(n="se-icon-reduction",l="se-icon-expansion",s=e.maxText,o="auto"),this.util.removeClass(t,n),this.util.addClass(t,l),this.util.changeTxt(i,s),e._element.style.width=o},setActiveButton:function(e,t){const i=this.context.table;t&&e!==t?(i.splitButton.setAttribute("disabled",!0),i.mergeButton.removeAttribute("disabled")):(i.splitButton.removeAttribute("disabled"),i.mergeButton.setAttribute("disabled",!0))},_bindOnSelect:null,_bindOffSelect:null,_bindOffShift:null,_selectedCells:null,_shift:!1,_fixedCell:null,_fixedCellName:null,_selectedCell:null,_selectedTable:null,_ref:null,_toggleEditor:function(e){this.context.element.wysiwyg.setAttribute("contenteditable",e),e?this.util.removeClass(this.context.element.wysiwyg,"se-disabled"):this.util.addClass(this.context.element.wysiwyg,"se-disabled")},_offCellMultiSelect:function(e){e.stopPropagation();const t=this.plugins.table;t._shift?t._initBind&&(this._wd.removeEventListener("touchmove",t._initBind),t._initBind=null):(t._removeEvents.call(this),t._toggleEditor.call(this,!0)),t._fixedCell&&t._selectedTable&&(t.setActiveButton.call(this,t._fixedCell,t._selectedCell),t.call_controller_tableEdit.call(this,t._selectedCell||t._fixedCell),t._selectedCells=t._selectedTable.querySelectorAll(".se-table-selected-cell"),t._selectedCell&&t._fixedCell&&this.focusEdge(t._selectedCell),t._shift||(t._fixedCell=null,t._selectedCell=null,t._fixedCellName=null))},_onCellMultiSelect:function(e){const t=this.plugins.table,i=this.util.getParentElement(e.target,this.util.isCell);if(t._shift)i===t._fixedCell?t._toggleEditor.call(this,!0):t._toggleEditor.call(this,!1);else if(!t._ref){if(i===t._fixedCell)return;t._toggleEditor.call(this,!1)}i&&i!==t._selectedCell&&t._fixedCellName===i.nodeName&&t._selectedTable===this.util.getParentElement(i,"TABLE")&&(t._selectedCell=i,t._setMultiCells.call(this,t._fixedCell,i))},_setMultiCells:function(e,t){const i=this.plugins.table,n=i._selectedTable.rows,l=this.util,s=i._selectedTable.querySelectorAll(".se-table-selected-cell");for(let e=0,t=s.length;e<t;e++)l.removeClass(s[e],"se-table-selected-cell");if(e===t&&(l.addClass(e,"se-table-selected-cell"),!i._shift))return;let o=!0,a=[],r=[];const c=i._ref={_i:0,cs:null,ce:null,rs:null,re:null};for(let i,s,d=0,u=n.length;d<u;d++){i=n[d].cells,s=0;for(let n,u,h,p,g=0,m=i.length;g<m;g++){if(n=i[g],h=n.colSpan-1,p=n.rowSpan-1,u=g+s,a.length>0)for(let e,t=0;t<a.length;t++)e=a[t],e.row>d||(u>=e.index?(s+=e.cs,u+=e.cs,e.rs-=1,e.row=d+1,e.rs<1&&(a.splice(t,1),t--)):g===m-1&&(e.rs-=1,e.row=d+1,e.rs<1&&(a.splice(t,1),t--)));if(o){if(n!==e&&n!==t||(c.cs=null!==c.cs&&c.cs<u?c.cs:u,c.ce=null!==c.ce&&c.ce>u+h?c.ce:u+h,c.rs=null!==c.rs&&c.rs<d?c.rs:d,c.re=null!==c.re&&c.re>d+p?c.re:d+p,c._i+=1),2===c._i){o=!1,a=[],r=[],d=-1;break}}else if(l.getOverlapRangeAtIndex(c.cs,c.ce,u,u+h)&&l.getOverlapRangeAtIndex(c.rs,c.re,d,d+p)){const e=c.cs<u?c.cs:u,t=c.ce>u+h?c.ce:u+h,i=c.rs<d?c.rs:d,s=c.re>d+p?c.re:d+p;if(c.cs!==e||c.ce!==t||c.rs!==i||c.re!==s){c.cs=e,c.ce=t,c.rs=i,c.re=s,d=-1,a=[],r=[];break}l.addClass(n,"se-table-selected-cell")}p>0&&r.push({index:u,cs:h+1,rs:p,row:-1}),s+=n.colSpan-1}a=a.concat(r).sort((function(e,t){return e.index-t.index})),r=[]}},_removeEvents:function(){const e=this.plugins.table;e._initBind&&(this._wd.removeEventListener("touchmove",e._initBind),e._initBind=null),e._bindOnSelect&&(this._wd.removeEventListener("mousedown",e._bindOnSelect),this._wd.removeEventListener("mousemove",e._bindOnSelect),e._bindOnSelect=null),e._bindOffSelect&&(this._wd.removeEventListener("mouseup",e._bindOffSelect),e._bindOffSelect=null),e._bindOffShift&&(this._wd.removeEventListener("keyup",e._bindOffShift),e._bindOffShift=null)},_initBind:null,onTableCellMultiSelect:function(e,t){const i=this.plugins.table;i._removeEvents.call(this),this.controllersOff(),i._shift=t,i._fixedCell=e,i._fixedCellName=e.nodeName,i._selectedTable=this.util.getParentElement(e,"TABLE");const n=i._selectedTable.querySelectorAll(".se-table-selected-cell");for(let e=0,t=n.length;e<t;e++)this.util.removeClass(n[e],"se-table-selected-cell");this.util.addClass(e,"se-table-selected-cell"),i._bindOnSelect=i._onCellMultiSelect.bind(this),i._bindOffSelect=i._offCellMultiSelect.bind(this),t?(i._bindOffShift=function(){this.controllersOn(this.context.table.resizeDiv,this.context.table.tableController,this.plugins.table.init.bind(this),this.focus.bind(this),"table"),i._ref||this.controllersOff()}.bind(this),this._wd.addEventListener("keyup",i._bindOffShift,!1),this._wd.addEventListener("mousedown",i._bindOnSelect,!1)):this._wd.addEventListener("mousemove",i._bindOnSelect,!1),this._wd.addEventListener("mouseup",i._bindOffSelect,!1),i._initBind=i.init.bind(this),this._wd.addEventListener("touchmove",i._initBind,!1)},onClick_tableController:function(e){e.stopPropagation();const t=e.target.getAttribute("data-command")?e.target:e.target.parentNode;if(t.getAttribute("disabled"))return;const i=t.getAttribute("data-command"),n=t.getAttribute("data-value"),l=t.getAttribute("data-option");if("function"==typeof this.plugins.table._closeSplitMenu&&(this.plugins.table._closeSplitMenu(),"onsplit"===i))return;if(!i)return;e.preventDefault();const s=this.context.table;switch(i){case"insert":case"delete":this.plugins.table.editTable.call(this,n,l);break;case"header":this.plugins.table.toggleHeader.call(this);break;case"onsplit":this.plugins.table.openSplitMenu.call(this);break;case"split":this.plugins.table.splitCells.call(this,n);break;case"merge":this.plugins.table.mergeCells.call(this);break;case"resize":s.resizeDiv.style.display="none",s._maxWidth=!s._maxWidth,this.plugins.table.resizeTable.call(this);break;case"remove":this.util.removeItem(s._element),this.controllersOff()}this.focus(),this.history.push(!1)}},formatBlock:{name:"formatBlock",display:"submenu",add:function(e,t){const i=e.context;i.formatBlock={targetText:t.querySelector(".txt"),targetTooltip:t.parentNode.querySelector(".se-tooltip-text"),_formatList:null,currentFormat:""};let n=this.setSubmenu.call(e);n.querySelector("ul").addEventListener("click",this.pickUp.bind(e)),i.formatBlock._formatList=n.querySelectorAll("li button"),t.parentNode.appendChild(n),n=null},setSubmenu:function(){const e=this.context.option,t=this.lang.toolbar,i=this.util.createElement("DIV");i.className="se-submenu se-list-layer";const n=["p","div","blockquote","pre","h1","h2","h3","h4","h5","h6"],l=e.formats&&0!==e.formats.length?e.formats:n;let s='<div class="se-list-inner"><ul class="se-list-basic se-list-format">';for(let e,i,o,a,r,c,d,u=0,h=l.length;u<h;u++)e=l[u],"string"==typeof e&&n.indexOf(e)>-1?(i=e.toLowerCase(),o="blockquote"===i?"range":"pre"===i?"free":"replace",r=/^h/.test(i)?i.match(/\d+/)[0]:"",a=t["tag_"+(r?"h":i)]+r,d="",c=""):(i=e.tag.toLowerCase(),o=e.command,a=e.name||i,d=e.class,c=d?' class="'+d+'"':""),s+='<li><button type="button" class="se-btn-list" data-command="'+o+'" data-value="'+i+'" data-class="'+d+'" title="'+a+'"><'+i+c+">"+a+"</"+i+"></button></li>";return s+="</ul></div>",i.innerHTML=s,i},active:function(e){let t=this.lang.toolbar.formats;const i=this.context.formatBlock.targetText,n=this.context.formatBlock.targetTooltip;if(e){if(this.util.isFormatElement(e)){const l=this.context.formatBlock._formatList,s=e.nodeName.toLowerCase(),o=(e.className.match(/(\s|^)__se__format__[^\s]+/)||[""])[0].trim();for(let e,i=0,n=l.length;i<n;i++)if(e=l[i],s===e.getAttribute("data-value")&&o===e.getAttribute("data-class")){t=e.title;break}return this.util.changeTxt(i,t),this.util.changeTxt(n,t),i.setAttribute("data-value",s),i.setAttribute("data-class",o),!0}}else this.util.changeTxt(i,t),this.util.changeTxt(n,t);return!1},on:function(){const e=this.context.formatBlock,t=e._formatList,i=e.targetText,n=(i.getAttribute("data-value")||"")+(i.getAttribute("data-class")||"");if(n!==e.currentFormat){for(let e,i=0,l=t.length;i<l;i++)e=t[i],n===e.getAttribute("data-value")+e.getAttribute("data-class")?this.util.addClass(e,"active"):this.util.removeClass(e,"active");e.currentFormat=n}},pickUp:function(e){e.preventDefault(),e.stopPropagation();let t=e.target,i=null,n=null,l=null,s="";for(;!i&&!/UL/i.test(t.tagName);){if(i=t.getAttribute("data-command"),n=t.getAttribute("data-value"),s=t.getAttribute("data-class"),i){l=t.firstChild;break}t=t.parentNode}if(i){if("range"===i){const e=l.cloneNode(!1);this.applyRangeFormatElement(e)}else{const e=this.getRange(),t=e.startOffset,o=e.endOffset,a=this.util,r=this.getSelectedElementsAndComponents(!1);if(0===r.length)return;let c=r[0],d=r[r.length-1];const u=a.getNodePath(e.startContainer,c,null),h=a.getNodePath(e.endContainer,d,null),p=this.detachList(r,!1);p.sc&&(c=p.sc),p.ec&&(d=p.ec),this.setRange(a.getNodeFromPath(u,c),t,a.getNodeFromPath(h,d),o);const g=this.getSelectedElementsAndComponents(!1);if("free"===i){const e=g.length-1;let t=g[e].parentNode,i=l.cloneNode(!1);const n=i;for(let n,s,o,r,c,d,u=e,h=!0;u>=0;u--)if(n=g[u],n!==(g[u+1]?g[u+1].parentNode:null)){if(d=a.isComponent(n),s=d?"":n.innerHTML.replace(/(?!>)\s+(?=<)|\n/g," "),o=a.getParentElement(n,(function(e){return e.parentNode===t})),(t!==n.parentNode||d)&&(a.isFormatElement(t)?(t.parentNode.insertBefore(i,t.nextSibling),t=t.parentNode):(t.insertBefore(i,o?o.nextSibling:null),t=n.parentNode),r=i.nextSibling,r&&i.nodeName===r.nodeName&&a.isSameAttributes(i,r)&&(i.innerHTML+="<BR>"+r.innerHTML,a.removeItem(r)),i=l.cloneNode(!1),h=!0),c=i.innerHTML,i.innerHTML=(h||!s||!c||/<br>$/i.test(s)?s:s+"<BR>")+c,0===u){t.insertBefore(i,n),r=n.nextSibling,r&&i.nodeName===r.nodeName&&a.isSameAttributes(i,r)&&(i.innerHTML+="<BR>"+r.innerHTML,a.removeItem(r));const e=i.previousSibling;e&&i.nodeName===e.nodeName&&a.isSameAttributes(i,e)&&(e.innerHTML+="<BR>"+i.innerHTML,a.removeItem(i))}d||a.removeItem(n),s&&(h=!1)}this.setRange(n,0,n,0)}else{for(let e,t,i=0,o=g.length;i<o;i++)e=g[i],e.nodeName.toLowerCase()===n.toLowerCase()&&(e.className.match(/(\s|^)__se__format__[^\s]+/)||[""])[0].trim()===s||a.isComponent(e)||(t=l.cloneNode(!1),a.copyFormatAttributes(t,e),t.innerHTML=e.innerHTML,e.parentNode.replaceChild(t,e)),0===i&&(c=t||e),i===o-1&&(d=t||e),t=null;this.setRange(a.getNodeFromPath(u,c),t,a.getNodeFromPath(h,d),o)}this.history.push(!1)}this.submenuOff()}}},lineHeight:{name:"lineHeight",display:"submenu",add:function(e,t){const i=e.context;i.lineHeight={_sizeList:null,currentSize:-1};let n=this.setSubmenu.call(e),l=n.querySelector("ul");l.addEventListener("click",this.pickup.bind(e)),i.lineHeight._sizeList=l.querySelectorAll("li button"),t.parentNode.appendChild(n),n=null,l=null},setSubmenu:function(){const e=this.context.option,t=this.lang,i=this.util.createElement("DIV");i.className="se-submenu se-list-layer";const n=e.lineHeights?e.lineHeights:[{text:"1",value:1},{text:"1.15",value:1.15},{text:"1.5",value:1.5},{text:"2",value:2}];let l='<div class="se-list-inner"><ul class="se-list-basic"><li><button type="button" class="default_value se-btn-list" title="'+t.toolbar.default+'">('+t.toolbar.default+")</button></li>";for(let e,t=0,i=n.length;t<i;t++)e=n[t],l+='<li><button type="button" class="se-btn-list" data-value="'+e.value+'" title="'+e.text+'">'+e.text+"</button></li>";return l+="</ul></div>",i.innerHTML=l,i},on:function(){const e=this.context.lineHeight,t=e._sizeList,i=this.util.getFormatElement(this.getSelectionNode()).style.lineHeight+"";if(i!==e.currentSize){for(let e=0,n=t.length;e<n;e++)i===t[e].getAttribute("data-value")?this.util.addClass(t[e],"active"):this.util.removeClass(t[e],"active");e.currentSize=i}},pickup:function(e){if(!/^BUTTON$/i.test(e.target.tagName))return!1;e.preventDefault(),e.stopPropagation();const t=e.target.getAttribute("data-value")||"",i=this.getSelectedElements();for(let e=0,n=i.length;e<n;e++)i[e].style.lineHeight=t;this.submenuOff(),this.history.push(!1)}},template:{name:"template",display:"submenu",add:function(e,t){e.context.template={};let i=this.setSubmenu.call(e);i.querySelector("ul").addEventListener("click",this.pickup.bind(e)),t.parentNode.appendChild(i),i=null},setSubmenu:function(){const e=this.context.option.templates;if(!e||0===e.length)throw Error('[SUNEDITOR.plugins.template.fail] To use the "template" plugin, please define the "templates" option.');const t=this.util.createElement("DIV");t.className="se-list-layer";let i='<div class="se-submenu se-list-inner"><ul class="se-list-basic">';for(let t,n=0,l=e.length;n<l;n++)t=e[n],i+='<li><button type="button" class="se-btn-list" data-value="'+n+'" title="'+t.name+'">'+t.name+"</button></li>";return i+="</ul></div>",t.innerHTML=i,t},pickup:function(e){if(!/^BUTTON$/i.test(e.target.tagName))return!1;e.preventDefault(),e.stopPropagation();const t=this.context.option.templates[e.target.getAttribute("data-value")];if(!t.html)throw this.submenuOff(),Error('[SUNEDITOR.template.fail] cause : "templates[i].html not found"');this.setContents(t.html),this.submenuOff()}},paragraphStyle:{name:"paragraphStyle",display:"submenu",add:function(e,t){const i=e.context;i.paragraphStyle={_classList:null};let n=this.setSubmenu.call(e);n.querySelector("ul").addEventListener("click",this.pickUp.bind(e)),i.paragraphStyle._classList=n.querySelectorAll("li button"),t.parentNode.appendChild(n),n=null},setSubmenu:function(){const e=this.context.option,t=this.util.createElement("DIV");t.className="se-submenu se-list-layer";const i=this.lang.menu,n={spaced:{name:i.spaced,class:"__se__p-spaced",_class:""},bordered:{name:i.bordered,class:"__se__p-bordered",_class:""},neon:{name:i.neon,class:"__se__p-neon",_class:""}},l=e.paragraphStyles&&0!==e.paragraphStyles.length?e.paragraphStyles:["spaced","bordered","neon"];let s='<div class="se-list-inner"><ul class="se-list-basic se-list-format">';for(let e,t,i,o,a=0,r=l.length;a<r;a++){if(e=l[a],"string"==typeof e){const t=n[e.toLowerCase()];if(!t)continue;e=t}t=e.name,i=e.class?' class="'+e.class+'"':"",o=e._class,s+='<li><button type="button" class="se-btn-list'+(o?" "+o:"")+'" data-value="'+e.class+'" title="'+t+'"><div'+i+">"+t+"</div></button></li>"}return s+="</ul></div>",t.innerHTML=s,t},on:function(){const e=this.context.paragraphStyle._classList,t=this.util.getFormatElement(this.getSelectionNode());for(let i=0,n=e.length;i<n;i++)this.util.hasClass(t,e[i].getAttribute("data-value"))?this.util.addClass(e[i],"active"):this.util.removeClass(e[i],"active")},pickUp:function(e){e.preventDefault(),e.stopPropagation();let t=e.target,i=null;for(;!/^UL$/i.test(t.tagName)&&(i=t.getAttribute("data-value"),!i);)t=t.parentNode;if(!i)return;let n=this.getSelectedElements();if(0===n.length)return;const l=this.util.hasClass(t,"active")?this.util.removeClass.bind(this.util):this.util.addClass.bind(this.util);n=this.getSelectedElements();for(let e=0,t=n.length;e<t;e++)l(n[e],i);this.submenuOff(),this.history.push(!1)}},textStyle:{name:"textStyle",display:"submenu",add:function(e,t){const i=e.context;i.textStyle={_styleList:null};let n=this.setSubmenu.call(e),l=n.querySelector("ul");l.addEventListener("click",this.pickup.bind(e)),i.textStyle._styleList=n.querySelectorAll("li button"),t.parentNode.appendChild(n),n=null,l=null},setSubmenu:function(){const e=this.context.option,t=this.util.createElement("DIV");t.className="se-submenu se-list-layer";const i={translucent:{name:this.lang.menu.translucent,style:"opacity: 0.5;",tag:"span"},shadow:{name:this.lang.menu.shadow,class:"__se__t-shadow",tag:"span"}},n=e.textStyles?e.textStyles:["translucent","shadow"];let l='<div class="se-list-inner"><ul class="se-list-basic se-list-format">';for(let e,t,s,o,a,r,c,d=0,u=n.length;d<u;d++){if(e=n[d],o="",r="",a=[],"string"==typeof e){const t=i[e.toLowerCase()];if(!t)continue;e=t}s=e.name,t=e.tag||"span",c=e._class,e.style&&(o+=' style="'+e.style+'"',r+=e.style.replace(/:[^;]+(;|$)\s*/g,","),a.push("style")),e.class&&(o+=' class="'+e.class+'"',r+="."+e.class.trim().replace(/\s+/g,",."),a.push("class")),r=r.replace(/,$/,""),l+='<li><button type="button" class="se-btn-list'+(c?" "+c:"")+'" data-command="'+t+'" data-value="'+r+'" title="'+s+'"><'+t+o+">"+s+"</"+t+"></button></li>"}return l+="</ul></div>",t.innerHTML=l,t},on:function(){const e=this.util,t=this.context.textStyle._styleList,i=this.getSelectionNode();for(let n,l,s,o=0,a=t.length;o<a;o++){n=t[o],l=n.getAttribute("data-value").split(",");for(let t,o,a=0;a<l.length;a++){for(t=i,s=!1;!e.isFormatElement(t);){if(t.nodeName.toLowerCase()===n.getAttribute("data-command").toLowerCase()&&(o=l[a],/^\./.test(o)?e.hasClass(t,o.replace(/^\./,"")):t.style[o])){s=!0;break}t=t.parentNode}if(!s)break}s?e.addClass(n,"active"):e.removeClass(n,"active")}},pickup:function(e){e.preventDefault(),e.stopPropagation();let t=e.target,i=null,n=null;for(;!i&&!/UL/i.test(t.tagName);){if(i=t.getAttribute("data-command"),i){n=t.firstChild;break}t=t.parentNode}if(!i)return;const l=n.style.cssText.replace(/:.+(;|$)/g,",").split(",");l.pop();const s=n.classList;for(let e=0,t=s.length;e<t;e++)l.push("."+s[e]);const o=this.util.hasClass(t,"active")?null:n.cloneNode(!1),a=o?null:[n.nodeName];this.nodeChange(o,l,a,!0),this.submenuOff()}},link:{name:"link",display:"dialog",add:function(e){e.addModule([l]);const t=e.context;t.link={focusElement:null,linkNewWindowCheck:null,linkAnchorText:null,_linkAnchor:null};let i=this.setDialog.call(e);t.link.modal=i,t.link.focusElement=i.querySelector("._se_link_url"),t.link.linkAnchorText=i.querySelector("._se_link_text"),t.link.linkNewWindowCheck=i.querySelector("._se_link_check");let n=this.setController_LinkButton.call(e);t.link.linkBtn=n,t.link._linkAnchor=null,n.addEventListener("mousedown",(function(e){e.stopPropagation()}),!1),i.querySelector(".se-btn-primary").addEventListener("click",this.submit.bind(e)),n.addEventListener("click",this.onClick_linkBtn.bind(e)),t.dialog.modal.appendChild(i),t.element.relative.appendChild(n),i=null,n=null},setDialog:function(){const e=this.lang,t=this.util.createElement("DIV");return t.className="se-dialog-content",t.style.display="none",t.innerHTML='<form class="editor_link"><div class="se-dialog-header"><button type="button" data-command="close" class="se-btn se-dialog-close" aria-label="Close" title="'+e.dialogBox.close+'"><i aria-hidden="true" data-command="close" class="se-icon-cancel"></i></button><span class="se-modal-title">'+e.dialogBox.linkBox.title+'</span></div><div class="se-dialog-body"><div class="se-dialog-form"><label>'+e.dialogBox.linkBox.url+'</label><input class="se-input-form _se_link_url" type="text" /></div><div class="se-dialog-form"><label>'+e.dialogBox.linkBox.text+'</label><input class="se-input-form _se_link_text" type="text" /></div><div class="se-dialog-form-footer"><label><input type="checkbox" class="se-dialog-btn-check _se_link_check" />&nbsp;'+e.dialogBox.linkBox.newWindowCheck+'</label></div></div><div class="se-dialog-footer"><button type="submit" class="se-btn-primary" title="'+e.dialogBox.submitButton+'"><span>'+e.dialogBox.submitButton+"</span></button></div></form>",t},setController_LinkButton:function(){const e=this.lang,t=this.util.createElement("DIV");return t.className="se-controller se-controller-link",t.innerHTML='<div class="se-arrow se-arrow-up"></div><div class="link-content"><span><a target="_blank" href=""></a>&nbsp;</span><div class="se-btn-group"><button type="button" data-command="update" tabindex="-1" class="se-tooltip"><i class="se-icon-edit"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.edit+'</span></span></button><button type="button" data-command="unlink" tabindex="-1" class="se-tooltip"><i class="se-icon-unlink"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.unlink+'</span></span></button><button type="button" data-command="delete" tabindex="-1" class="se-tooltip"><i class="se-icon-delete"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.remove+"</span></span></button></div></div>",t},open:function(){this.plugins.dialog.open.call(this,"link","link"===this.currentControllerName)},submit:function(e){this.showLoading(),e.preventDefault(),e.stopPropagation();const t=function(){if(0===this.context.link.focusElement.value.trim().length)return!1;const e=this.context.link,t=e.focusElement.value,i=e.linkAnchorText,n=0===i.value.length?t:i.value;if(this.context.dialog.updateModal)e._linkAnchor.href=t,e._linkAnchor.textContent=n,e._linkAnchor.target=e.linkNewWindowCheck.checked?"_blank":"",this.setRange(e._linkAnchor.childNodes[0],0,e._linkAnchor.childNodes[0],e._linkAnchor.textContent.length);else{const i=this.util.createElement("A");i.href=t,i.textContent=n,i.target=e.linkNewWindowCheck.checked?"_blank":"";const l=this.getSelectedElements();if(l.length>1){const e=this.util.createElement(l[0].nodeName);e.appendChild(i),this.insertNode(e)}else this.insertNode(i);this.setRange(i.childNodes[0],0,i.childNodes[0],i.textContent.length)}this.history.push(!1),e.focusElement.value="",e.linkAnchorText.value=""}.bind(this);try{t()}finally{this.plugins.dialog.close.call(this),this.closeLoading(),this.focus()}return!1},active:function(e){if(e){if(this.util.isAnchor(e)&&null===e.getAttribute("data-image-link"))return this.controllerArray[0]!==this.context.link.linkBtn&&this.plugins.link.call_controller_linkButton.call(this,e),!0}else this.controllerArray[0]===this.context.link.linkBtn&&this.controllersOff();return!1},on:function(e){e||(this.context.link.linkAnchorText.value=this.getSelection().toString()),this.context.link._linkAnchor&&(this.context.dialog.updateModal=!0,this.context.link.focusElement.value=this.context.link._linkAnchor.href,this.context.link.linkAnchorText.value=this.context.link._linkAnchor.textContent,this.context.link.linkNewWindowCheck.checked=!!/_blank/i.test(this.context.link._linkAnchor.target))},call_controller_linkButton:function(e){this.editLink=this.context.link._linkAnchor=e;const t=this.context.link.linkBtn,i=t.querySelector("a");i.href=e.href,i.title=e.textContent,i.textContent=e.textContent;const n=this.util.getOffset(e,this.context.element.wysiwygFrame);t.style.top=n.top+e.offsetHeight+10+"px",t.style.left=n.left-this.context.element.wysiwygFrame.scrollLeft+"px",t.style.display="block";const l=this.context.element.wysiwygFrame.offsetWidth-(t.offsetLeft+t.offsetWidth);l<0?(t.style.left=t.offsetLeft+l+"px",t.firstElementChild.style.left=20-l+"px"):t.firstElementChild.style.left="20px",this.controllersOn(t,this.plugins.link.init.bind(this),"link")},onClick_linkBtn:function(e){e.stopPropagation();const t=e.target.getAttribute("data-command")||e.target.parentNode.getAttribute("data-command");if(t){if(e.preventDefault(),/update/.test(t))this.context.link.focusElement.value=this.context.link._linkAnchor.href,this.context.link.linkAnchorText.value=this.context.link._linkAnchor.textContent,this.context.link.linkNewWindowCheck.checked=!!/_blank/i.test(this.context.link._linkAnchor.target),this.plugins.dialog.open.call(this,"link",!0);else if(/unlink/.test(t)){const e=this.util.getChildElement(this.context.link._linkAnchor,(function(e){return 0===e.childNodes.length||3===e.nodeType}),!1),t=this.util.getChildElement(this.context.link._linkAnchor,(function(e){return 0===e.childNodes.length||3===e.nodeType}),!0);this.setRange(e,0,t,t.textContent.length),this.nodeChange(null,null,["A"],!1)}else this.util.removeItem(this.context.link._linkAnchor),this.context.link._linkAnchor=null,this.focus(),this.history.push(!1);this.controllersOff()}},init:function(){if(!/link/i.test(this.context.dialog.kind)){const e=this.context.link;e.linkBtn.style.display="none",e._linkAnchor=null,e.focusElement.value="",e.linkAnchorText.value="",e.linkNewWindowCheck.checked=!1}}},image:{name:"image",display:"dialog",add:function(e){e.addModule([l,s,o]);const t=e.context;t.image={sizeUnit:t.option._imageSizeUnit,_linkElement:null,_container:null,_cover:null,_element:null,_element_w:1,_element_h:1,_element_l:0,_element_t:0,_defaultSizeX:"auto",_defaultSizeY:"auto",_origin_w:"auto"===t.option.imageWidth?"":t.option.imageWidth,_origin_h:"",_altText:"",_caption:null,captionCheckEl:null,_linkValue:"",_align:"none",_captionChecked:!1,_proportionChecked:!0,_floatClassRegExp:"__se__float\\-[a-z]+",_xmlHttp:null,_captionShow:!0,_resizing:t.option.imageResizing,_rotation:t.option.imageRotation,_resizeDotHide:!t.option.imageHeightShow,_uploadFileLength:0,_onlyPercentage:t.option.imageSizeOnlyPercentage,_ratio:!1,_ratioX:1,_ratioY:1};let i=this.setDialog.call(e);t.image.modal=i,t.image.imgUrlFile=i.querySelector("._se_image_url"),t.image.imgInputFile=t.image.focusElement=i.querySelector("._se_image_file")||i.querySelector("._se_image_url"),t.image.altText=i.querySelector("._se_image_alt"),t.image.imgLink=i.querySelector("._se_image_link"),t.image.imgLinkNewWindowCheck=i.querySelector("._se_image_link_check"),t.image.captionCheckEl=i.querySelector("._se_image_check_caption"),t.image.modal.querySelector(".se-dialog-tabs").addEventListener("click",this.openTab.bind(e)),t.image.modal.querySelector(".se-btn-primary").addEventListener("click",this.submit.bind(e)),t.image.proportion={},t.image.inputX={},t.image.inputY={},t.option.imageResizing&&(t.image.proportion=i.querySelector("._se_image_check_proportion"),t.image.inputX=i.querySelector("._se_image_size_x"),t.image.inputY=i.querySelector("._se_image_size_y"),t.image.inputX.value=t.option.imageWidth,t.image.inputX.addEventListener("keyup",this.setInputSize.bind(e,"x")),t.image.inputY.addEventListener("keyup",this.setInputSize.bind(e,"y")),t.image.inputX.addEventListener("change",this.setRatio.bind(e)),t.image.inputY.addEventListener("change",this.setRatio.bind(e)),t.image.proportion.addEventListener("change",this.setRatio.bind(e)),i.querySelector(".se-dialog-btn-revert").addEventListener("click",this.sizeRevert.bind(e))),t.dialog.modal.appendChild(i),i=null},setDialog:function(){const e=this.context.option,t=this.lang,i=this.util.createElement("DIV");i.className="se-dialog-content",i.style.display="none";let n='<div class="se-dialog-header"><button type="button" data-command="close" class="se-btn se-dialog-close" class="close" aria-label="Close" title="'+t.dialogBox.close+'"><i aria-hidden="true" data-command="close" class="se-icon-cancel"></i></button><span class="se-modal-title">'+t.dialogBox.imageBox.title+'</span></div><div class="se-dialog-tabs"><button type="button" class="_se_tab_link active" data-tab-link="image">'+t.toolbar.image+'</button><button type="button" class="_se_tab_link" data-tab-link="url">'+t.toolbar.link+'</button></div><form class="editor_image" method="post" enctype="multipart/form-data"><div class="_se_tab_content _se_tab_content_image"><div class="se-dialog-body">';if(e.imageFileInput&&(n+='<div class="se-dialog-form"><label>'+t.dialogBox.imageBox.file+'</label><input class="se-input-form _se_image_file" type="file" accept="image/*" multiple="multiple" /></div>'),e.imageUrlInput&&(n+='<div class="se-dialog-form"><label>'+t.dialogBox.imageBox.url+'</label><input class="se-input-form _se_image_url" type="text" /></div>'),n+='<div class="se-dialog-form"><label>'+t.dialogBox.imageBox.altText+'</label><input class="se-input-form _se_image_alt" type="text" /></div>',e.imageResizing){const i=e.imageSizeOnlyPercentage,l=i?' style="display: none !important;"':"",s=e.imageHeightShow?"":' style="display: none !important;"';n+='<div class="se-dialog-form">',i||!e.imageHeightShow?n+='<div class="se-dialog-size-text"><label class="size-w">'+t.dialogBox.size+"</label></div>":n+='<div class="se-dialog-size-text"><label class="size-w">'+t.dialogBox.width+'</label><label class="se-dialog-size-x">&nbsp;</label><label class="size-h">'+t.dialogBox.height+"</label></div>",n+='<input class="se-input-control _se_image_size_x" placeholder="auto"'+(i?' type="number" min="1"':'type="text"')+(i?' max="100"':"")+' /><label class="se-dialog-size-x"'+s+">"+(i?"%":"x")+'</label><input type="text" class="se-input-control _se_image_size_y" placeholder="auto" disabled'+l+(i?' max="100"':"")+s+"/><label"+l+s+'><input type="checkbox" class="se-dialog-btn-check _se_image_check_proportion" checked disabled/>&nbsp;'+t.dialogBox.proportion+'</label><button type="button" title="'+t.dialogBox.revertButton+'" class="se-btn se-dialog-btn-revert" style="float: right;"><i class="se-icon-revert"></i></button></div>'}return n+='<div class="se-dialog-form se-dialog-form-footer"><label><input type="checkbox" class="se-dialog-btn-check _se_image_check_caption" />&nbsp;'+t.dialogBox.caption+'</label></div></div></div><div class="_se_tab_content _se_tab_content_url" style="display: none"><div class="se-dialog-body"><div class="se-dialog-form"><label>'+t.dialogBox.linkBox.url+'</label><input class="se-input-form _se_image_link" type="text" /></div><label><input type="checkbox" class="_se_image_link_check"/>&nbsp;'+t.dialogBox.linkBox.newWindowCheck+'</label></div></div><div class="se-dialog-footer"><div><label><input type="radio" name="suneditor_image_radio" class="se-dialog-btn-radio" value="none" checked>'+t.dialogBox.basic+'</label><label><input type="radio" name="suneditor_image_radio" class="se-dialog-btn-radio" value="left">'+t.dialogBox.left+'</label><label><input type="radio" name="suneditor_image_radio" class="se-dialog-btn-radio" value="center">'+t.dialogBox.center+'</label><label><input type="radio" name="suneditor_image_radio" class="se-dialog-btn-radio" value="right">'+t.dialogBox.right+'</label></div><button type="submit" class="se-btn-primary" title="'+t.dialogBox.submitButton+'"><span>'+t.dialogBox.submitButton+"</span></button></div></form>",i.innerHTML=n,i},open:function(){this.plugins.dialog.open.call(this,"image","image"===this.currentControllerName)},openTab:function(e){const t=this.context.image.modal,i="init"===e?t.querySelector("._se_tab_link"):e.target;if(!/^BUTTON$/i.test(i.tagName))return!1;const n=i.getAttribute("data-tab-link");let l,s,o;for(s=t.getElementsByClassName("_se_tab_content"),l=0;l<s.length;l++)s[l].style.display="none";for(o=t.getElementsByClassName("_se_tab_link"),l=0;l<o.length;l++)this.util.removeClass(o[l],"active");return t.querySelector("._se_tab_content_"+n).style.display="block",this.util.addClass(i,"active"),"image"===n&&this.context.image.focusElement?this.context.image.focusElement.focus():"url"===n&&this.context.image.imgLink&&this.context.image.imgLink.focus(),!1},submitAction:function(e){if(e.length>0){let t=0;const i=[];for(let n=0,l=e.length;n<l;n++)/image/i.test(e[n].type)&&(i.push(e[n]),t+=e[n].size);const n=this.context.option.imageUploadSizeLimit;if(n>0){let e=0;const i=this._variable._imagesInfo;for(let t=0,n=i.length;t<n;t++)e+=1*i[t].size;if(t+e>n){const i="[SUNEDITOR.imageUpload.fail] Size of uploadable total images: "+n/1e3+"KB";return this._imageUploadError(i,{limitSize:n,currentSize:e,uploadSize:t})&&o.open.call(this,i),void this.closeLoading()}}this.context.image._uploadFileLength=i.length;const l=this.context.option.imageUploadUrl,s=this.context.option.imageUploadHeader,a=this.context.dialog.updateModal?1:i.length,r={linkValue:this.context.image._linkValue,linkNewWindow:this.context.image.imgLinkNewWindowCheck.checked,inputWidth:this.context.image.inputX.value,inputHeight:this.context.image.inputY.value,align:this.context.image._align,isUpdate:this.context.dialog.updateModal,currentImage:this.context.image._element};if(!this._imageUploadBefore(i,r))return;if("string"==typeof l&&l.length>0){const e=new FormData;for(let t=0;t<a;t++)e.append("file-"+t,i[t]);if(this.context.image._xmlHttp=this.util.getXMLHttpRequest(),this.context.image._xmlHttp.onreadystatechange=this.plugins.image.callBack_imgUpload.bind(this,r),this.context.image._xmlHttp.open("post",l,!0),null!==s&&"object"==typeof s&&Object.keys(s).length>0)for(let e in s)this.context.image._xmlHttp.setRequestHeader(e,s[e]);this.context.image._xmlHttp.send(e)}else for(let e=0;e<a;e++)this.plugins.image.setup_reader.call(this,i[e],r.linkValue,r.linkNewWindow,r.inputWidth,r.inputHeight,r.align,e,a-1)}},onRender_imgInput:function(){try{this.plugins.image.submitAction.call(this,this.context.image.imgInputFile.files)}catch(e){throw Error('[SUNEDITOR.imageUpload.fail] cause : "'+e.message+'"')}finally{this.closeLoading()}},setup_reader:function(e,t,i,n,l,s,o,a){const r=new FileReader;this.context.dialog.updateModal&&(this.context.image._element.setAttribute("data-file-name",e.name),this.context.image._element.setAttribute("data-file-size",e.size)),r.onload=function(e,c,d){try{this.context.image.inputX.value=n,this.context.image.inputY.value=l,e?this.plugins.image.update_src.call(this,r.result,c,d):this.plugins.image.create_image.call(this,r.result,t,i,n,l,s,d),o===a&&this.closeLoading()}catch(e){throw this.closeLoading(),Error('[SUNEDITOR.imageFileRendering.fail] cause : "'+e.message+'"')}}.bind(this,this.context.dialog.updateModal,this.context.image._element,e),r.readAsDataURL(e)},callBack_imgUpload:function(e){if(4===this.context.image._xmlHttp.readyState){if(200!==this.context.image._xmlHttp.status)throw this.closeLoading(),Error("[SUNEDITOR.imageUpload.fail] status: "+this.context.image._xmlHttp.status+", responseText: "+this.context.image._xmlHttp.responseText);if(!this._imageUploadHandler(this.context.image._xmlHttp,e,this)){const t=JSON.parse(this.context.image._xmlHttp.responseText);if(t.errorMessage)this._imageUploadError(t.errorMessage,t.result)&&o.open.call(this,t.errorMessage);else{const i=t.result;for(let t,n=0,l=i.length;n<l;n++)t={name:i[n].name,size:i[n].size},e.isUpdate?this.plugins.image.update_src.call(this,i[n].url,e.currentImage,t):this.plugins.image.create_image.call(this,i[n].url,e.linkValue,e.linkNewWindow,e.inputWidth,e.inputHeight,e.align,t)}}this.closeLoading()}},onRender_imgUrl:function(){const e=this.context.image;if(0===e.imgUrlFile.value.trim().length)return!1;try{const t={name:e.imgUrlFile.value.split("/").pop(),size:0};this.context.dialog.updateModal?this.plugins.image.update_src.call(this,e.imgUrlFile.value,e._element,t):this.plugins.image.create_image.call(this,e.imgUrlFile.value,e._linkValue,e.imgLinkNewWindowCheck.checked,e.inputX.value,e.inputY.value,e._align,t)}catch(e){throw Error('[SUNEDITOR.imageURLRendering.fail] cause : "'+e.message+'"')}finally{this.closeLoading()}},onRender_link:function(e,t,i){if(t.trim().length>0){const n=this.util.createElement("A");return n.href=/^https?:\/\//.test(t)?t:"http://"+t,n.target=i?"_blank":"",n.setAttribute("data-image-link","image"),e.setAttribute("data-image-link",t),n.appendChild(e),n}return e},setInputSize:function(e,t){t&&32===t.keyCode?t.preventDefault():this.plugins.resizing._module_setInputSize.call(this,this.context.image,e)},setRatio:function(){this.plugins.resizing._module_setRatio.call(this,this.context.image)},submit:function(e){const t=this.context.image,i=this.plugins.image;this.showLoading(),e.preventDefault(),e.stopPropagation(),t._linkValue=t.imgLink.value,t._altText=t.altText.value,t._align=t.modal.querySelector('input[name="suneditor_image_radio"]:checked').value,t._captionChecked=t.captionCheckEl.checked,t._resizing&&(t._proportionChecked=t.proportion.checked);try{this.context.dialog.updateModal&&i.update_image.call(this,!1,!1,!1),t.imgInputFile&&t.imgInputFile.files.length>0?i.onRender_imgInput.call(this):t.imgUrlFile&&t.imgUrlFile.value.trim().length>0?i.onRender_imgUrl.call(this):this.closeLoading()}catch(e){throw this.closeLoading(),Error('[SUNEDITOR.image.submit.fail] cause : "'+e.message+'"')}finally{this.plugins.dialog.close.call(this)}return!1},setImagesInfo:function(e,t){const i=this._variable._imagesInfo;let n=e.getAttribute("data-index"),l=null,s="";if(!n||this._imagesInfoInit)s="create",n=this._variable._imageIndex,this._variable._imageIndex++,e.setAttribute("data-index",n),e.setAttribute("data-file-name",t.name),e.setAttribute("data-file-size",t.size),l={src:e.src,index:1*n,name:t.name,size:t.size},i.push(l);else{s="update",n*=1;for(let e=0,t=i.length;e<t;e++)if(n===i[e].index){l=i[e];break}l||(n=this._variable._imageIndex,this._variable._imageIndex++,l={}),l.src=e.src,l.name=e.getAttribute("data-file-name"),l.size=1*e.getAttribute("data-file-size")}if(l.element=e,l.delete=this.plugins.image.destroy.bind(this,e),l.select=function(){e.scrollIntoView(!0),this._w.setTimeout(function(){this.plugins.image.onModifyMode.call(this,e,this.plugins.resizing.call_controller_resize.call(this,e,"image"))}.bind(this))}.bind(this),e.getAttribute("origin-size")||e.setAttribute("origin-size",e.naturalWidth+","+e.naturalHeight),!e.getAttribute("data-origin")){const t=this.util.getParentElement(e,this.util.isMediaComponent),i=this.util.getParentElement(e,"FIGURE"),n=this.plugins.resizing._module_getSizeX.call(this,this.context.image,e,i,t),l=this.plugins.resizing._module_getSizeY.call(this,this.context.image,e,i,t);e.setAttribute("data-origin",n+","+l),e.setAttribute("data-size",n+","+l)}this._imageUpload(e,n,s,l,--this.context.image._uploadFileLength<0?0:this.context.image._uploadFileLength)},checkImagesInfo:function(){const e=this.context.element.wysiwyg.getElementsByTagName("IMG"),t=this.plugins.image,i=this._variable._imagesInfo;if(e.length===i.length){if(this._imagesInfoReset)for(let i,n=0,l=e.length;n<l;n++)i=e[n],t.setImagesInfo.call(this,i,{name:i.getAttribute("data-file-name")||i.src.split("/").pop(),size:i.getAttribute("data-file-size")||0});return}this.context.resizing._resize_plugin="image";const n=[],l=[];for(let e=0,t=i.length;e<t;e++)l[e]=i[e].index;for(let i,s=0,o=e.length;s<o;s++)if(i=e[s],this.util.getParentElement(i,this.util.isMediaComponent))if(!i.getAttribute("data-index")||l.indexOf(1*i.getAttribute("data-index"))<0){if(n.push(this._variable._imageIndex),i.removeAttribute("data-index"),t.setImagesInfo.call(this,i,{name:i.getAttribute("data-file-name")||i.src.split("/").pop(),size:i.getAttribute("data-file-size")||0}),!i.style.width){const e=(i.getAttribute("data-size")||i.getAttribute("data-origin")||"").split(",");t.onModifyMode.call(this,i,null),t.applySize.call(this,e[0]||this.context.option.imageWidth,e[1]||"")}}else n.push(1*i.getAttribute("data-index"));else n.push(this._variable._imageIndex),t.onModifyMode.call(this,i,null),t.openModify.call(this,!0),t.update_image.call(this,!0,!1,!0);for(let e,t=0;t<i.length;t++)e=i[t].index,n.indexOf(e)>-1||(i.splice(t,1),this._imageUpload(null,e,"delete",null,0),t--);this.context.resizing._resize_plugin=""},_onload_image:function(e,t){t&&(this.plugins.image.setImagesInfo.call(this,e,t),this.history.push(!0))},create_image:function(e,t,i,n,l,s,o){const a=this.context.image;this.context.resizing._resize_plugin="image";let r=this.util.createElement("IMG");r.addEventListener("load",this.plugins.image._onload_image.bind(this,r,o)),r.src=e,r.alt=a._altText,r=this.plugins.image.onRender_link.call(this,r,t,i),r.setAttribute("data-rotate","0"),a._resizing&&r.setAttribute("data-proportion",a._proportionChecked);const c=this.plugins.resizing.set_cover.call(this,r),d=this.plugins.resizing.set_container.call(this,c,"se-image-container");a._captionChecked&&(a._caption=this.plugins.resizing.create_caption.call(this),a._caption.setAttribute("contenteditable",!1),c.appendChild(a._caption)),a._element=r,a._cover=c,a._container=d,this.plugins.image.applySize.call(this),this.plugins.image.setAlign.call(this,s,r,c,d),this.insertComponent(d,!0),this.context.resizing._resize_plugin=""},update_image:function(e,t,i){const n=this.context.image,l=n._linkValue;let s,o=n._element,a=n._cover,r=n._container,c=!1;null===a&&(c=!0,o=n._element.cloneNode(!0),a=this.plugins.resizing.set_cover.call(this,o)),null===r&&(a=a.cloneNode(!0),c=!0,r=this.plugins.resizing.set_container.call(this,a,"se-image-container")),c&&(r.innerHTML="",r.appendChild(a));const d=this.util.isNumber(n.inputX.value)?n.inputX.value+n.sizeUnit:n.inputX.value,u=this.util.isNumber(n.inputY.value)?n.inputY.value+n.sizeUnit:n.inputY.value;if(s=/%$/.test(o.style.width)?d!==r.style.width||u!==r.style.height:d!==o.style.width||u!==o.style.height,o.alt=n._altText,n._captionChecked?n._caption||(n._caption=this.plugins.resizing.create_caption.call(this),a.appendChild(n._caption)):n._caption&&(this.util.removeItem(n._caption),n._caption=null),l.trim().length>0)if(null!==n._linkElement)n._linkElement.href=l,n._linkElement.target=n.imgLinkNewWindowCheck.checked?"_blank":"",o.setAttribute("data-image-link",l);else{let e=this.plugins.image.onRender_link.call(this,o,l,this.context.image.imgLinkNewWindowCheck.checked);a.insertBefore(e,n._caption)}else if(null!==n._linkElement){const e=o;e.setAttribute("data-image-link","");let t=e.cloneNode(!0);a.removeChild(n._linkElement),a.insertBefore(t,n._caption),o=t}if(c){const e=this.util.isRangeFormatElement(n._element.parentNode)||this.util.isWysiwygDiv(n._element.parentNode)?n._element:/^A$/i.test(n._element.parentNode.nodeName)?n._element.parentNode:this.util.getFormatElement(n._element)||n._element;e.parentNode.replaceChild(r,e),o=r.querySelector("img"),n._element=o,n._cover=a,n._container=r}!n._onlyPercentage&&s&&!e&&(/\d+/.test(o.style.height)||this.context.resizing._rotateVertical&&n._captionChecked)&&(/%$/.test(n.inputX.value)||/%$/.test(n.inputY.value)?this.plugins.resizing.resetTransform.call(this,o):this.plugins.resizing.setTransformSize.call(this,o,this.util.getNumber(n.inputX.value,0),this.util.getNumber(n.inputY.value,0)));if(n._resizing&&(o.setAttribute("data-proportion",n._proportionChecked),s&&this.plugins.image.applySize.call(this)),this.plugins.image.setAlign.call(this,null,o,null,null),e&&this.plugins.image.setImagesInfo.call(this,o,{name:o.getAttribute("data-file-name")||o.src.split("/").pop(),size:o.getAttribute("data-file-size")||0}),t){this.plugins.image.init.call(this);const e=this.plugins.resizing.call_controller_resize.call(this,o,"image");this.plugins.image.onModifyMode.call(this,o,e)}i||this.history.push(!1)},update_src:function(e,t,i){t.src=e,this._w.setTimeout(this.plugins.image.setImagesInfo.bind(this,t,i))},onModifyMode:function(e,t){if(!e)return;const i=this.context.image;i._linkElement=/^A$/i.test(e.parentNode.nodeName)?e.parentNode:null,i._element=e,i._cover=this.util.getParentElement(e,"FIGURE"),i._container=this.util.getParentElement(e,this.util.isMediaComponent),i._caption=this.util.getChildElement(i._cover,"FIGCAPTION"),i._align=e.getAttribute("data-align")||"none",t&&(i._element_w=t.w,i._element_h=t.h,i._element_t=t.t,i._element_l=t.l);let n=i._element.getAttribute("data-size")||i._element.getAttribute("data-origin");n?(n=n.split(","),i._origin_w=n[0],i._origin_h=n[1]):t&&(i._origin_w=t.w,i._origin_h=t.h)},openModify:function(e){const t=this.context.image;t.imgUrlFile.value=t._element.src,t._altText=t.altText.value=t._element.alt,t._linkValue=t.imgLink.value=null===t._linkElement?"":t._linkElement.href,t.imgLinkNewWindowCheck.checked=t._linkElement&&"_blank"===t._linkElement.target,t.modal.querySelector('input[name="suneditor_image_radio"][value="'+t._align+'"]').checked=!0,t._align=t.modal.querySelector('input[name="suneditor_image_radio"]:checked').value,t._captionChecked=t.captionCheckEl.checked=!!t._caption,t._resizing&&this.plugins.resizing._module_setModifyInputSize.call(this,t,this.plugins.image),e||this.plugins.dialog.open.call(this,"image",!0)},on:function(e){if(!e){const e=this.context.image;e.inputX.value=e._origin_w=this.context.option.imageWidth===e._defaultSizeX?"":this.context.option.imageWidth,e.inputY.value=e._origin_h="",e.inputY.disabled=!0,e.proportion.disabled=!0}},sizeRevert:function(){this.plugins.resizing._module_sizeRevert.call(this,this.context.image)},applySize:function(e,t){const i=this.context.image;return e||(e=i.inputX.value),t||(t=i.inputY.value),i._onlyPercentage&&e||/%$/.test(e)?(this.plugins.image.setPercentSize.call(this,e,t),!0):(e&&"auto"!==e||t&&"auto"!==t?this.plugins.image.setSize.call(this,e,t,!1):this.plugins.image.setAutoSize.call(this),!1)},setSize:function(e,t,i){const n=this.context.image;this.plugins.image.cancelPercentAttr.call(this),n._element.style.width=this.util.isNumber(e)?e+n.sizeUnit:e,n._element.style.height=this.util.isNumber(t)?t+n.sizeUnit:/%$/.test(t)?"":t,"center"===n._align&&this.plugins.image.setAlign.call(this,null,null,null,null),i||n._element.removeAttribute("data-percentage"),this.plugins.resizing._module_saveCurrentSize.call(this,n)},setAutoSize:function(){const e=this.context.image;this.plugins.resizing.resetTransform.call(this,e._element),this.plugins.image.cancelPercentAttr.call(this),e._element.style.maxWidth="",e._element.style.width="",e._element.style.height="",e._cover.style.width="",e._cover.style.height="",this.plugins.image.setAlign.call(this,null,null,null,null),e._element.setAttribute("data-percentage","auto,auto"),this.plugins.resizing._module_saveCurrentSize.call(this,e)},setOriginSize:function(){const e=this.context.image;e._element.removeAttribute("data-percentage"),this.plugins.resizing.resetTransform.call(this,e._element),this.plugins.image.cancelPercentAttr.call(this);const t=(e._element.getAttribute("data-origin")||"").split(","),i=t[0],n=t[1];t&&(e._onlyPercentage||/%$/.test(i)&&(/%$/.test(n)||!/\d/.test(n))?this.plugins.image.setPercentSize.call(this,i,n):this.plugins.image.setSize.call(this,i,n),this.plugins.resizing._module_saveCurrentSize.call(this,e))},setPercentSize:function(e,t){const i=this.context.image;t=!t||/%$/.test(t)||this.util.getNumber(t,0)?this.util.isNumber(t)?t+i.sizeUnit:t||"":this.util.isNumber(t)?t+"%":t;const n=/%$/.test(t);i._container.style.width=this.util.isNumber(e)?e+"%":e,i._container.style.height="",i._cover.style.width="100%",i._cover.style.height=n?t:"",i._element.style.width="100%",i._element.style.height=n?"":t,i._element.style.maxWidth="","center"===i._align&&this.plugins.image.setAlign.call(this,null,null,null,null),i._element.setAttribute("data-percentage",e+","+t),this.plugins.resizing.setCaptionPosition.call(this,i._element),this.plugins.resizing._module_saveCurrentSize.call(this,i)},cancelPercentAttr:function(){const e=this.context.image;e._cover.style.width="",e._cover.style.height="",e._container.style.width="",e._container.style.height="",this.util.removeClass(e._container,this.context.image._floatClassRegExp),this.util.addClass(e._container,"__se__float-"+e._align),"center"===e._align&&this.plugins.image.setAlign.call(this,null,null,null,null)},setAlign:function(e,t,i,n){const l=this.context.image;e||(e=l._align),t||(t=l._element),i||(i=l._cover),n||(n=l._container),i.style.margin=e&&"none"!==e?"auto":"0",/%$/.test(t.style.width)&&"center"===e?(n.style.minWidth="100%",i.style.width=n.style.width):(n.style.minWidth="",i.style.width=this.context.resizing._rotateVertical?t.style.height||t.offsetHeight:t.style.width&&"auto"!==t.style.width?t.style.width||"100%":""),this.util.hasClass(n,"__se__float-"+e)||(this.util.removeClass(n,l._floatClassRegExp),this.util.addClass(n,"__se__float-"+e)),t.setAttribute("data-align",e)},resetAlign:function(){const e=this.context.image;e._element.setAttribute("data-align",""),e._align="none",e._cover.style.margin="0",this.util.removeClass(e._container,e._floatClassRegExp)},destroy:function(e){const t=e||this.context.image._element,i=this.util.getParentElement(t,this.util.isMediaComponent)||t,n=1*t.getAttribute("data-index");let l=i.previousElementSibling||i.nextElementSibling;if(this.util.removeItem(i),this.plugins.image.init.call(this),this.controllersOff(),this.focusEdge(l),n>=0){const e=this._variable._imagesInfo;for(let t=0,i=e.length;t<i;t++)if(n===e[t].index)return e.splice(t,1),void this._imageUpload(null,n,"delete",null,0)}this.history.push(!1)},init:function(){const e=this.context.image;e.imgInputFile&&(e.imgInputFile.value=""),e.imgUrlFile&&(e.imgUrlFile.value=""),e.altText.value="",e.imgLink.value="",e.imgLinkNewWindowCheck.checked=!1,e.modal.querySelector('input[name="suneditor_image_radio"][value="none"]').checked=!0,e.captionCheckEl.checked=!1,e._element=null,this.plugins.image.openTab.call(this,"init"),e._resizing&&(e.inputX.value=this.context.option.imageWidth===e._defaultSizeX?"":this.context.option.imageWidth,e.inputY.value="",e.inputX.disabled=!1,e.inputY.disabled=!1,e.proportion.disabled=!1,e.proportion.checked=!0,e._ratio=!1,e._ratioX=1,e._ratioY=1)}},video:{name:"video",display:"dialog",add:function(e){e.addModule([l,s]);const t=e.context;t.video={sizeUnit:t.option._videoSizeUnit,_container:null,_cover:null,_element:null,_element_w:1,_element_h:1,_element_l:0,_element_t:0,_defaultSizeX:"100%",_defaultSizeY:100*t.option.videoRatio+"%",_origin_w:"100%"===t.option.videoWidth?"":t.option.videoWidth,_origin_h:"",_proportionChecked:!0,_align:"none",_floatClassRegExp:"__se__float\\-[a-z]+",_captionShow:!1,_resizing:t.option.videoResizing,_rotation:t.option.videoRotation,_resizeDotHide:!t.option.videoHeightShow,_onlyPercentage:t.option.videoSizeOnlyPercentage,_ratio:!1,_ratioX:1,_ratioY:1,_youtubeQuery:t.option.youtubeQuery,_videoRatio:100*t.option.videoRatio+"%",_defaultRatio:100*t.option.videoRatio+"%"};let i=this.setDialog.call(e);t.video.modal=i,t.video.focusElement=i.querySelector("._se_video_url"),i.querySelector(".se-btn-primary").addEventListener("click",this.submit.bind(e)),t.video.proportion={},t.video.videoRatioOption={},t.video.inputX={},t.video.inputY={},t.option.videoResizing&&(t.video.proportion=i.querySelector("._se_video_check_proportion"),t.video.videoRatioOption=i.querySelector(".se-video-ratio"),t.video.inputX=i.querySelector("._se_video_size_x"),t.video.inputY=i.querySelector("._se_video_size_y"),t.video.inputX.value=t.option.videoWidth,t.video.inputX.addEventListener("keyup",this.setInputSize.bind(e,"x")),t.video.inputY.addEventListener("keyup",this.setInputSize.bind(e,"y")),t.video.inputX.addEventListener("change",this.setRatio.bind(e)),t.video.inputY.addEventListener("change",this.setRatio.bind(e)),t.video.proportion.addEventListener("change",this.setRatio.bind(e)),t.video.videoRatioOption.addEventListener("change",this.setVideoRatio.bind(e)),i.querySelector(".se-dialog-btn-revert").addEventListener("click",this.sizeRevert.bind(e))),t.dialog.modal.appendChild(i),i=null},setDialog:function(){const e=this.context.option,t=this.lang,i=this.util.createElement("DIV");i.className="se-dialog-content",i.style.display="none";let n='<form class="editor_video"><div class="se-dialog-header"><button type="button" data-command="close" class="se-btn se-dialog-close" aria-label="Close" title="'+t.dialogBox.close+'"><i aria-hidden="true" data-command="close" class="se-icon-cancel"></i></button><span class="se-modal-title">'+t.dialogBox.videoBox.title+'</span></div><div class="se-dialog-body"><div class="se-dialog-form"><label>'+t.dialogBox.videoBox.url+'</label><input class="se-input-form _se_video_url" type="text" /></div>';if(e.videoResizing){const i=e.videoRatioList||[{name:"16:9",value:.5625},{name:"4:3",value:.75},{name:"21:9",value:.4285}],l=e.videoRatio,s=e.videoSizeOnlyPercentage,o=s?' style="display: none !important;"':"",a=e.videoHeightShow?"":' style="display: none !important;"',r=e.videoRatioShow?"":' style="display: none !important;"',c=s||e.videoHeightShow||e.videoRatioShow?"":' style="display: none !important;"';n+='<div class="se-dialog-form"><div class="se-dialog-size-text"><label class="size-w">'+t.dialogBox.width+'</label><label class="se-dialog-size-x">&nbsp;</label><label class="size-h"'+a+">"+t.dialogBox.height+'</label><label class="size-h"'+r+">("+t.dialogBox.ratio+')</label></div><input class="se-input-control _se_video_size_x" placeholder="100%"'+(s?' type="number" min="1"':'type="text"')+(s?' max="100"':"")+'/><label class="se-dialog-size-x"'+c+">"+(s?"%":"x")+'</label><input class="se-input-control _se_video_size_y" placeholder="'+100*e.videoRatio+'%"'+(s?' type="number" min="1"':'type="text"')+(s?' max="100"':"")+a+'/><select class="se-input-select se-video-ratio" title="'+t.dialogBox.ratio+'"'+r+">",a||(n+='<option value=""> - </option>');for(let e=0,t=i.length;e<t;e++)n+='<option value="'+i[e].value+'"'+(l.toString()===i[e].value.toString()?" selected":"")+">"+i[e].name+"</option>";n+='</select><button type="button" title="'+t.dialogBox.revertButton+'" class="se-btn se-dialog-btn-revert" style="float: right;"><i class="se-icon-revert"></i></button></div><div class="se-dialog-form se-dialog-form-footer"'+o+c+'><label><input type="checkbox" class="se-dialog-btn-check _se_video_check_proportion" checked/>&nbsp;'+t.dialogBox.proportion+"</label></div>"}return n+='</div><div class="se-dialog-footer"><div><label><input type="radio" name="suneditor_video_radio" class="se-dialog-btn-radio" value="none" checked>'+t.dialogBox.basic+'</label><label><input type="radio" name="suneditor_video_radio" class="se-dialog-btn-radio" value="left">'+t.dialogBox.left+'</label><label><input type="radio" name="suneditor_video_radio" class="se-dialog-btn-radio" value="center">'+t.dialogBox.center+'</label><label><input type="radio" name="suneditor_video_radio" class="se-dialog-btn-radio" value="right">'+t.dialogBox.right+'</label></div><button type="submit" class="se-btn-primary" title="'+t.dialogBox.submitButton+'"><span>'+t.dialogBox.submitButton+"</span></button></div></form>",i.innerHTML=n,i},open:function(){this.plugins.dialog.open.call(this,"video","video"===this.currentControllerName)},setVideoRatio:function(e){const t=this.context.video,i=e.target.options[e.target.selectedIndex].value;t._defaultSizeY=t._videoRatio=i?100*i+"%":t._defaultSizeY,t.inputY.placeholder=i?100*i+"%":"",t.inputY.value=""},setInputSize:function(e,t){if(t&&32===t.keyCode)return void t.preventDefault();const i=this.context.video;this.plugins.resizing._module_setInputSize.call(this,i,e),"y"===e&&this.plugins.video.setVideoRatioSelect.call(this,t.target.value||i._videoRatio)},setRatio:function(){this.plugins.resizing._module_setRatio.call(this,this.context.video)},_onload_video:function(e){this.plugins.video.setVideosInfo.call(this,e)},submitAction:function(){if(0===this.context.video.focusElement.value.trim().length)return!1;this.context.resizing._resize_plugin="video";const e=this.context.video;let t=null,i=null,n=null,l=e.focusElement.value.trim();if(e._align=e.modal.querySelector('input[name="suneditor_video_radio"]:checked').value,/^<iframe.*\/iframe>$/.test(l))t=(new this._w.DOMParser).parseFromString(l,"text/html").querySelector("iframe");else{if(t=this.util.createElement("IFRAME"),/youtu\.?be/.test(l)&&(/^http/.test(l)||(l="https://"+l),l=l.replace("watch?v=",""),/^\/\/.+\/embed\//.test(l)||(l=l.replace(l.match(/\/\/.+\//)[0],"//www.youtube.com/embed/").replace("&","?&")),e._youtubeQuery.length>0))if(/\?/.test(l)){const t=l.split("?");l=t[0]+"?"+e._youtubeQuery+"&"+t[1]}else l+="?"+e._youtubeQuery;t.src=l}this.context.dialog.updateModal?(e._element.src!==t.src&&(e._element.src=t.src),n=e._container,i=this.util.getParentElement(e._element,"FIGURE"),t=e._element):(t.frameBorder="0",t.allowFullscreen=!0,t.addEventListener("load",this.plugins.video._onload_video.bind(this,t)),e._element=t,i=this.plugins.resizing.set_cover.call(this,t),n=this.plugins.resizing.set_container.call(this,i,"se-video-container"),this._variable._videosCnt++),e._cover=i,e._container=n;const s=this.plugins.resizing._module_getSizeX.call(this,e)!==(e.inputX.value||e._defaultSizeX)||this.plugins.resizing._module_getSizeY.call(this,e)!==(e.inputY.value||e._videoRatio),o=!this.context.dialog.updateModal||s;e._resizing&&(this.context.video._proportionChecked=e.proportion.checked,t.setAttribute("data-proportion",e._proportionChecked));let a=!1;o&&(a=this.plugins.video.applySize.call(this)),a&&"center"===e._align||this.plugins.video.setAlign.call(this,null,t,i,n),this.context.dialog.updateModal?e._resizing&&this.context.resizing._rotateVertical&&o&&this.plugins.resizing.setTransformSize.call(this,t,null,null):this.insertComponent(n,!1),this.context.resizing._resize_plugin="",this.context.dialog.updateModal&&this.history.push(!1)},setVideosInfo:function(e){if(!e.getAttribute("data-origin")){const t=this.util.getParentElement(e,this.util.isMediaComponent),i=this.util.getParentElement(e,"FIGURE"),n=this.plugins.resizing._module_getSizeX.call(this,this.context.video,e,i,t),l=this.plugins.resizing._module_getSizeY.call(this,this.context.video,e,i,t);e.setAttribute("data-origin",n+","+l),e.setAttribute("data-size",n+","+l)}},submit:function(e){this.showLoading(),e.preventDefault(),e.stopPropagation();try{this.plugins.video.submitAction.call(this)}finally{this.plugins.dialog.close.call(this),this.closeLoading()}return this.focus(),!1},_update_videoCover:function(e){if(!e)return;const t=this.context.video;e.frameBorder="0",e.allowFullscreen=!0,e.onload=e.addEventListener("load",this.plugins.video._onload_video.bind(this,e));const i=this.util.getParentElement(e,this.util.isMediaComponent)||this.util.getParentElement(e,function(e){return this.isWysiwygDiv(e.parentNode)}.bind(this.util));t._element=e=e.cloneNode(!1);const n=t._cover=this.plugins.resizing.set_cover.call(this,e),l=t._container=this.plugins.resizing.set_container.call(this,n,"se-video-container"),s=i.querySelector("figcaption");let o=null;s&&(o=this.util.createElement("DIV"),o.innerHTML=s.innerHTML,this.util.removeItem(s));const a=(e.getAttribute("data-size")||e.getAttribute("data-origin")||"").split(",");this.plugins.video.applySize.call(this,a[0]||this.context.option.videoWidth,a[1]||""),i.parentNode.replaceChild(l,i),o&&i.parentNode.insertBefore(o,l.nextElementSibling)},onModifyMode:function(e,t){const i=this.context.video;i._element=e,i._cover=this.util.getParentElement(e,"FIGURE"),i._container=this.util.getParentElement(e,this.util.isMediaComponent),i._align=e.getAttribute("data-align")||"none",i._element_w=t.w,i._element_h=t.h,i._element_t=t.t,i._element_l=t.l;let n=i._element.getAttribute("data-size")||i._element.getAttribute("data-origin");n?(n=n.split(","),i._origin_w=n[0],i._origin_h=n[1]):(i._origin_w=t.w,i._origin_h=t.h)},openModify:function(e){const t=this.context.video;if(t.focusElement.value=t._element.src,t.modal.querySelector('input[name="suneditor_video_radio"][value="'+t._align+'"]').checked=!0,t._resizing){this.plugins.resizing._module_setModifyInputSize.call(this,t,this.plugins.video);const e=t._videoRatio=this.plugins.resizing._module_getSizeY.call(this,t);this.plugins.video.setVideoRatioSelect.call(this,e)||(t.inputY.value=t._onlyPercentage?this.util.getNumber(e,2):e)}e||this.plugins.dialog.open.call(this,"video",!0)},on:function(e){if(!e){const e=this.context.video;e.inputX.value=e._origin_w=this.context.option.videoWidth===e._defaultSizeX?"":this.context.option.videoWidth,e.inputY.value=e._origin_h="",e.proportion.disabled=!0}},setVideoRatioSelect:function(e){let t=!1;const i=this.context.video,n=i.videoRatioOption.options;/%$/.test(e)||i._onlyPercentage?e=this.util.getNumber(e,2)/100+"":(!this.util.isNumber(e)||1*e>=1)&&(e=""),i.inputY.placeholder="";for(let l=0,s=n.length;l<s;l++)n[l].value===e?(t=n[l].selected=!0,i.inputY.placeholder=e?100*e+"%":""):n[l].selected=!1;return t},checkVideosInfo:function(){const e=this.context.element.wysiwyg.getElementsByTagName("IFRAME");if(e.length===this._variable._videosCnt)return;this.context.resizing._resize_plugin="video";const t=this.plugins.video;this._variable._videosCnt=e.length;for(let i,n,l=0,s=this._variable._videosCnt;l<s;l++)i=e[l],n=this.util.getParentElement(i,this.util.isMediaComponent),(!n||n.getElementsByTagName("figcaption").length>0||!i.style.width)&&t._update_videoCover.call(this,i);this.context.resizing._resize_plugin=""},sizeRevert:function(){this.plugins.resizing._module_sizeRevert.call(this,this.context.video)},applySize:function(e,t){const i=this.context.video;return e||(e=i.inputX.value),t||(t=i.inputY.value),i._onlyPercentage||/%$/.test(e)||!e?(this.plugins.video.setPercentSize.call(this,e||"100%",t||i._videoRatio),!0):(e&&"auto"!==e||t&&"auto"!==t?this.plugins.video.setSize.call(this,e,t||i._defaultRatio,!1):this.plugins.video.setAutoSize.call(this),!1)},setSize:function(e,t,i){const n=this.context.video;e=this.util.getNumber(e,0),t=this.util.isNumber(t)?t+n.sizeUnit:t||"",n._element.style.width=e?e+n.sizeUnit:"",n._cover.style.paddingBottom=n._cover.style.height=t,/%$/.test(t)?n._element.style.height="":n._element.style.height=t,i||n._element.removeAttribute("data-percentage"),this.plugins.resizing._module_saveCurrentSize.call(this,n)},setAutoSize:function(){this.plugins.video.setPercentSize.call(this,100,this.context.video._defaultRatio)},setOriginSize:function(e){const t=this.context.video;t._element.removeAttribute("data-percentage"),this.plugins.resizing.resetTransform.call(this,t._element),this.plugins.video.cancelPercentAttr.call(this);const i=((e?t._element.getAttribute("data-size"):"")||t._element.getAttribute("data-origin")||"").split(",");if(i){const e=i[0],n=i[1];t._onlyPercentage||/%$/.test(e)&&(/%$/.test(n)||!/\d/.test(n))?this.plugins.video.setPercentSize.call(this,e,n):this.plugins.video.setSize.call(this,e,n),this.plugins.resizing._module_saveCurrentSize.call(this,t)}},setPercentSize:function(e,t){const i=this.context.video;t=!t||/%$/.test(t)||this.util.getNumber(t,0)?this.util.isNumber(t)?t+i.sizeUnit:t||i._videoRatio:this.util.isNumber(t)?t+"%":t,i._container.style.width=this.util.isNumber(e)?e+"%":e,i._container.style.height="",i._cover.style.width="100%",i._cover.style.height=t,i._cover.style.paddingBottom=t,i._element.style.width="100%",i._element.style.height="100%",i._element.style.maxWidth="","center"===i._align&&this.plugins.video.setAlign.call(this,null,null,null,null),i._element.setAttribute("data-percentage",e+","+t),this.plugins.resizing._module_saveCurrentSize.call(this,i)},cancelPercentAttr:function(){const e=this.context.video;e._cover.style.width="",e._cover.style.height="",e._cover.style.paddingBottom="",e._container.style.width="",e._container.style.height="",this.util.removeClass(e._container,this.context.video._floatClassRegExp),this.util.addClass(e._container,"__se__float-"+e._align),"center"===e._align&&this.plugins.video.setAlign.call(this,null,null,null,null)},setAlign:function(e,t,i,n){const l=this.context.video;e||(e=l._align),t||(t=l._element),i||(i=l._cover),n||(n=l._container),i.style.margin=e&&"none"!==e?"auto":"0",/%$/.test(t.style.width)&&"center"===e?(n.style.minWidth="100%",i.style.width=n.style.width,i.style.height=i.style.paddingBottom,i.style.paddingBottom=this.util.getNumber(this.util.getNumber(i.style.paddingBottom,2)/100*this.util.getNumber(i.style.width,2),2)+"%"):(n.style.minWidth="",i.style.width=this.context.resizing._rotateVertical?t.style.height||t.offsetHeight:t.style.width||"100%",i.style.paddingBottom=i.style.height),this.util.hasClass(n,"__se__float-"+e)||(this.util.removeClass(n,l._floatClassRegExp),this.util.addClass(n,"__se__float-"+e)),t.setAttribute("data-align",e)},resetAlign:function(){const e=this.context.video;e._element.setAttribute("data-align",""),e._align="none",e._cover.style.margin="0",this.util.removeClass(e._container,e._floatClassRegExp)},destroy:function(){this._variable._videosCnt--;const e=this.context.video._container;let t=e.previousElementSibling||e.nextElementSibling;this.util.removeItem(e),this.plugins.video.init.call(this),this.controllersOff(),this.focusEdge(t),this.history.push(!1)},init:function(){const e=this.context.video;e.focusElement.value="",e._origin_w=this.context.option.videoWidth,e._origin_h="",e.modal.querySelector('input[name="suneditor_video_radio"][value="none"]').checked=!0,e._resizing&&(e.inputX.value=this.context.option.videoWidth===e._defaultSizeX?"":this.context.option.videoWidth,e.inputY.value="",e.proportion.checked=!0,e.proportion.disabled=!0,this.plugins.video.setVideoRatioSelect.call(this,e._defaultRatio))}},math:{name:"math",display:"dialog",add:function(e){e.addModule([l]);const t=e.context;t.math={focusElement:null,previewElement:null,fontSizeElement:null,_mathExp:null,_renderer:null};let i=this.setDialog.call(e);t.math.modal=i,t.math.focusElement=i.querySelector(".se-math-exp"),t.math.previewElement=i.querySelector(".se-math-preview"),t.math.fontSizeElement=i.querySelector(".se-math-size"),t.math._renderer=function(e){return this.src.renderToString(e,this.options)}.bind(e.context.option.katex),t.math.focusElement.addEventListener("keyup",this._renderMathExp.bind(t.math),!1),t.math.focusElement.addEventListener("change",this._renderMathExp.bind(t.math),!1),t.math.fontSizeElement.addEventListener("change",function(e){this.fontSize=e.target.value}.bind(t.math.previewElement.style),!1);let n=this.setController_MathButton.call(e);t.math.mathBtn=n,t.math._mathExp=null,n.addEventListener("mousedown",(function(e){e.stopPropagation()}),!1),i.querySelector(".se-btn-primary").addEventListener("click",this.submit.bind(e),!1),n.addEventListener("click",this.onClick_mathBtn.bind(e)),t.dialog.modal.appendChild(i),t.element.relative.appendChild(n),i=null,n=null},setDialog:function(){const e=this.lang,t=this.util.createElement("DIV");return t.className="se-dialog-content",t.style.display="none",t.innerHTML='<form class="editor_math"><div class="se-dialog-header"><button type="button" data-command="close" class="se-btn se-dialog-close" aria-label="Close" title="'+e.dialogBox.close+'"><i aria-hidden="true" data-command="close" class="se-icon-cancel"></i></button><span class="se-modal-title">'+e.dialogBox.mathBox.title+'</span></div><div class="se-dialog-body"><div class="se-dialog-form"><label>'+e.dialogBox.mathBox.inputLabel+' (<a href="https://katex.org/docs/supported.html" target="_blank">KaTeX</a>)</label><textarea class="se-input-form se-math-exp" type="text"></textarea></div><div class="se-dialog-form"><label>'+e.dialogBox.mathBox.fontSizeLabel+'</label><select class="se-input-select se-math-size"><option value="1em">1</option><option value="1.5em">1.5</option><option value="2em">2</option><option value="2.5em">2.5</option></select></div><div class="se-dialog-form"><label>'+e.dialogBox.mathBox.previewLabel+'</label><p class="se-math-preview"></p></div></div><div class="se-dialog-footer"><button type="submit" class="se-btn-primary" title="'+e.dialogBox.submitButton+'"><span>'+e.dialogBox.submitButton+"</span></button></div></form>",t},setController_MathButton:function(){const e=this.lang,t=this.util.createElement("DIV");return t.className="se-controller se-controller-link",t.innerHTML='<div class="se-arrow se-arrow-up"></div><div class="link-content"><div class="se-btn-group"><button type="button" data-command="update" tabindex="-1" class="se-tooltip"><i class="se-icon-edit"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.edit+'</span></span></button><button type="button" data-command="delete" tabindex="-1" class="se-tooltip"><i class="se-icon-delete"></i><span class="se-tooltip-inner"><span class="se-tooltip-text">'+e.controller.remove+"</span></span></button></div></div>",t},open:function(){this.plugins.dialog.open.call(this,"math","math"===this.currentControllerName)},_renderMathExp:function(e){this.previewElement.innerHTML=this._renderer(e.target.value)},submit:function(e){this.showLoading(),e.preventDefault(),e.stopPropagation();const t=function(){if(0===this.context.math.focusElement.value.trim().length)return!1;const e=this.context.math,t=e.focusElement.value,i=e.previewElement.querySelector(".katex");if(!i)return!1;if(i.setAttribute("contenteditable",!1),i.setAttribute("data-exp",t),i.setAttribute("data-font-size",e.fontSizeElement.value),i.style.fontSize=e.fontSizeElement.value,this.context.dialog.updateModal){const t=function(e,i){if(e.classList.contains(i))return e;const n=e.parentNode;return n!==document.body?n.classList.contains(i)?n:void t(n,i):void 0},n=t(e._mathExp,"katex");n.parentNode.replaceChild(i,n),this.setRange(i,0,i,1)}else{const e=this.getSelectedElements();if(e.length>1){const t=this.util.createElement(e[0].nodeName);t.appendChild(i),this.insertNode(t)}else this.insertNode(i);const t=this.util.createTextNode(this.util.zeroWidthSpace);i.parentNode.insertBefore(t,i.nextSibling),this.setRange(i,0,i,1)}return e.focusElement.value="",e.fontSizeElement.value="1em",e.previewElement.style.fontSize="1em",e.previewElement.innerHTML="",!0}.bind(this);try{t()&&(this.plugins.dialog.close.call(this),this.history.push(!1))}catch(e){this.plugins.dialog.close.call(this)}finally{this.closeLoading()}return!1},active:function(e){if(e){if(e.getAttribute("data-exp"))return this.controllerArray[0]!==this.context.math.mathBtn&&(this.setRange(e,0,e,1),this.plugins.math.call_controller_mathButton.call(this,e)),!0}else this.controllerArray[0]===this.context.math.mathBtn&&this.controllersOff();return!1},on:function(e){const t=this.context.math;if(t._mathExp&&e){const e=t._mathExp.getAttribute("data-exp"),i=t._mathExp.getAttribute("data-font-size")||"1em";this.context.dialog.updateModal=!0,t.focusElement.value=e,t.fontSizeElement.value=i,t.previewElement.innerHTML=t._renderer(e),t.previewElement.style.fontSize=i}},call_controller_mathButton:function(e){this.context.math._mathExp=e;const t=this.context.math.mathBtn,i=this.util.getOffset(e,this.context.element.wysiwygFrame);t.style.top=i.top+e.offsetHeight+10+"px",t.style.left=i.left-this.context.element.wysiwygFrame.scrollLeft+"px",t.style.display="block";const n=this.context.element.wysiwygFrame.offsetWidth-(t.offsetLeft+t.offsetWidth);n<0?(t.style.left=t.offsetLeft+n+"px",t.firstElementChild.style.left=20-n+"px"):t.firstElementChild.style.left="20px",this.controllersOn(t,this.plugins.math.init.bind(this),"math")},onClick_mathBtn:function(e){e.stopPropagation();const t=e.target.getAttribute("data-command")||e.target.parentNode.getAttribute("data-command");t&&(e.preventDefault(),/update/.test(t)?(this.context.math.focusElement.value=this.context.math._mathExp.getAttribute("data-exp"),this.plugins.dialog.open.call(this,"math",!0)):(this.util.removeItem(this.context.math._mathExp),this.context.math._mathExp=null,this.focus(),this.history.push(!1)),this.controllersOff())},init:function(){if(!/math/i.test(this.context.dialog.kind)){const e=this.context.math;e.mathBtn.style.display="none",e._mathExp=null,e.focusElement.value="",e.previewElement.innerHTML=""}}}},r=i("P6u4"),c=i.n(r);const d={_d:document,_w:window,_tagConvertor:function(e){const t={b:"strong",i:"em",u:"ins",strike:"del",s:"del"};return e.replace(/(<\/?)(b|strong|i|em|u|ins|s|strike|del)\b\s*(?:[^>^<]+)?\s*(?=>)/gi,(function(e,i,n){return i+("string"==typeof t[n]?t[n]:n)}))},_HTMLConvertor:function(e){const t={"&":"&amp;","":"&nbsp;","'":"&quot;","<":"&lt;",">":"&gt;"};return e.replace(/&|\u00A0|'|<|>/g,(function(e){return"string"==typeof t[e]?t[e]:e}))},zeroWidthSpace:"",zeroWidthRegExp:new RegExp(String.fromCharCode(8203),"g"),onlyZeroWidthRegExp:new RegExp("^"+String.fromCharCode(8203)+"+$"),onlyZeroWidthSpace:function(e){return"string"!=typeof e&&(e=e.textContent),""===e||this.onlyZeroWidthRegExp.test(e)},getXMLHttpRequest:function(){if(!this._w.ActiveXObject)return this._w.XMLHttpRequest?new XMLHttpRequest:null;try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return null}}},createElement:function(e){return this._d.createElement(e)},createTextNode:function(e){return this._d.createTextNode(e||"")},getIncludePath:function(e,t){let i="";const n=[],l="js"===t?"script":"link",s="js"===t?"src":"href";let o="(?:";for(let t=0,i=e.length;t<i;t++)o+=e[t]+(t<i-1?"|":")");const a=new this._w.RegExp("(^|.*[\\/])"+o+"(\\.[^\\/]+)?."+t+"(?:\\?.*|;.*)?$","i"),r=new this._w.RegExp(".+\\."+t+"(?:\\?.*|;.*)?$","i");for(let e=this._d.getElementsByTagName(l),t=0;t<e.length;t++)r.test(e[t][s])&&n.push(e[t]);for(let e=0;e<n.length;e++){let t=n[e][s].match(a);if(t){i=t[0];break}}if(""===i&&(i=n.length>0?n[0][s]:""),-1===i.indexOf(":/")&&"//"!==i.slice(0,2)&&(i=0===i.indexOf("/")?location.href.match(/^.*?:\/\/[^\/]*/)[0]+i:location.href.match(/^[^\?]*\/(?:)/)[0]+i),!i)throw"[SUNEDITOR.util.getIncludePath.fail] The SUNEDITOR installation path could not be automatically detected. (name: +"+name+", extension: "+t+")";return i},getPageStyle:function(e){let t="";const i=(e?this.getIframeDocument(e):this._d).styleSheets;for(let e,n=0,l=i.length;n<l;n++){try{e=i[n].cssRules}catch(e){continue}for(let i=0,n=e.length;i<n;i++)t+=e[i].cssText}return t},getIframeDocument:function(e){let t=e.contentWindow||e.contentDocument;return t.document&&(t=t.document),t},getAttributesToString:function(e,t){if(!e.attributes)return"";const i=e.attributes;let n="";for(let e=0,l=i.length;e<l;e++)t&&t.indexOf(i[e].name)>-1||(n+=i[e].name+'="'+i[e].value+'" ');return n},isWysiwygDiv:function(e){return!(!e||1!==e.nodeType||!this.hasClass(e,"se-wrapper-wysiwyg")&&!/^BODY$/i.test(e.nodeName))},isFormatElement:function(e){return!(!e||1!==e.nodeType||!/^(P|DIV|H[1-6]|PRE|LI)$/i.test(e.nodeName)&&!this.hasClass(e,"(\\s|^)__se__format__replace_.+(\\s|$)|(\\s|^)__se__format__free_.+(\\s|$)")||this.isComponent(e)||this.isWysiwygDiv(e))},isRangeFormatElement:function(e){return!(!e||1!==e.nodeType||!/^(BLOCKQUOTE|OL|UL|FIGCAPTION|TABLE|THEAD|TBODY|TR|TH|TD)$/i.test(e.nodeName)&&!this.hasClass(e,"(\\s|^)__se__format__range_.+(\\s|$)"))},isFreeFormatElement:function(e){return!(!e||1!==e.nodeType||!/^PRE$/i.test(e.nodeName)&&!this.hasClass(e,"(\\s|^)__se__format__free_.+(\\s|$)")||this.isComponent(e)||this.isWysiwygDiv(e))},isComponent:function(e){return e&&(/se-component/.test(e.className)||/^(TABLE|HR)$/.test(e.nodeName))},isMediaComponent:function(e){return e&&/se-component/.test(e.className)},getFormatElement:function(e,t){if(!e)return null;for(t||(t=function(){return!0});e;){if(this.isWysiwygDiv(e))return null;if(this.isRangeFormatElement(e)&&e.firstElementChild,this.isFormatElement(e)&&t(e))return e;e=e.parentNode}return null},getRangeFormatElement:function(e,t){if(!e)return null;for(t||(t=function(){return!0});e;){if(this.isWysiwygDiv(e))return null;if(this.isRangeFormatElement(e)&&!/^(THEAD|TBODY|TR)$/i.test(e.nodeName)&&t(e))return e;e=e.parentNode}return null},getFreeFormatElement:function(e,t){if(!e)return null;for(t||(t=function(){return!0});e;){if(this.isWysiwygDiv(e))return null;if(this.isFreeFormatElement(e)&&t(e))return e;e=e.parentNode}return null},copyTagAttributes:function(e,t){t.style.cssText&&(e.style.cssText+=t.style.cssText);const i=t.classList;for(let t=0,n=i.length;t<n;t++)this.addClass(e,i[t]);e.style.cssText||e.removeAttribute("style"),e.className.trim()||e.removeAttribute("class")},copyFormatAttributes:function(e,t){(t=t.cloneNode(!1)).className=t.className.replace(/(\s|^)__se__format__[^\s]+/g,""),this.copyTagAttributes(e,t)},getArrayItem:function(e,t,i){if(!e||0===e.length)return null;t=t||function(){return!0};const n=[];for(let l,s=0,o=e.length;s<o;s++)if(l=e[s],t(l)){if(!i)return l;n.push(l)}return i?n:null},getArrayIndex:function(e,t){let i=-1;for(let n=0,l=e.length;n<l;n++)if(e[n]===t){i=n;break}return i},nextIdx:function(e,t){let i=this.getArrayIndex(e,t);return-1===i?-1:i+1},prevIdx:function(e,t){let i=this.getArrayIndex(e,t);return-1===i?-1:i-1},getPositionIndex:function(e){let t=0;for(;e=e.previousSibling;)t+=1;return t},getNodePath:function(e,t,i){const n=[];let l=!0;return this.getParentElement(e,function(e){if(e===t&&(l=!1),l&&!this.isWysiwygDiv(e)){if(i&&3===e.nodeType){let t=null,n=null;i.s=i.e=0;let l=e.previousSibling;for(;l&&3===l.nodeType;)n=l.textContent.replace(this.zeroWidthRegExp,""),i.s+=n.length,e.textContent=n+e.textContent,t=l,l=l.previousSibling,this.removeItem(t);let s=e.nextSibling;for(;s&&3===s.nodeType;)n=s.textContent.replace(this.zeroWidthRegExp,""),i.e+=n.length,e.textContent+=n,t=s,s=s.nextSibling,this.removeItem(t)}n.push(e)}return!1}.bind(this)),n.map(this.getPositionIndex).reverse()},getNodeFromPath:function(e,t){let i,n=t;for(let t=0,l=e.length;t<l&&(i=n.childNodes,0!==i.length);t++)n=i.length<=e[t]?i[i.length-1]:i[e[t]];return n},isSameAttributes:function(e,t){if(3===e.nodeType&&3===t.nodeType)return!0;if(3===e.nodeType||3===t.nodeType)return!1;const i=e.style,n=t.style;let l=0;for(let e=0,t=i.length;e<t;e++)i[i[e]]===n[i[e]]&&l++;const s=e.classList,o=t.classList,a=this._w.RegExp;let r=0;for(let e=0,t=s.length;e<t;e++)a("(s|^)"+s[e]+"(s|$)").test(o.value)&&r++;return l===n.length&&r===o.length},isList:function(e){return e&&/^(OL|UL)$/i.test("string"==typeof e?e:e.nodeName)},isListCell:function(e){return e&&/^LI$/i.test("string"==typeof e?e:e.nodeName)},isTable:function(e){return e&&/^(TABLE|THEAD|TBODY|TR|TH|TD)$/i.test("string"==typeof e?e:e.nodeName)},isCell:function(e){return e&&/^(TD|TH)$/i.test("string"==typeof e?e:e.nodeName)},isBreak:function(e){return e&&/^BR$/i.test("string"==typeof e?e:e.nodeName)},isAnchor:function(e){return e&&/^A$/i.test("string"==typeof e?e:e.nodeName)},isNumber:function(e){return!!e&&/^-?\d+(\.\d+)?$/.test(e+"")},getNumber:function(e,t){if(!e)return null;let i=(e+"").match(/-?\d+(\.\d+)?/);return i&&i[0]?(i=i[0],t<0?1*i:0===t?this._w.Math.round(1*i):1*(1*i).toFixed(t)):null},getListChildren:function(e,t){const i=[];return e&&e.children&&0!==e.children.length?(t=t||function(){return!0},function n(l){e!==l&&t(l)&&i.push(l);for(let e=0,t=l.children.length;e<t;e++)n(l.children[e])}(e),i):i},getListChildNodes:function(e,t){const i=[];return e&&0!==e.childNodes.length?(t=t||function(){return!0},function n(l){e!==l&&t(l)&&i.push(l);for(let e=0,t=l.childNodes.length;e<t;e++)n(l.childNodes[e])}(e),i):i},getElementDepth:function(e){if(!e||this.isWysiwygDiv(e))return-1;let t=0;for(e=e.parentNode;e&&!this.isWysiwygDiv(e);)t+=1,e=e.parentNode;return t},getParentElement:function(e,t){let i;if("function"==typeof t)i=t;else{let e;/^\./.test(t)?(e="className",t=t.split(".")[1]):/^#/.test(t)?(e="id",t="^"+t.split("#")[1]+"$"):/^:/.test(t)?(e="name",t="^"+t.split(":")[1]+"$"):(e="nodeName",t="^"+t+"$");const n=new this._w.RegExp(t,"i");i=function(t){return n.test(t[e])}}for(;e&&!i(e);){if(this.isWysiwygDiv(e))return null;e=e.parentNode}return e},getChildElement:function(e,t,i){let n;if("function"==typeof t)n=t;else{let e;/^\./.test(t)?(e="className",t=t.split(".")[1]):/^#/.test(t)?(e="id",t="^"+t.split("#")[1]+"$"):/^:/.test(t)?(e="name",t="^"+t.split(":")[1]+"$"):(e="nodeName",t="^"+("text"===t?"#"+t:t)+"$");const i=new this._w.RegExp(t,"i");n=function(t){return i.test(t[e])}}const l=this.getListChildNodes(e,(function(e){return n(e)}));return l[i?l.length-1:0]},getEdgeChildNodes:function(e,t){if(e){for(t||(t=e);e&&1===e.nodeType&&e.childNodes.length>0&&!this.isBreak(e);)e=e.firstChild;for(;t&&1===t.nodeType&&t.childNodes.length>0&&!this.isBreak(t);)t=t.lastChild;return{sc:e,ec:t||e}}},getOffset:function(e,t){let i=0,n=0,l=3===e.nodeType?e.parentElement:e;const s=this.getParentElement(e,this.isWysiwygDiv.bind(this));for(;l&&!this.hasClass(l,"se-container")&&l!==s;)i+=l.offsetLeft,n+=l.offsetTop,l=l.offsetParent;const o=t&&/iframe/i.test(t.nodeName);return{left:i+(o?t.parentElement.offsetLeft:0),top:n-s.scrollTop+(o?t.parentElement.offsetTop:0)}},getOverlapRangeAtIndex:function(e,t,i,n){if(e<=n?t<i:t>i)return 0;const l=(e>i?e:i)-(t<n?t:n);return(l<0?-1*l:l)+1},changeTxt:function(e,t){e&&t&&(e.textContent=t)},setStyle:function(e,t,i){e.style[t]=i,i||e.style.cssText||e.removeAttribute("style")},hasClass:function(e,t){if(e)return new this._w.RegExp(t).test(e.className)},addClass:function(e,t){if(!e)return;new this._w.RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className)||(e.className+=(e.className.length>0?" ":"")+t)},removeClass:function(e,t){if(!e)return;const i=new this._w.RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(i," ").trim(),e.className.trim()||e.removeAttribute("class")},toggleClass:function(e,t){if(!e)return;const i=new this._w.RegExp("(\\s|^)"+t+"(\\s|$)");i.test(e.className)?e.className=e.className.replace(i," ").trim():e.className+=" "+t,e.className.trim()||e.removeAttribute("class")},removeItem:function(e){if(e)try{e.remove()}catch(t){e.parentNode.removeChild(e)}},removeItemAllParents:function(e,t,i){if(!e)return null;let n=null;return t||(t=function(e){if(e===i||this.isComponent(e))return!1;const t=e.textContent.trim();return 0===t.length||/^(\n|\u200B)+$/.test(t)}.bind(this)),function e(i){if(!d.isWysiwygDiv(i)){const l=i.parentNode;l&&t(i)&&(n={sc:i.previousElementSibling,ec:i.nextElementSibling},d.removeItem(i),e(l))}}(e),n},detachNestedList:function(e,t){const i=this.__deleteNestedList(e);let n,l,s;if(i){n=i.cloneNode(!1),l=i.childNodes;const t=this.getPositionIndex(e);for(;l[t];)n.appendChild(l[t])}else n=e;if(t)s=this.getListChildren(n,function(e){return this.isListCell(e)&&!e.previousElementSibling}.bind(this));else{const t=this.getElementDepth(e)+2;s=this.getListChildren(e,function(e){return this.isListCell(e)&&!e.previousElementSibling&&this.getElementDepth(e)===t}.bind(this))}for(let e=0,t=s.length;e<t;e++)this.__deleteNestedList(s[e]);return i&&(i.parentNode.insertBefore(n,i.nextSibling),l&&0===l.length&&this.removeItem(i)),n===e?n.parentNode:n},__deleteNestedList:function(e){const t=e.parentNode;let i,n,l,s,o,a=t,r=a.parentNode;for(;this.isListCell(r);){for(s=this.getPositionIndex(e),i=r.nextElementSibling,n=r.parentNode,l=a;l;){if(a=a.nextSibling,this.isList(l)){for(o=l.childNodes;o[s];)n.insertBefore(o[s],i);0===o.length&&this.removeItem(l)}else n.appendChild(l);l=a}a=n,r=n.parentNode}return 0===t.children.length&&this.removeItem(t),n},splitElement:function(e,t,i){const n=e.parentNode;let l,s,o,a=0,r=!0;if((!i||i<0)&&(i=0),3===e.nodeType){if(a=this.getPositionIndex(e),t>=0){e.splitText(t);const i=this.getNodeFromPath([a+1],n);this.onlyZeroWidthSpace(i)&&(i.data=this.zeroWidthSpace)}}else 1===e.nodeType&&(e.previousSibling?e=e.previousSibling:this.getElementDepth(e)===i&&(r=!1));let c=e;for(;this.getElementDepth(c)>i;)for(a=this.getPositionIndex(c)+1,c=c.parentNode,o=l,l=c.cloneNode(!1),s=c.childNodes,o&&(this.isListCell(l)&&this.isList(o)&&o.firstElementChild&&(l.innerHTML=o.firstElementChild.innerHTML,d.removeItem(o.firstElementChild),o.children.length>0&&l.appendChild(o)),l.appendChild(o));s[a];)l.appendChild(s[a]);const u=c.parentNode;return r&&(c=c.nextSibling),l?(this.mergeSameTags(l,null,null,!1),this.mergeNestedTags(l,function(e){return this.isList(e)}.bind(this)),l.childNodes.length>0?u.insertBefore(l,c):l=c,0===n.childNodes.length&&this.removeItem(n),l):c},mergeSameTags:function(e,t,i,n){const l=this,s={a:0,b:0};return function e(o,a,r,c,d){const u=o.childNodes;for(let h,p,g=0,m=u.length;g<m&&(h=u[g],p=u[g+1],h);g++)if(!(n&&l._isIgnoreNodeChange(h)||!n&&(l.isTable(h)||l.isListCell(h)||l.isFormatElement(h)&&!l.isFreeFormatElement(h)))){if(1===m&&o.nodeName===h.nodeName&&o.parentNode&&(l.copyTagAttributes(h,o),o.parentNode.insertBefore(h,o),l.removeItem(o),t&&t[a]===g&&(t.splice(a,1),t[a]=g),i&&i[a]===g&&(i.splice(a,1),i[a]=g)),!p){1===h.nodeType&&e(h,a+1,g,c,d);break}if(h.nodeName===p.nodeName&&l.isSameAttributes(h,p)&&h.href===p.href){const e=h.childNodes;let n=0;for(let t=0,i=e.length;t<i;t++)e[t].textContent.length>0&&n++;const o=h.lastChild,u=p.firstChild;if(o&&u){const e=3===o.nodeType&&3===u.nodeType;let l=o.textContent.length,h=o.previousSibling;for(;h&&3===h.nodeType;)l+=h.textContent.length,h=h.previousSibling;n>0&&3===o.nodeType&&3===u.nodeType&&(o.textContent.length>0||u.textContent.length>0)&&n--,c&&t&&t[a]>g&&(a>0&&t[a-1]!==r?c=!1:(t[a]-=1,t[a+1]>=0&&t[a]===g&&(t[a+1]+=n,e&&o&&3===o.nodeType&&u&&3===u.nodeType&&(s.a+=l)))),d&&i&&i[a]>g&&(a>0&&i[a-1]!==r?d=!1:(i[a]-=1,i[a+1]>=0&&i[a]===g&&(i[a+1]+=n,e&&o&&3===o.nodeType&&u&&3===u.nodeType&&(s.b+=l))))}3===h.nodeType?h.textContent+=p.textContent:h.innerHTML+=p.innerHTML,l.removeItem(p),g--}else 1===h.nodeType&&e(h,a+1,g,c,d)}}(e,0,0,!0,!0),s},mergeNestedTags:function(e,t){"string"==typeof t?t=function(e){return this.test(e.tagName)}.bind(new this._w.RegExp("^("+(t||".+")+")$","i")):"function"!=typeof t&&(t=function(){return!0}),function e(i){let n=i.children;if(1===n.length&&n[0].nodeName===i.nodeName&&t(i)){const e=n[0];for(n=e.children;n[0];)i.appendChild(n[0]);i.removeChild(e)}for(let t=0,n=i.children.length;t<n;t++)e(i.children[t])}(e)},removeEmptyNode:function(e,t){const i=this;t&&(t=i.getParentElement(t,(function(t){return e===t.parentElement}))),function n(l){if(i._notTextNode(l)||l===t||"false"===l.getAttribute("contenteditable"))return 0;if(l===e||!i.onlyZeroWidthSpace(l.textContent)||l.firstChild&&i.isBreak(l.firstChild)){const e=l.children;for(let t=0,l=e.length,s=0;t<l;t++)e[t+s]&&!i.isComponent(e[t+s])&&(s+=n(e[t+s]))}else if(l.parentNode)return l.parentNode.removeChild(l),-1;return 0}(e),0===e.childNodes.length&&(e.innerHTML="<br>")},sortByDepth:function(e,t){const i=t?1:-1,n=-1*i;e.sort(function(e,t){return this.isListCell(e)&&this.isListCell(t)?(e=this.getElementDepth(e))>(t=this.getElementDepth(t))?i:e<t?n:0:0}.bind(this))},_isIgnoreNodeChange:function(e){return 3!==e.nodeType&&("false"===e.getAttribute("contenteditable")||!/^(span|font|b|strong|var|i|em|u|ins|s|strike|del|sub|sup|mark|a|label)$/i.test("string"==typeof e?e:e.nodeName))},_isMaintainedNode:function(e){return 3!==e.nodeType&&/^(a|label)$/i.test("string"==typeof e?e:e.nodeName)},_notTextNode:function(e){return 3!==e.nodeType&&(this.isComponent(e)||/^(br|input|select|canvas|img|iframe|audio|video)$/i.test("string"==typeof e?e:e.nodeName))},createTagsWhitelist:function(e){const t=e.split("|");let i="<\\/?(";for(let e=0,n=t.length;e<n;e++)i+="(?!\\b"+t[e]+"\\b)";return i+="[^>^<])+>",new RegExp(i,"g")}};var u=d,h={init:function(e,t){"object"!=typeof t&&(t={});const i=document;this._initOptions(e,t);const n=i.createElement("DIV");n.className="sun-editor",e.id&&(n.id="suneditor_"+e.id);const l=i.createElement("DIV");l.className="se-container";const s=this._createToolBar(i,t.buttonList,t.plugins,t.lang);s.pluginCallButtons.math&&this._checkKatexMath(t.katex);const o=i.createElement("DIV");o.className="se-arrow";const a=i.createElement("DIV");a.className="se-toolbar-sticky-dummy";const r=i.createElement("DIV");r.className="se-wrapper";const c=this._initElements(t,n,s.element,o),d=c.bottomBar,u=c.wysiwygFrame,h=c.placeholder;let p=c.codeView;const g=d.resizingBar,m=d.navigation,f=d.charCounter,_=i.createElement("DIV");_.className="se-loading-box sun-editor-common",_.innerHTML='<div class="se-loading-effect"></div>';const b=i.createElement("DIV");return b.className="se-resizing-back",r.appendChild(u),r.appendChild(p),h&&r.appendChild(h),l.appendChild(s.element),l.appendChild(a),l.appendChild(r),l.appendChild(b),l.appendChild(_),g&&l.appendChild(g),n.appendChild(l),p=this._checkCodeMirror(t,p),{constructed:{_top:n,_relative:l,_toolBar:s.element,_editorArea:r,_wysiwygArea:u,_codeArea:p,_placeholder:h,_resizingBar:g,_navigation:m,_charCounter:f,_loading:_,_resizeBack:b,_stickyDummy:a,_arrow:o},options:t,plugins:s.plugins,pluginCallButtons:s.pluginCallButtons}},_checkCodeMirror:function(e,t){if(e.codeMirror){const i=[{mode:"htmlmixed",htmlMode:!0,lineNumbers:!0,lineWrapping:!0},e.codeMirror.options||{}].reduce((function(e,t){for(let i in t)e[i]=t[i];return e}),{});"auto"===e.height&&(i.viewportMargin=1/0,i.height="auto");const n=e.codeMirror.src.fromTextArea(t,i);n.display.wrapper.style.cssText=t.style.cssText,e.codeMirrorEditor=n,(t=n.display.wrapper).className+=" se-wrapper-code-mirror"}return t},_checkKatexMath:function(e){if(!e)throw Error('[SUNEDITOR.create.fail] To use the math button you need to add a "katex" object to the options.');const t=[{throwOnError:!1},e.options||{}].reduce((function(e,t){for(let i in t)e[i]=t[i];return e}),{});e.options=t},_setOptions:function(e,t,i,n){this._initOptions(t.element.originElement,e);const l=t.element,s=l.relative,o=l.editorArea,a=!!e.buttonList||e.mode!==n.mode,r=!!e.plugins,c=this._createToolBar(document,a?e.buttonList:n.buttonList,r?e.plugins:i,e.lang);c.pluginCallButtons.math&&this._checkKatexMath(e.katex);const d=document.createElement("DIV");d.className="se-arrow",a&&(s.replaceChild(c.element,l.toolbar),l.toolbar=c.element,l._arrow=d);const u=this._initElements(e,l.topArea,a?c.element:l.toolbar,d),h=u.bottomBar,p=u.wysiwygFrame,g=u.placeholder;let m=u.codeView;return l.resizingBar&&s.removeChild(l.resizingBar),h.resizingBar&&s.appendChild(h.resizingBar),l.resizingBar=h.resizingBar,l.navigation=h.navigation,l.charCounter=h.charCounter,o.removeChild(l.wysiwygFrame),o.removeChild(l.code),o.appendChild(p),o.appendChild(m),l.placeholder&&o.removeChild(l.placeholder),g&&o.appendChild(g),m=this._checkCodeMirror(e,m),l.wysiwygFrame=p,l.code=m,l.placeholder=g,{callButtons:a?c.pluginCallButtons:null,plugins:a||r?c.plugins:null}},_initElements:function(e,t,i,n){t.style.width=e.width,t.style.minWidth=e.minWidth,t.style.maxWidth=e.maxWidth,t.style.display=e.display,"string"==typeof e.position&&(t.style.position=e.position),/inline/i.test(e.mode)?(i.className+=" se-toolbar-inline",i.style.width=e.toolbarWidth):/balloon/i.test(e.mode)&&(i.className+=" se-toolbar-balloon",i.style.width=e.toolbarWidth,i.appendChild(n));const l=document.createElement(e.iframe?"IFRAME":"DIV");if(l.className="se-wrapper-inner se-wrapper-wysiwyg",l.style.display="block",e.iframe){const t=function(){const t=e.iframeCSSFileName;let i="";for(let e,n=0,l=t.length;n<l;n++){if(e=[],/^https?:\/\//.test(t[n]))e.push(t[n]);else{const i=new RegExp("(^|.*[\\/])"+t[n]+"(\\..+)?.css(?:\\?.*|;.*)?$","i");for(let t,n=document.getElementsByTagName("link"),l=0,s=n.length;l<s;l++)t=n[l].href.match(i),t&&e.push(t[0])}if(!e||0===e.length)throw'[SUNEDITOR.constructor.iframe.fail] The suneditor CSS files installation path could not be automatically detected. Please set the option property "iframeCSSFileName" before creating editor instances.';for(let t=0,n=e.length;t<n;t++)i+='<link href="'+e[t]+'" rel="stylesheet">'}return i}()+("auto"===e.height?"<style>\n/** Iframe height auto */\nbody{height: min-content; overflow: hidden;}\n</style>":"");l.allowFullscreen=!0,l.frameBorder=0,l.addEventListener("load",(function(){this.setAttribute("scrolling","auto"),this.contentDocument.head.innerHTML='<meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1"><title></title>'+t,this.contentDocument.body.className="sun-editor-editable",this.contentDocument.body.setAttribute("contenteditable",!0)}))}else l.setAttribute("contenteditable",!0),l.setAttribute("scrolling","auto"),l.className+=" sun-editor-editable";l.style.height=e.height,l.style.minHeight=e.minHeight,l.style.maxHeight=e.maxHeight;const s=document.createElement("TEXTAREA");s.className="se-wrapper-inner se-wrapper-code",s.style.display="none",s.style.height=e.height,s.style.minHeight=e.minHeight,s.style.maxHeight=e.maxHeight,"auto"===e.height&&(s.style.overflow="hidden");let o=null,a=null,r=null;if(e.resizingBar&&(o=document.createElement("DIV"),o.className="se-resizing-bar sun-editor-common",a=document.createElement("DIV"),a.className="se-navigation sun-editor-common",o.appendChild(a),e.charCounter)){const t=document.createElement("DIV");if(t.className="se-char-counter-wrapper",r=document.createElement("SPAN"),r.className="se-char-counter",r.textContent="0",t.appendChild(r),e.maxCharCount>0){const i=document.createElement("SPAN");i.textContent=" / "+e.maxCharCount,t.appendChild(i)}o.appendChild(t)}let c=null;return e.placeholder&&(c=document.createElement("SPAN"),c.className="se-placeholder",c.innerText=e.placeholder),{bottomBar:{resizingBar:o,navigation:a,charCounter:r},wysiwygFrame:l,codeView:s,placeholder:c}},_initOptions:function(e,t){t.lang=t.lang||c.a,t._defaultTagsWhitelist="string"==typeof t._defaultTagsWhitelist?t._defaultTagsWhitelist:"br|p|div|pre|blockquote|h[1-6]|ol|ul|li|hr|figure|figcaption|img|iframe|audio|video|table|thead|tbody|tr|th|td|a|b|strong|var|i|em|u|ins|s|span|strike|del|sub|sup",t._editorTagsWhitelist=t._defaultTagsWhitelist+("string"==typeof t.addTagsWhitelist&&t.addTagsWhitelist.length>0?"|"+t.addTagsWhitelist:""),t.pasteTagsWhitelist="string"==typeof t.pasteTagsWhitelist?t.pasteTagsWhitelist:t._editorTagsWhitelist,t.attributesWhitelist=t.attributesWhitelist&&"object"==typeof t.attributesWhitelist?t.attributesWhitelist:null,t.mode=t.mode||"classic",t.toolbarWidth=t.toolbarWidth?u.isNumber(t.toolbarWidth)?t.toolbarWidth+"px":t.toolbarWidth:"auto",t.stickyToolbar=/balloon/i.test(t.mode)?-1:void 0===t.stickyToolbar?0:/^\d+/.test(t.stickyToolbar)?u.getNumber(t.stickyToolbar,0):-1,t.iframe=t.fullPage||t.iframe,t.iframeCSSFileName=t.iframe?"string"==typeof t.iframeCSSFileName?[t.iframeCSSFileName]:t.iframeCSSFileName||["suneditor"]:null,t.codeMirror=t.codeMirror?t.codeMirror.src?t.codeMirror:{src:t.codeMirror}:null,t.display=t.display||("none"!==e.style.display&&e.style.display?e.style.display:"block"),t.popupDisplay=t.popupDisplay||"full",t.resizingBar=void 0===t.resizingBar?!/inline|balloon/i.test(t.mode):t.resizingBar,t.showPathLabel=!!t.resizingBar&&("boolean"!=typeof t.showPathLabel||t.showPathLabel),t.charCounter=t.maxCharCount>0||"boolean"==typeof t.charCounter&&t.charCounter,t.maxCharCount=u.isNumber(t.maxCharCount)&&t.maxCharCount>-1?1*t.maxCharCount:null,t.width=t.width?u.isNumber(t.width)?t.width+"px":t.width:e.clientWidth?e.clientWidth+"px":"100%",t.minWidth=(u.isNumber(t.minWidth)?t.minWidth+"px":t.minWidth)||"",t.maxWidth=(u.isNumber(t.maxWidth)?t.maxWidth+"px":t.maxWidth)||"",t.height=t.height?u.isNumber(t.height)?t.height+"px":t.height:e.clientHeight?e.clientHeight+"px":"auto",t.minHeight=(u.isNumber(t.minHeight)?t.minHeight+"px":t.minHeight)||"",t.maxHeight=(u.isNumber(t.maxHeight)?t.maxHeight+"px":t.maxHeight)||"",t.font=t.font?t.font:null,t.fontSize=t.fontSize?t.fontSize:null,t.formats=t.formats?t.formats:null,t.colorList=t.colorList?t.colorList:null,t.lineHeights=t.lineHeights?t.lineHeights:null,t.paragraphStyles=t.paragraphStyles?t.paragraphStyles:null,t.textStyles=t.textStyles?t.textStyles:null,t.fontSizeUnit="string"==typeof t.fontSizeUnit&&t.fontSizeUnit.trim()||"px",t.imageResizing=void 0===t.imageResizing||t.imageResizing,t.imageHeightShow=void 0===t.imageHeightShow||!!t.imageHeightShow,t.imageWidth=t.imageWidth?u.isNumber(t.imageWidth)?t.imageWidth+"px":t.imageWidth:"auto",t.imageSizeOnlyPercentage=!!t.imageSizeOnlyPercentage,t._imageSizeUnit=t.imageSizeOnlyPercentage?"%":"px",t.imageRotation=void 0!==t.imageRotation?t.imageRotation:!(t.imageSizeOnlyPercentage||!t.imageHeightShow),t.imageFileInput=void 0===t.imageFileInput||t.imageFileInput,t.imageUrlInput=void 0===t.imageUrlInput||!t.imageFileInput||t.imageUrlInput,t.imageUploadHeader=t.imageUploadHeader||null,t.imageUploadUrl=t.imageUploadUrl||null,t.imageUploadSizeLimit=/\d+/.test(t.imageUploadSizeLimit)?u.getNumber(t.imageUploadSizeLimit,0):null,t.videoResizing=void 0===t.videoResizing||t.videoResizing,t.videoHeightShow=void 0===t.videoHeightShow||!!t.videoHeightShow,t.videoRatioShow=void 0===t.videoRatioShow||!!t.videoRatioShow,t.videoWidth=t.videoWidth&&u.getNumber(t.videoWidth)?u.isNumber(t.videoWidth)?t.videoWidth+"px":t.videoWidth:"100%",t.videoSizeOnlyPercentage=!!t.videoSizeOnlyPercentage,t._videoSizeUnit=t.videoSizeOnlyPercentage?"%":"px",t.videoRotation=void 0!==t.videoRotation?t.videoRotation:!(t.videoSizeOnlyPercentage||!t.videoHeightShow),t.videoRatio=u.getNumber(t.videoRatio,4)||.5625,t.videoRatioList=t.videoRatioList?t.videoRatioList:null,t.youtubeQuery=(t.youtubeQuery||"").replace("?",""),t.callBackSave=t.callBackSave?t.callBackSave:null,t.templates=t.templates?t.templates:null,t.placeholder="string"==typeof t.placeholder?t.placeholder:null,t.katex=t.katex?t.katex.src?t.katex:{src:t.katex}:null,t.buttonList=t.buttonList||[["undo","redo"],["bold","underline","italic","strike","subscript","superscript"],["removeFormat"],["outdent","indent"],["fullScreen","showBlocks","codeView"],["preview","print"]]},_defaultButtons:function(e){return{bold:["_se_command_bold",e.toolbar.bold+" (CTRL+B)","STRONG","",'<i class="se-icon-bold"></i>'],underline:["_se_command_underline",e.toolbar.underline+" (CTRL+U)","INS","",'<i class="se-icon-underline"></i>'],italic:["_se_command_italic",e.toolbar.italic+" (CTRL+I)","EM","",'<i class="se-icon-italic"></i>'],strike:["_se_command_strike",e.toolbar.strike+" (CTRL+SHIFT+S)","DEL","",'<i class="se-icon-strokethrough"></i>'],subscript:["_se_command_subscript",e.toolbar.subscript,"SUB","",'<i class="se-icon-subscript"></i>'],superscript:["_se_command_superscript",e.toolbar.superscript,"SUP","",'<i class="se-icon-superscript"></i>'],removeFormat:["",e.toolbar.removeFormat,"removeFormat","",'<i class="se-icon-erase"></i>'],indent:["_se_command_indent",e.toolbar.indent+" (CTRL+])","indent","",'<i class="se-icon-indent-right"></i>'],outdent:["_se_command_outdent",e.toolbar.outdent+" (CTRL+[)","outdent","",'<i class="se-icon-indent-left"></i>',!0],fullScreen:["code-view-enabled",e.toolbar.fullScreen,"fullScreen","",'<i class="se-icon-expansion"></i>'],showBlocks:["",e.toolbar.showBlocks,"showBlocks","",'<i class="se-icon-showBlocks"></i>'],codeView:["code-view-enabled",e.toolbar.codeView,"codeView","",'<i class="se-icon-code-view"></i>'],undo:["_se_command_undo",e.toolbar.undo+" (CTRL+Z)","undo","",'<i class="se-icon-undo"></i>',!0],redo:["_se_command_redo",e.toolbar.redo+" (CTRL+Y / CTRL+SHIFT+Z)","redo","",'<i class="se-icon-redo"></i>',!0],preview:["",e.toolbar.preview,"preview","",'<i class="se-icon-preview"></i>'],print:["",e.toolbar.print,"print","",'<i class="se-icon-print"></i>'],save:["_se_command_save",e.toolbar.save,"save","",'<i class="se-icon-save"></i>',!0],blockquote:["",e.toolbar.tag_blockquote,"blockquote","command",'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M14,17H17L19,13V7H13V13H16M6,17H9L11,13V7H5V13H8L6,17Z" /></svg>'],font:["se-btn-select se-btn-tool-font",e.toolbar.font,"font","submenu",'<span class="txt">'+e.toolbar.font+'</span><i class="se-icon-arrow-down"></i>'],formatBlock:["se-btn-select se-btn-tool-format",e.toolbar.formats,"formatBlock","submenu",'<span class="txt">'+e.toolbar.formats+'</span><i class="se-icon-arrow-down"></i>'],fontSize:["se-btn-select se-btn-tool-size",e.toolbar.fontSize,"fontSize","submenu",'<span class="txt">'+e.toolbar.fontSize+'</span><i class="se-icon-arrow-down"></i>'],fontColor:["",e.toolbar.fontColor,"fontColor","submenu",'<i class="se-icon-fontColor"></i>'],hiliteColor:["",e.toolbar.hiliteColor,"hiliteColor","submenu",'<i class="se-icon-hiliteColor"></i>'],align:["se-btn-align",e.toolbar.align,"align","submenu",'<i class="se-icon-align-left"></i>'],list:["",e.toolbar.list,"list","submenu",'<i class="se-icon-list-number"></i>'],horizontalRule:["btn_line",e.toolbar.horizontalRule,"horizontalRule","submenu",'<i class="se-icon-hr"></i>'],table:["",e.toolbar.table,"table","submenu",'<i class="se-icon-grid"></i>'],lineHeight:["",e.toolbar.lineHeight,"lineHeight","submenu",'<i class="se-icon-line-height"></i>'],template:["",e.toolbar.template,"template","submenu",'<i class="se-icon-template"></i>'],paragraphStyle:["",e.toolbar.paragraphStyle,"paragraphStyle","submenu",'<i class="se-icon-paragraph-style"></i>'],textStyle:["",e.toolbar.textStyle,"textStyle","submenu",'<i class="se-icon-text-style"></i>'],link:["",e.toolbar.link,"link","dialog",'<i class="se-icon-link"></i>'],image:["",e.toolbar.image,"image","dialog",'<i class="se-icon-image"></i>'],video:["",e.toolbar.video,"video","dialog",'<i class="se-icon-video"></i>'],math:["",e.toolbar.math,"math","dialog",'<i class="se-icon-math"></i>']}},_createModuleGroup:function(e){const t=u.createElement("DIV");t.className="se-btn-module"+(e?"":" se-btn-module-border");const i=u.createElement("UL");return i.className="se-menu-list",t.appendChild(i),{div:t,ul:i}},_createButton:function(e,t,i,n,l,s){const o=u.createElement("LI"),a=u.createElement("BUTTON");return a.setAttribute("type","button"),a.setAttribute("class","se-btn"+(e?" "+e:"")+" se-tooltip"),a.setAttribute("data-command",i),a.setAttribute("data-display",n),l+='<span class="se-tooltip-inner"><span class="se-tooltip-text">'+t+"</span></span>",s&&a.setAttribute("disabled",!0),a.innerHTML=l,o.appendChild(a),{li:o,button:a}},_createToolBar:function(e,t,i,n){const l=e.createElement("DIV");l.className="se-toolbar-separator-vertical";const s=e.createElement("DIV");s.className="se-toolbar sun-editor-common";const o=this._defaultButtons(n),a={},r={};if(i){const e=i.length?i:Object.keys(i).map((function(e){return i[e]}));for(let t,i=0,n=e.length;i<n;i++)t=e[i].default||e[i],r[t.name]=t}let c=null,d=null,u=null,h=null,p="",g=!1;const m=1===t.length;for(let i=0;i<t.length;i++){const n=t[i];if(u=this._createModuleGroup(m),"object"==typeof n){for(let e=0;e<n.length;e++)d=n[e],"object"==typeof d?"function"==typeof d.add?(p=d.name,c=o[p],r[p]=d):(p=d.name,c=[d.buttonClass,d.title,d.dataCommand,d.dataDisplay,d.innerHTML]):(c=o[d],p=d),h=this._createButton(c[0],c[1],c[2],c[3],c[4],c[5]),u.ul.appendChild(h.li),r[p]&&(a[p]=h.button);g&&s.appendChild(l.cloneNode(!1)),s.appendChild(u.div),g=!0}else if(/^\/$/.test(n)){const t=e.createElement("DIV");t.className="se-btn-module-enter",s.appendChild(t),g=!1}}const f=e.createElement("DIV");return f.className="se-toolbar-cover",s.appendChild(f),{element:s,plugins:r,pluginCallButtons:a}}};var p=function(e,t,i){return{element:{originElement:e,topArea:t._top,relative:t._relative,toolbar:t._toolBar,resizingBar:t._resizingBar,navigation:t._navigation,charCounter:t._charCounter,editorArea:t._editorArea,wysiwygFrame:t._wysiwygArea,wysiwyg:i.iframe?t._wysiwygArea.contentDocument.body:t._wysiwygArea,code:t._codeArea,placeholder:t._placeholder,loading:t._loading,resizeBackground:t._resizeBack,_stickyDummy:t._stickyDummy,_arrow:t._arrow},tool:{cover:t._toolBar.querySelector(".se-toolbar-cover"),bold:t._toolBar.querySelector("._se_command_bold"),underline:t._toolBar.querySelector("._se_command_underline"),italic:t._toolBar.querySelector("._se_command_italic"),strike:t._toolBar.querySelector("._se_command_strike"),subscript:t._toolBar.querySelector("._se_command_subscript"),superscript:t._toolBar.querySelector("._se_command_superscript"),undo:t._toolBar.querySelector("._se_command_undo"),redo:t._toolBar.querySelector("._se_command_redo"),save:t._toolBar.querySelector("._se_command_save"),outdent:t._toolBar.querySelector("._se_command_outdent"),indent:t._toolBar.querySelector("._se_command_indent")},options:i,option:i}},g=function(e,t,i,n,l){const s=e.element.originElement.ownerDocument||document,a=s.defaultView||window,r=u,c={_d:s,_w:a,_wd:null,_ww:null,util:r,functions:null,notice:o,history:null,context:e,pluginCallButtons:t,plugins:i||{},initPlugins:{},lang:n,submenu:null,container:null,_resizingName:"",_submenuName:"",_bindedSubmenuOff:null,_bindedContainerOff:null,submenuActiveButton:null,containerActiveButton:null,controllerArray:[],currentControllerName:"",codeViewDisabledButtons:null,editorTagsWhitelistRegExp:null,pasteTagsWhitelistRegExp:null,hasFocus:!1,_attributesWhitelistRegExp:null,_attributesTagsWhitelist:null,_bindControllersOff:null,_lastEffectNode:null,_isInline:null,_isBalloon:null,_isBalloonAlways:null,_inlineToolbarAttr:{top:"",width:"",isShow:!1},_notHideToolbar:!1,_sticky:!1,_imagesInfoInit:!0,_imagesInfoReset:!1,_imageUploadBefore:function(e,t){return"function"!=typeof g.onImageUploadBefore||g.onImageUploadBefore(e,t,c)},_imageUpload:function(e,t,i,n,l){"function"==typeof g.onImageUpload&&g.onImageUpload(e,1*t,i,n,l,c)},_imageUploadError:function(e,t){return"function"!=typeof g.onImageUploadError||g.onImageUploadError(e,t,c)},_imageUploadHandler:function(e,t,i){return"function"==typeof g.imageUploadHandler&&(g.imageUploadHandler(e,t,i),!0)},activePlugins:null,commandMap:null,_defaultCommand:{bold:"STRONG",underline:"INS",italic:"EM",strike:"DEL",subscript:"SUB",superscript:"SUP"},_variable:{isCodeView:!1,isFullScreen:!1,innerHeight_fullScreen:0,resizeClientY:0,tabSize:4,codeIndent:4,minResizingSize:r.getNumber(e.element.wysiwygFrame.style.minHeight||"65",0),currentNodes:[],_range:null,_selectionNode:null,_originCssText:e.element.topArea.style.cssText,_bodyOverflow:"",_editorAreaOriginCssText:"",_wysiwygOriginCssText:"",_codeOriginCssText:"",_fullScreenAttrs:{sticky:!1,balloon:!1,inline:!1},_imagesInfo:[],_imageIndex:0,_videosCnt:0},callPlugin:function(e,i,n){if(n=n||t[e],!this.plugins[e])throw Error('[SUNEDITOR.core.callPlugin.fail] The called plugin does not exist or is in an invalid format. (pluginName:"'+e+'")');if(!this.initPlugins[e]){if(!n)return!1;this.plugins[e].add(this,n),this.initPlugins[e]=!0}if(this.plugins[e].active&&!this.commandMap[e]){if(!n)return!1;this.commandMap[e]=n,this.activePlugins.push(e)}"function"==typeof i&&i()},addModule:function(e){for(let t,i=0,n=e.length;i<n;i++)t=e[i].name,this.plugins[t]||(this.plugins[t]=e[i],"function"==typeof this.plugins[t].add&&this.plugins[t].add(this))},submenuOn:function(e){this._bindedSubmenuOff&&this._bindedSubmenuOff();const t=this._submenuName=e.getAttribute("data-command");this.submenu=e.nextElementSibling,this.submenu.style.display="block",r.addClass(e,"on"),this.submenuActiveButton=e;const i=this.context.element.toolbar.offsetWidth-(e.parentElement.offsetLeft+this.submenu.offsetWidth);this.submenu.style.left=i<0?i+"px":"1px",this._bindedSubmenuOff=this.submenuOff.bind(this),this.addDocEvent("mousedown",this._bindedSubmenuOff,!1),this.plugins[t].on&&this.plugins[t].on.call(this)},submenuOff:function(){this.removeDocEvent("mousedown",this._bindedSubmenuOff),this._bindedSubmenuOff=null,this.submenu&&(this._submenuName="",this.submenu.style.display="none",this.submenu=null,r.removeClass(this.submenuActiveButton,"on"),this.submenuActiveButton=null,this._notHideToolbar=!1),this.focus()},containerOn:function(e){this._bindedContainerOff&&this._bindedContainerOff();const t=this._containerName=e.getAttribute("data-command");this.container=e.nextElementSibling,this.container.style.display="block",r.addClass(e,"on"),this.containerActiveButton=e;const i=this.context.element.toolbar.offsetWidth-(e.parentElement.offsetLeft+this.container.offsetWidth);this.container.style.left=i<0?i+"px":"1px",this._bindedContainerOff=this.containerOff.bind(this),this.addDocEvent("mousedown",this._bindedContainerOff,!1),this.plugins[t].on&&this.plugins[t].on.call(this)},containerOff:function(){this.removeDocEvent("mousedown",this._bindedContainerOff),this._bindedContainerOff=null,this.container&&(this._containerName="",this.container.style.display="none",this.container=null,r.removeClass(this.containerActiveButton,"on"),this.containerActiveButton=null,this._notHideToolbar=!1),this.focus()},controllersOn:function(){if(this._bindControllersOff){const e=this._resizingName;this._bindControllersOff(),this._resizingName=e}for(let e,t=0;t<arguments.length;t++)e=arguments[t],"string"!=typeof e?(e.style&&(e.style.display="block"),this.controllerArray[t]=e):this.currentControllerName=e;this._notHideToolbar=!0,this._bindControllersOff=this.controllersOff.bind(this),this.addDocEvent("mousedown",this._bindControllersOff,!1),this.addDocEvent("keydown",this._bindControllersOff,!1)},controllersOff:function(e){if(this._resizingName&&e&&"keydown"===e.type&&27!==e.keyCode)return;if(this._notHideToolbar=!1,this._resizingName="",this.currentControllerName="",this._lastEffectNode=null,!this._bindControllersOff)return;this.removeDocEvent("mousedown",this._bindControllersOff),this.removeDocEvent("keydown",this._bindControllersOff),this._bindControllersOff=null;const t=this.controllerArray.length;if(t>0){for(let e=0;e<t;e++)"function"==typeof this.controllerArray[e]?this.controllerArray[e]():this.controllerArray[e].style.display="none";this.controllerArray=[]}},execCommand:function(e,t,i){this._wd.execCommand(e,t,"formatBlock"===e?"<"+i+">":i),this.history.push(!0)},_nativeFocus:function(){const t=r.getParentElement(this.getSelectionNode(),"figcaption");t?t.focus():e.element.wysiwyg.focus(),this._editorRange()},focus:function(){if("none"!==e.element.wysiwygFrame.style.display){if(l.iframe)this._nativeFocus();else try{const e=this.getRange();this.setRange(e.startContainer,e.startOffset,e.endContainer,e.endOffset)}catch(e){this._nativeFocus()}d._applyTagEffects(),c._isBalloon&&d._toggleToolbarBalloon()}},focusEdge:function(e){if(r.isComponent(e)){const t=e.querySelector("IMG"),i=e.querySelector("IFRAME");t?this.selectComponent(t,"image"):i&&this.selectComponent(i,"video")}else e=r.getChildElement(e,(function(e){return 0===e.childNodes.length||3===e.nodeType}),!0),this.setRange(e,e.textContent.length,e,e.textContent.length)},setRange:function(e,t,i,n){if(!e||!i)return;t>e.textContent.length&&(t=e.textContent.length),n>i.textContent.length&&(n=i.textContent.length);const l=this._wd.createRange();l.setStart(e,t),l.setEnd(i,n);const s=this.getSelection();s.removeAllRanges&&s.removeAllRanges(),s.addRange(l),this._editorRange()},removeRange:function(){this.getSelection().removeAllRanges();const e=this.commandMap;r.removeClass(e.STRONG,"active"),r.removeClass(e.INS,"active"),r.removeClass(e.EM,"active"),r.removeClass(e.DEL,"active"),r.removeClass(e.SUB,"active"),r.removeClass(e.SUP,"active"),e.OUTDENT&&e.OUTDENT.setAttribute("disabled",!0),e.INDENT&&e.INDENT.removeAttribute("disabled")},getRange:function(){return this._variable._range||this._createDefaultRange()},getSelection:function(){return this._ww.getSelection()},getSelectionNode:function(){return this._variable._selectionNode&&!r.isWysiwygDiv(this._variable._selectionNode)||this._editorRange(),this._variable._selectionNode||e.element.wysiwyg.firstChild},_editorRange:function(){const e=this.getSelection();let t=null,i=null;t=e.rangeCount>0?e.getRangeAt(0):this._createDefaultRange(),this._variable._range=t,i=t.collapsed?t.commonAncestorContainer:e.extentNode||e.anchorNode,this._variable._selectionNode=i},_createDefaultRange:function(){e.element.wysiwyg.focus();const t=this._wd.createRange();return e.element.wysiwyg.firstChild||this.execCommand("formatBlock",!1,"P"),t.setStart(e.element.wysiwyg.firstChild,0),t.setEnd(e.element.wysiwyg.firstChild,0),t},_resetRangeToTextNode:function(){const t=this.getRange();let i,n,l,s=t.startContainer,o=t.startOffset,a=t.endContainer,c=t.endOffset;if(i=r.isWysiwygDiv(s)?e.element.wysiwyg.firstChild:s,n=o,r.isBreak(i)||1===i.nodeType&&i.childNodes.length>0){const e=r.isBreak(i);if(!e){for(;i&&!r.isBreak(i)&&1===i.nodeType;)i=i.childNodes[n]||i.nextElementSibling||i.nextSibling,n=0;let e=r.getFormatElement(i);e===r.getRangeFormatElement(e)&&(e=r.createElement(r.isCell(i)?"DIV":"P"),i.parentNode.insertBefore(e,i),e.appendChild(i))}if(r.isBreak(i)){const t=r.createTextNode(r.zeroWidthSpace);i.parentNode.insertBefore(t,i),i=t,e&&(s===a&&(a=i,c=1),r.removeItem(s))}}if(s=i,o=n,i=r.isWysiwygDiv(a)?e.element.wysiwyg.lastChild:a,n=c,r.isBreak(i)||1===i.nodeType&&i.childNodes.length>0){const e=r.isBreak(i);if(!e){for(;i&&!r.isBreak(i)&&1===i.nodeType&&(l=i.childNodes,0!==l.length);)i=l[n>0?n-1:n]||!/FIGURE/i.test(l[0].nodeName)?l[0]:i.previousElementSibling||i.previousSibling||s,n=n>0?i.textContent.length:n;let e=r.getFormatElement(i);e===r.getRangeFormatElement(e)&&(e=r.createElement(r.isCell(e)?"DIV":"P"),i.parentNode.insertBefore(e,i),e.appendChild(i))}if(r.isBreak(i)){const t=r.createTextNode(r.zeroWidthSpace);i.parentNode.insertBefore(t,i),i=t,n=1,e&&r.removeItem(a)}}a=i,c=n,this.setRange(s,o,a,c)},getSelectedElements:function(t){this._resetRangeToTextNode();let i=this.getRange();if(r.isWysiwygDiv(i.startContainer)){const t=e.element.wysiwyg.children;if(0===t.length)return null;this.setRange(t[0],0,t[t.length-1],t[t.length-1].textContent.trim().length),i=this.getRange()}const n=i.startContainer,l=i.endContainer,s=i.commonAncestorContainer,o=r.getListChildren(s,(function(e){return t?t(e):r.isFormatElement(e)}));if(r.isWysiwygDiv(s)||r.isRangeFormatElement(s)||o.unshift(r.getFormatElement(s)),n===l||1===o.length)return o;let a=r.getFormatElement(n),c=r.getFormatElement(l),d=null,u=null;const h=function(e){return!r.isTable(e)||/^TABLE$/i.test(e.nodeName)};let p=r.getRangeFormatElement(a,h),g=r.getRangeFormatElement(c,h);r.isTable(p)&&r.isListCell(p.parentNode)&&(p=p.parentNode),r.isTable(g)&&r.isListCell(g.parentNode)&&(g=g.parentNode);const m=p===g;for(let e,t=0,i=o.length;t<i;t++)if(e=o[t],a===e||!m&&e===p)d=t;else if(c===e||!m&&e===g){u=t;break}return null===d&&(d=0),null===u&&(u=o.length-1),o.slice(d,u+1)},getSelectedElementsAndComponents:function(e){const t=this.getRange().commonAncestorContainer,i=r.getParentElement(t,r.isComponent),n=r.isTable(t)?this.getSelectedElements():this.getSelectedElements(function(e){const t=this.getParentElement(e,this.isComponent);return this.isFormatElement(e)&&(!t||t===i)||this.isComponent(e)&&!this.getFormatElement(e)}.bind(r));if(e)for(let e=0,t=n.length;e<t;e++)for(let i=e-1;i>=0;i--)if(n[i].contains(n[e])){n.splice(e,1),e--,t--;break}return n},isEdgePoint:function(e,t){return 0===t||!e.nodeValue&&1===t||t===e.nodeValue.length},showLoading:function(){e.element.loading.style.display="block"},closeLoading:function(){e.element.loading.style.display="none"},appendFormatTag:function(e,t){const i=r.getFormatElement(this.getSelectionNode()),n=t?"string"==typeof t?t:t.nodeName:r.isFormatElement(i)?i.nodeName:"P",l=r.createElement(n);return l.innerHTML="<br>",(t&&"string"!=typeof t||!t&&r.isFormatElement(i))&&r.copyTagAttributes(l,t||i),r.isCell(e)?e.insertBefore(l,e.nextElementSibling):e.parentNode.insertBefore(l,e.nextElementSibling),l},insertComponent:function(e,t){const i=this.removeNode();let n=null,l=this.getSelectionNode(),s=r.getFormatElement(l);if(r.isListCell(s))if(/^HR$/i.test(e.nodeName)){const t=r.createElement("LI"),i=r.createTextNode(r.zeroWidthSpace);t.appendChild(e),t.appendChild(i),s.parentNode.insertBefore(t,s.nextElementSibling),this.setRange(i,1,i,1)}else this.insertNode(e,l===s?null:i.container.nextSibling),e.nextSibling||e.parentNode.appendChild(r.createElement("BR")),n=r.createElement("LI"),s.parentNode.insertBefore(n,s.nextElementSibling);else{if(this.getRange().collapsed&&3===i.container.nodeType){const e=r.getParentElement(i.container,function(e){return this.isRangeFormatElement(e)}.bind(r));n=r.splitElement(i.container,i.offset,e?r.getElementDepth(e)+1:0),s=n.previousSibling}this.insertNode(e,s),n||(n=this.appendFormatTag(e,r.isFormatElement(s)?s:null))}return t||this.history.push(!1),n},selectComponent:function(e,t){if("image"===t){if(!c.plugins.image)return;c.removeRange(),c.callPlugin("image",(function(){const t=c.plugins.resizing.call_controller_resize.call(c,e,"image");c.plugins.image.onModifyMode.call(c,e,t),r.getParentElement(e,".se-image-container")||(c.plugins.image.openModify.call(c,!0),c.plugins.image.update_image.call(c,!0,!0,!0))}))}else if("video"===t){if(!c.plugins.video)return;c.removeRange(),c.callPlugin("video",(function(){const t=c.plugins.resizing.call_controller_resize.call(c,e,"video");c.plugins.video.onModifyMode.call(c,e,t)}))}},insertNode:function(e,t){const i=this.getRange();let n=null;if(t)n=t.parentNode,t=t.nextSibling;else{const e=i.startContainer,l=i.startOffset,s=i.endContainer,o=i.endOffset,a=i.commonAncestorContainer;if(n=e,3===e.nodeType&&(n=e.parentNode),i.collapsed)if(3===a.nodeType)t=a.textContent.length>o?a.splitText(o):a.nextSibling;else if(r.isBreak(n))t=n,n=n.parentNode;else{const e=n.childNodes[l];e?e.nextSibling?t=r.isBreak(e)?e.nextSibling:e:(n.removeChild(e),t=null):t=null}else{if(e===s){t=this.isEdgePoint(s,o)?s.nextSibling:s.splitText(o);let i=e;this.isEdgePoint(e,l)||(i=e.splitText(l)),n.removeChild(i)}else for(this.removeNode(),n=a,t=s;t.parentNode!==a;)t=t.parentNode}}try{if(r.isFormatElement(e)||r.isRangeFormatElement(e)||!r.isListCell(n)&&r.isComponent(e))if(r.isList(t))n=t,t=null;else if(!t){const e=this.removeNode(),i=3===e.container.nodeType?r.isListCell(r.getFormatElement(e.container))?e.container:r.getFormatElement(e.container)||e.container.parentNode:e.container;n=i.parentNode,t=i.nextSibling}n.insertBefore(e,t)}catch(t){n.appendChild(e)}finally{if(3===e.nodeType){const t=e.previousSibling,i=e.nextSibling,n=!t||3!==t.nodeType||r.onlyZeroWidthSpace(t)?"":t.textContent,l=!i||3!==i.nodeType||r.onlyZeroWidthSpace(i)?"":i.textContent;return t&&n.length>0&&(e.textContent=n+e.textContent,r.removeItem(t)),i&&i.length>0&&(e.textContent+=l,r.removeItem(i)),{startOffset:n.length,endOffset:e.textContent.length-l.length}}this.setRange(e,1,e,1),this.history.push(!0)}},removeNode:function(){const e=this.getRange();let t,i=0,n=e.startContainer,l=e.endContainer;const s=e.startOffset,o=e.endOffset,a=e.commonAncestorContainer;let c=null,d=null;const u=r.getListChildNodes(a);let h=r.getArrayIndex(u,n),p=r.getArrayIndex(u,l);if(u.length>0&&h>-1&&p>-1){for(let e=h+1,t=n;e>=0;e--)u[e]===t.parentNode&&u[e].firstChild===t&&0===s&&(h=e,t=t.parentNode);for(let e=p-1,t=l;e>h;e--)u[e]===t.parentNode&&1===u[e].nodeType&&(u.splice(e,1),t=t.parentNode,--p)}else{if(0===u.length)u.push(a),n=l=a;else if(n=l=u[0],r.isBreak(n))return{container:n,offset:0};h=p=0}function g(e){const t=r.getFormatElement(e);if(r.removeItem(e),r.isListCell(t)){const e=r.getArrayItem(t.children,r.isList,!1);if(e){const i=e.firstElementChild,n=i.childNodes;for(;n[0];)t.insertBefore(n[0],e);r.removeItemAllParents(i)}}}for(let e=h;e<=p;e++){const t=u[e];if(0===t.length||3===t.nodeType&&void 0===t.data)g(t);else if(t!==n)t!==l?g(t):(d=1===l.nodeType?r.createTextNode(l.textContent):r.createTextNode(l.substringData(o,l.length-o)),d.length>0?l.data=d.data:g(l));else if(1===n.nodeType?c=r.createTextNode(n.textContent):t===l?(c=r.createTextNode(n.substringData(0,s)+l.substringData(o,l.length-o)),i=s):c=r.createTextNode(n.substringData(0,s)),c.length>0?n.data=c.data:g(n),t===l)break}return t=l&&l.parentNode?l:n&&n.parentNode?n:e.endContainer||e.startContainer,this.setRange(t,i,t,i),this.history.push(!0),{container:t,offset:i}},applyRangeFormatElement:function(e){const t=this.getSelectedElementsAndComponents(!1);if(!t||0===t.length)return;e:for(let e,i,n,l,s,o,a=0,c=t.length;a<c;a++)if(e=t[a],r.isListCell(e))if(i=e.lastElementChild,i&&r.isListCell(e.nextElementSibling)&&t.indexOf(e.nextElementSibling)>-1&&(l=i.lastElementChild,t.indexOf(l)>-1)){let e=null;for(;e=l.lastElementChild;)if(r.isList(e)){if(!(t.indexOf(e.lastElementChild)>-1))continue e;l=e.lastElementChild}n=i.firstElementChild,s=t.indexOf(n),o=t.indexOf(l),t.splice(s,o-s+1),c=t.length}else;let i,n,l,s=t[t.length-1];i=r.isRangeFormatElement(s)||r.isFormatElement(s)?s:r.getRangeFormatElement(s)||r.getFormatElement(s),r.isCell(i)?(n=null,l=i):(n=i.nextSibling,l=i.parentNode);let o=r.getElementDepth(i),a=null;const d=[],u=function(e,t,i){let n=null;if(e!==t&&!r.isTable(t)){if(t&&r.getElementDepth(e)===r.getElementDepth(t))return i;n=r.removeItemAllParents(t,null,e)}return n?n.ec:i};for(let i,s,c,h,p,g,m,f=0,_=t.length;f<_;f++)if(i=t[f],s=i.parentNode,s&&!e.contains(s))if(c=r.getElementDepth(i),r.isList(s)){if(null===a&&(g?(a=g,m=!0,g=null):a=s.cloneNode(!1)),d.push(i),p=t[f+1],f===_-1||p&&p.parentNode!==s){p&&i.contains(p.parentNode)&&(g=p.parentNode.cloneNode(!1));let t,f=s.parentNode;for(;r.isList(f);)t=r.createElement(f.nodeName),t.appendChild(a),a=t,f=f.parentNode;const _=this.detachRangeFormatElement(s,d,null,!0,!0);o>=c?(o=c,l=_.cc,n=u(l,s,_.ec),n&&(l=n.parentNode)):l===_.cc&&(n=_.ec),l!==_.cc&&(h=u(l,_.cc,h),n=void 0!==h?h:_.cc);for(let e=0,t=_.removeArray.length;e<t;e++)a.appendChild(_.removeArray[e]);m||e.appendChild(a),g&&_.removeArray[_.removeArray.length-1].appendChild(g),a=null,m=!1}}else o>=c&&(o=c,l=s,n=i.nextSibling),e.appendChild(i),l!==s&&(h=u(l,s),void 0!==h&&(n=h));if(c._lastEffectNode=null,r.mergeSameTags(e,null,null,!1),r.mergeNestedTags(e,function(e){return this.isList(e)}.bind(r)),n&&r.getElementDepth(n)>0&&(r.isList(n.parentNode)||r.isList(n.parentNode.parentNode))){const t=r.getParentElement(n,function(e){return this.isRangeFormatElement(e)&&!this.isList(e)}.bind(r)),i=r.splitElement(n,null,t?r.getElementDepth(t)+1:0);i.parentNode.insertBefore(e,i)}else l.insertBefore(e,n),u(e,n);const h=r.getEdgeChildNodes(e.firstElementChild,e.lastElementChild);t.length>1?this.setRange(h.sc,0,h.ec,h.ec.textContent.length):this.setRange(h.ec,h.ec.textContent.length,h.ec,h.ec.textContent.length),this.history.push(!1)},detachRangeFormatElement:function(e,t,i,n,l){const s=this.getRange(),o=s.startOffset,a=s.endOffset;let u=r.getListChildNodes(e,(function(t){return t.parentNode===e})),h=e.parentNode,p=null,g=null,m=e.cloneNode(!1);const f=[],_=r.isList(i);let b=!1,y=!1,v=!1;function x(t,i,n,l){if(r.onlyZeroWidthSpace(i)&&(i.innerHTML=r.zeroWidthSpace),3===i.nodeType)return t.insertBefore(i,n),i;const s=(v?i:l).childNodes;let o=i.cloneNode(!1),a=null,c=null;for(;s[0];)c=s[0],!r._notTextNode(c)||r.isBreak(c)||r.isListCell(o)?o.appendChild(c):(o.childNodes.length>0&&(a||(a=o),t.insertBefore(o,n),o=i.cloneNode(!1)),t.insertBefore(c,n),a||(a=c));if(o.childNodes.length>0){if(r.isListCell(t)&&r.isListCell(o)&&r.isList(n))if(_){for(a=n;n;)o.appendChild(n),n=n.nextSibling;t.parentNode.insertBefore(o,t.nextElementSibling)}else{const t=l.nextElementSibling,i=r.detachNestedList(l,!1);e===i&&t===l.nextElementSibling||(e=i,y=!0)}else t.insertBefore(o,n);a||(a=o)}return a}for(let l,s,o,a=0,c=u.length;a<c;a++)if(l=u[a],v=!1,n&&0===a&&(p=t&&t.length!==c&&t[0]!==l?m:e.previousSibling),t&&(s=t.indexOf(l)),t&&-1===s)m||(m=e.cloneNode(!1)),m.appendChild(l);else{if(t&&(o=t[s+1]),m&&m.children.length>0&&(h.insertBefore(m,e),m=null),!_&&r.isListCell(l))if(r.getElementDepth(l)!==r.getElementDepth(o)&&(r.isListCell(h)||r.getArrayItem(l.children,r.isList,!1))){const t=l.nextElementSibling,i=r.detachNestedList(l,!1);e===i&&t===l.nextElementSibling||(e=i,y=!0)}else{const t=l;l=r.createElement(n?t.nodeName:r.isList(e.parentNode)||r.isListCell(e.parentNode)?"LI":r.isCell(e.parentNode)?"DIV":"P");const i=t.childNodes;for(;i[0];)l.appendChild(i[0]);r.copyFormatAttributes(l,t),v=!0}else l=l.cloneNode(!1);if(y){y=v=!1,u=r.getListChildNodes(e,(function(t){return t.parentNode===e})),m=e.cloneNode(!1),h=e.parentNode,a=-1,c=u.length;continue}n?(f.push(l),r.removeItem(u[a])):(i?(b||(h.insertBefore(i,e),b=!0),l=x(i,l,null,u[a])):l=x(h,l,e,u[a]),t?(g=l,p||(p=l)):p||(p=g=l))}const C=e.parentNode;let w=e.nextSibling;m&&m.children.length>0&&C.insertBefore(m,w),i?p=i.previousSibling:p||(p=e.previousSibling),w=e.nextSibling,r.removeItem(e);let N=null;if(n)N={cc:C,sc:p,ec:w,removeArray:f};else{const e=r.getEdgeChildNodes(p,g&&g.parentNode?g:p);N={cc:(e.sc||e.ec).parentNode,sc:e.sc,ec:e.ec}}if(c._lastEffectNode=null,l)return N;!n&&N&&(t?this.setRange(N.sc,o,N.ec,a):this.setRange(N.sc,0,N.sc,0)),this.history.push(!1),d._applyTagEffects()},detachList:function(e,t){let i={},n=!1,l=!1,s=null,o=null;const a=function(e){return!this.isComponent(e)}.bind(r);for(let c,d,u,h,p=0,g=e.length;p<g;p++){if(u=p===g-1,d=r.getRangeFormatElement(e[p],a),h=r.isList(d),!c&&h)c=d,i={r:c,f:[r.getParentElement(e[p],"LI")]},0===p&&(n=!0);else if(c&&h)if(c!==d){const a=this.detachRangeFormatElement(i.f[0].parentNode,i.f,null,t,!0);d=e[p].parentNode,n&&(s=a.sc,n=!1),u&&(o=a.ec),h?(c=d,i={r:c,f:[r.getParentElement(e[p],"LI")]},u&&(l=!0)):c=null}else i.f.push(r.getParentElement(e[p],"LI")),u&&(l=!0);if(u&&r.isList(c)){const e=this.detachRangeFormatElement(i.f[0].parentNode,i.f,null,t,!0);(l||1===g)&&(o=e.ec),n&&(s=e.sc||o)}}return{sc:s,ec:o}},nodeChange:function(e,t,i,n){let l=this.getRange();t=!!(t&&t.length>0)&&t,i=!!(i&&i.length>0)&&i;const s=!e,o=s&&!i&&!t;let c=l.startContainer,d=l.startOffset,u=l.endContainer,h=l.endOffset;if(o&&l.collapsed&&r.isFormatElement(c.parentNode)&&r.isFormatElement(u.parentNode)||c===u&&1===c.nodeType&&"false"===c.getAttribute("contenteditable"))return;if(l.collapsed&&1===c.nodeType&&!r.isBreak(c)){let e=null;const t=c.childNodes[d];t&&(t.nextSibling?e=r.isBreak(t)?t.nextSibling:t:(c.removeChild(t),e=null));const i=r.createTextNode(r.zeroWidthSpace);c.insertBefore(i,e),this.setRange(i,1,i,1),l=this.getRange(),c=l.startContainer,d=l.startOffset,u=l.endContainer,h=l.endOffset}s&&(e=r.createElement("DIV"));const p=e.nodeName;if(!o&&c===u&&!i&&e){let t=c,i=0;const n=[],l=e.style;for(let e=0,t=l.length;e<t;e++)n.push(l[e]);const o=e.classList;for(let e=0,t=o.length;e<t;e++)n.push("."+o[e]);if(n.length>0){for(;!r.isFormatElement(t)&&!r.isWysiwygDiv(t);){for(let l=0;l<n.length;l++)if(1===t.nodeType){const o=n[l],r=!!/^\./.test(o)&&new a.RegExp("\\s*"+o.replace(/^\./,"")+"(\\s+|$)","ig"),c=s?!!t.style[o]:!!t.style[o]&&!!e.style[o]&&t.style[o]===e.style[o],d=!1!==r&&(s?!!t.className.match(r):!!t.className.match(r)&&!!e.className.match(r));(c||d)&&i++}t=t.parentNode}if(i>=n.length)return}}let g,m={},f={},_="",b="",y="";if(t){for(let e,i=0,n=t.length;i<n;i++)e=t[i],/^\./.test(e)?b+=(b?"|":"\\s*(?:")+e.replace(/^\./,""):_+=(_?"|":"(?:;|^|\\s)(?:")+e;_&&(_+=")\\s*:[^;]*\\s*(?:;|$)",_=new a.RegExp(_,"ig")),b&&(b+=")(?=\\s+|$)",b=new a.RegExp(b,"ig"))}if(i){y="^(?:"+i[0];for(let e=1;e<i.length;e++)y+="|"+i[e];y+=")$",y=new a.RegExp(y,"i")}const v={v:!1},x=function(e){const t=e.cloneNode(!1);if(3===t.nodeType||r.isBreak(t))return t;if(o)return null;const i=!y&&s||y&&y.test(t.nodeName);if(i&&!n)return v.v=!0,null;const l=t.style.cssText;let c="";_&&l.length>0&&(c=l.replace(_,"").trim(),c!==l&&(v.v=!0));const d=t.className;let u="";return b&&d.length>0&&(u=d.replace(b,"").trim(),u!==d&&(v.v=!0)),(!s||!b&&d||!_&&l||c||u||!i)&&(c||u||t.nodeName!==p||a.Boolean(_)!==a.Boolean(l)||a.Boolean(b)!==a.Boolean(d))?(_&&l.length>0&&(t.style.cssText=c),t.style.cssText||t.removeAttribute("style"),b&&d.length>0&&(t.className=u.trim()),t.className.trim()||t.removeAttribute("class"),t.style.cssText||t.className||t.nodeName!==p&&!i?t:(v.v=!0,null)):(v.v=!0,null)},C=this.getSelectedElements();r.getFormatElement(c)||(c=r.getChildElement(C[0],(function(e){return 3===e.nodeType})),d=0),r.getFormatElement(u)||(u=r.getChildElement(C[C.length-1],(function(e){return 3===e.nodeType})),h=u.textContent.length);const w=r.getFormatElement(c)===r.getFormatElement(u),N=C.length-(w?0:1);g=e.cloneNode(!1);const E=o||s&&function(e,t){for(let i=0,n=e.length;i<n;i++)if(t(e[i]))return!0;return!1}(i,r._isMaintainedNode),S=this._util_getMaintainedNode.bind(r,E),k=this._util_isMaintainedNode.bind(r,E);if(w){const e=this._nodeChange_oneLine(C[0],g,x,c,d,u,h,o,s,l.collapsed,v,S,k);m.container=e.startContainer,m.offset=e.startOffset,f.container=e.endContainer,f.offset=e.endOffset}else{N>0&&(g=e.cloneNode(!1),f=this._nodeChange_endLine(C[N],g,x,u,h,o,s,v,S,k));for(let t=N-1;t>0;t--)g=e.cloneNode(!1),this._nodeChange_middleLine(C[t],g,x,o,s,v);g=e.cloneNode(!1),m=this._nodeChange_startLine(C[0],g,x,c,d,o,s,v,S,k),N<=0&&(f=m)}this.controllersOff(),this.setRange(m.container,m.offset,f.container,f.offset),this.history.push(!1)},_stripRemoveNode:function(e){const t=e.parentNode;if(!e||3===e.nodeType||!t)return;const i=e.childNodes;for(;i[0];)t.insertBefore(i[0],e);t.removeChild(e)},_util_getMaintainedNode:function(e,t){return t&&!e?this.getParentElement(t,function(e){return this._isMaintainedNode(e)}.bind(this)):null},_util_isMaintainedNode:function(e,t){return t&&!e&&3!==t.nodeType&&this._isMaintainedNode(t)},_nodeChange_oneLine:function(e,t,i,n,l,s,o,c,d,u,h,p,g){let m=n.parentNode;for(;!(m.nextSibling||m.previousSibling||r.isFormatElement(m.parentNode)||r.isWysiwygDiv(m.parentNode))&&m.nodeName!==t.nodeName;)m=m.parentNode;if(!d&&m===s.parentNode&&m.nodeName===t.nodeName&&r.onlyZeroWidthSpace(n.textContent.slice(0,l))&&r.onlyZeroWidthSpace(s.textContent.slice(o))){const e=m.childNodes;let i=!0;for(let t,l,o,a,c=0,d=e.length;c<d;c++)if(t=e[c],a=!r.onlyZeroWidthSpace(t),t!==n)if(t!==s){if(!l&&a||l&&o&&a){i=!1;break}}else o=!0;else l=!0;if(i)return r.copyTagAttributes(m,t),{startContainer:n,startOffset:l,endContainer:s,endOffset:o}}h.v=!1;const f=e,_=[t],b=e.cloneNode(!1),y=n===s;let v,x,C,w,N,E=n,S=l,k=s,T=o,z=!1,L=!1;function A(e){const t=new a.RegExp("(?:;|^|\\s)(?:"+w+"null)\\s*:[^;]*\\s*(?:;|$)","ig");let i="";return t&&e.style.cssText.length>0&&(i=t.test(e.style.cssText)),!i}if(function e(n,l){const s=n.childNodes;for(let n,o=0,a=s.length;o<a;o++){let d=s[o];if(!d)continue;let h,m=l;if(!z&&d===E){let e=b;N=p(d);const s=r.createTextNode(1===E.nodeType?"":E.substringData(0,S)),o=r.createTextNode(1===E.nodeType?"":E.substringData(S,y&&T>=S?T-S:E.data.length-S));if(N){const t=p(l);if(t&&t.parentNode!==e){let i=t,n=null;for(;i.parentNode!==e;){for(l=n=i.parentNode.cloneNode(!1);i.childNodes[0];)n.appendChild(i.childNodes[0]);i.appendChild(n),i=i.parentNode}i.parentNode.appendChild(t)}N=N.cloneNode(!1)}r.onlyZeroWidthSpace(s)||l.appendChild(s);const a=p(l);for(a&&(N=a),N&&(e=N),x=d,v=[],w="";x!==e&&x!==f&&null!==x;)n=g(x)?null:i(x),n&&1===x.nodeType&&A(x)&&(v.push(n),w+=x.style.cssText.substr(0,x.style.cssText.indexOf(":"))+"|"),x=x.parentNode;const c=v.pop()||o;for(C=x=c;v.length>0;)x=v.pop(),C.appendChild(x),C=x;if(t.appendChild(c),e.appendChild(t),N&&!p(k)&&(t=t.cloneNode(!1),b.appendChild(t),_.push(t)),E=o,S=0,z=!0,x!==o&&x.appendChild(E),!y)continue}if(L||d!==k){if(z){if(1===d.nodeType&&!r.isBreak(d)){r._isIgnoreNodeChange(d)?(b.appendChild(d),o--,a--,u||(t=t.cloneNode(!1),b.appendChild(t),_.push(t))):e(d,d);continue}x=d,v=[],w="";const s=[];for(;null!==x.parentNode&&x!==f&&x!==t;)n=L?x.cloneNode(!1):i(x),1===x.nodeType&&!r.isBreak(d)&&n&&A(x)&&(n&&(g(n)?N||s.push(n):v.push(n)),w+=x.style.cssText.substr(0,x.style.cssText.indexOf(":"))+"|"),x=x.parentNode;v=v.concat(s);const c=v.pop()||d;for(C=x=c;v.length>0;)x=v.pop(),C.appendChild(x),C=x;if(g(t.parentNode)&&!g(c)&&(t=t.cloneNode(!1),b.appendChild(t),_.push(t)),L||N||!g(c))c===d?l=L?b:t:L?(b.appendChild(c),l=x):(t.appendChild(c),l=x);else{t=t.cloneNode(!1);const e=c.childNodes;for(let i=0,n=e.length;i<n;i++)t.appendChild(e[i]);c.appendChild(t),b.appendChild(c),_.push(t),l=t.children.length>0?x:t}if(N&&3===d.nodeType)if(p(d)){const e=r.getParentElement(l,function(e){return this._isMaintainedNode(e.parentNode)||e.parentNode===b}.bind(r));N.appendChild(e),t=e.cloneNode(!1),_.push(t),b.appendChild(t)}else N=null}h=d.cloneNode(!1),l.appendChild(h),1!==d.nodeType||r.isBreak(d)||(m=h),e(d,m)}else{N=p(d);const e=r.createTextNode(1===k.nodeType?"":k.substringData(T,k.length-T)),l=r.createTextNode(y||1===k.nodeType?"":k.substringData(0,T));if(N?N=N.cloneNode(!1):g(t.parentNode)&&!N&&(t=t.cloneNode(!1),b.appendChild(t),_.push(t)),!r.onlyZeroWidthSpace(e)){x=d,w="",v=[];const t=[];for(;x!==b&&x!==f&&null!==x;)1===x.nodeType&&A(x)&&(g(x)?t.push(x.cloneNode(!1)):v.push(x.cloneNode(!1)),w+=x.style.cssText.substr(0,x.style.cssText.indexOf(":"))+"|"),x=x.parentNode;for(v=v.concat(t),h=C=x=v.pop()||e;v.length>0;)x=v.pop(),C.appendChild(x),C=x;b.appendChild(h),x.textContent=e.data}if(N&&h){const e=p(h);e&&(N=e)}for(x=d,v=[],w="";x!==b&&x!==f&&null!==x;)n=g(x)?null:i(x),n&&1===x.nodeType&&A(x)&&(v.push(n),w+=x.style.cssText.substr(0,x.style.cssText.indexOf(":"))+"|"),x=x.parentNode;const s=v.pop()||l;for(C=x=s;v.length>0;)x=v.pop(),C.appendChild(x),C=x;N?((t=t.cloneNode(!1)).appendChild(s),N.insertBefore(t,N.firstChild),b.appendChild(N),_.push(t),N=null):t.appendChild(s),k=l,T=l.data.length,L=!0,!c&&u&&(t=l,l.textContent=r.zeroWidthSpace),x!==l&&x.appendChild(k)}}}(e,b),d&&!c&&!h.v)return{startContainer:n,startOffset:l,endContainer:s,endOffset:o};if(c=c&&d)for(let e=0;e<_.length;e++){let t=_[e],i=r.createTextNode(u?r.zeroWidthSpace:t.textContent);b.replaceChild(i,t),0===e&&(E=k=i)}else{if(d)for(let e=0;e<_.length;e++)this._stripRemoveNode(_[e]);u&&(E=k=t)}r.removeEmptyNode(b,t),u&&(S=E.textContent.length,T=k.textContent.length);const B=c||0===k.textContent.length;0===k.textContent.length&&(r.removeItem(k),k=E),T=B?k.textContent.length:T;const I={s:0,e:0},R=r.getNodePath(E,b,I),D=!k.parentNode;D&&(k=E);const M={s:0,e:0},O=r.getNodePath(k,b,D||B?null:M);S+=I.s,T=u?S:D?E.textContent.length:B?T+I.s:T+M.s;const P=r.mergeSameTags(b,R,O,!0);return e.parentNode.replaceChild(b,e),E=r.getNodeFromPath(R,b),k=r.getNodeFromPath(O,b),{startContainer:E,startOffset:S+P.a,endContainer:k,endOffset:T+P.b}},_nodeChange_startLine:function(e,t,i,n,l,s,o,a,c,d){let u=n.parentNode;for(;!(u.nextSibling||u.previousSibling||r.isFormatElement(u.parentNode)||r.isWysiwygDiv(u.parentNode))&&u.nodeName!==t.nodeName;)u=u.parentNode;if(!o&&u.nodeName===t.nodeName&&!r.isFormatElement(u)&&!u.nextSibling&&r.onlyZeroWidthSpace(n.textContent.slice(0,l))){let e=!0,i=n.previousSibling;for(;i;){if(!r.onlyZeroWidthSpace(i)){e=!1;break}i=i.previousSibling}if(e)return r.copyTagAttributes(u,t),{container:n,offset:l}}a.v=!1;const h=e,p=[t],g=e.cloneNode(!1);let m,f,_,b,y=n,v=l,x=!1;if(function e(n,l){const s=n.childNodes;for(let n,o=0,a=s.length;o<a;o++){const u=s[o];if(!u)continue;let C=l;if(x&&!r.isBreak(u)){if(1===u.nodeType){r._isIgnoreNodeChange(u)?(t=t.cloneNode(!1),g.appendChild(u),g.appendChild(t),p.push(t),o--,a--):e(u,u);continue}f=u,m=[];const s=[];for(;null!==f.parentNode&&f!==h&&f!==t;)n=i(f),1===f.nodeType&&n&&(d(n)?b||s.push(n):m.push(n)),f=f.parentNode;m=m.concat(s);const y=m.length>0,v=m.pop()||u;for(_=f=v;m.length>0;)f=m.pop(),_.appendChild(f),_=f;if(d(t.parentNode)&&!d(v)&&(t=t.cloneNode(!1),g.appendChild(t),p.push(t)),!b&&d(v)){t=t.cloneNode(!1);const e=v.childNodes;for(let i=0,n=e.length;i<n;i++)t.appendChild(e[i]);v.appendChild(t),g.appendChild(v),l=d(f)?t:f,p.push(t)}else y?(t.appendChild(v),l=f):l=t;if(b&&3===u.nodeType)if(c(u)){const e=r.getParentElement(l,function(e){return this._isMaintainedNode(e.parentNode)||e.parentNode===g}.bind(r));b.appendChild(e),t=e.cloneNode(!1),p.push(t),g.appendChild(t)}else b=null}if(x||u!==y)n=x?i(u):u.cloneNode(!1),n&&(l.appendChild(n),1!==u.nodeType||r.isBreak(u)||(C=n)),e(u,C);else{let e=g;b=c(u);const s=r.createTextNode(1===y.nodeType?"":y.substringData(0,v)),o=r.createTextNode(1===y.nodeType?"":y.substringData(v,y.length-v));if(b){const t=c(l);if(t&&t.parentNode!==e){let i=t,n=null;for(;i.parentNode!==e;){for(l=n=i.parentNode.cloneNode(!1);i.childNodes[0];)n.appendChild(i.childNodes[0]);i.appendChild(n),i=i.parentNode}i.parentNode.appendChild(t)}b=b.cloneNode(!1)}r.onlyZeroWidthSpace(s)||l.appendChild(s);const a=c(l);for(a&&(b=a),b&&(e=b),f=l,m=[];f!==e&&null!==f;)n=i(f),1===f.nodeType&&n&&m.push(n),f=f.parentNode;const d=m.pop()||l;for(_=f=d;m.length>0;)f=m.pop(),_.appendChild(f),_=f;d!==l?(t.appendChild(d),l=f):l=t,r.isBreak(u)&&t.appendChild(u.cloneNode(!1)),e.appendChild(t),y=o,v=0,x=!0,l.appendChild(y)}}}(e,g),o&&!s&&!a.v)return{container:n,offset:l};if(s=s&&o)for(let e=0;e<p.length;e++){let t=p[e],i=r.createTextNode(t.textContent);g.replaceChild(i,t),0===e&&(y=i)}else if(o)for(let e=0;e<p.length;e++)this._stripRemoveNode(p[e]);if(s||0!==g.childNodes.length){r.removeEmptyNode(g,t),r.onlyZeroWidthSpace(g.textContent)&&(y=g.firstChild,v=0);const i={s:0,e:0},n=r.getNodePath(y,g,i);v+=i.s;const l=r.mergeSameTags(g,n,null,!0);e.parentNode.replaceChild(g,e),y=r.getNodeFromPath(n,g),v+=l.a}else e.childNodes?y=e.childNodes[0]:(y=r.createTextNode(r.zeroWidthSpace),e.appendChild(y));return{container:y,offset:v}},_nodeChange_middleLine:function(e,t,i,n,l,s){if(!l){const i=e.cloneNode(!0),n=t.nodeName,l=t.style.cssText,s=t.className;let o,a=i.childNodes,c=0,d=a.length;for(;c<d&&(o=a[c],3!==o.nodeType);c++){if(o.nodeName!==n){if(r._isIgnoreNodeChange(o))continue;if(1===d){a=o.childNodes,d=a.length,c=-1;continue}break}o.style.cssText+=l,r.addClass(o,s)}if(d>0&&c===d)return void(e.innerHTML=i.innerHTML)}s.v=!1;const o=e.cloneNode(!1),a=[t];let c=!0;if(function e(n,l){const s=n.childNodes;for(let n,d=0,u=s.length;d<u;d++){let h=s[d];if(!h)continue;let p=l;r.isBreak(h)||!r._isIgnoreNodeChange(h)?(n=i(h),n&&(c=!1,l.appendChild(n),1===h.nodeType&&(p=n)),r.isBreak(h)||e(h,p)):(t.childNodes.length>0&&(o.appendChild(t),t=t.cloneNode(!1)),o.appendChild(h),o.appendChild(t),a.push(t),l=t,d--,u--)}}(e,t),!c&&(!l||n||s.v)){if(o.appendChild(t),n&&l)for(let e=0;e<a.length;e++){let t=a[e],i=r.createTextNode(t.textContent);o.replaceChild(i,t)}else if(l)for(let e=0;e<a.length;e++)this._stripRemoveNode(a[e]);r.removeEmptyNode(o,t),r.mergeSameTags(o,null,null,!0),e.parentNode.replaceChild(o,e)}},_nodeChange_endLine:function(e,t,i,n,l,s,o,a,c,d){let u=n.parentNode;for(;!(u.nextSibling||u.previousSibling||r.isFormatElement(u.parentNode)||r.isWysiwygDiv(u.parentNode))&&u.nodeName!==t.nodeName;)u=u.parentNode;if(!o&&u.nodeName===t.nodeName&&!r.isFormatElement(u)&&!u.previousSibling&&r.onlyZeroWidthSpace(n.textContent.slice(l))){let e=!0,i=n.nextSibling;for(;i;){if(!r.onlyZeroWidthSpace(i)){e=!1;break}i=i.nextSibling}if(e)return r.copyTagAttributes(u,t),{container:n,offset:l}}a.v=!1;const h=e,p=[t],g=e.cloneNode(!1);let m,f,_,b,y=n,v=l,x=!1;if(function e(n,l){const s=n.childNodes;for(let n,o=s.length-1;0<=o;o--){const a=s[o];if(!a)continue;let u=l;if(x&&!r.isBreak(a)){if(1===a.nodeType){r._isIgnoreNodeChange(a)?(t=t.cloneNode(!1),g.insertBefore(a,l),g.insertBefore(t,a),p.push(t),o++):e(a,a);continue}f=a,m=[];const s=[];for(;null!==f.parentNode&&f!==h&&f!==t;)n=i(f),n&&1===f.nodeType&&(d(n)?b||s.push(n):m.push(n)),f=f.parentNode;m=m.concat(s);const u=m.length>0,y=m.pop()||a;for(_=f=y;m.length>0;)f=m.pop(),_.appendChild(f),_=f;if(d(t.parentNode)&&!d(y)&&(t=t.cloneNode(!1),g.insertBefore(t,g.firstChild),p.push(t)),!b&&d(y)){t=t.cloneNode(!1);const e=y.childNodes;for(let i=0,n=e.length;i<n;i++)t.appendChild(e[i]);y.appendChild(t),g.insertBefore(y,g.firstChild),p.push(t),l=t.children.length>0?f:t}else u?(t.insertBefore(y,t.firstChild),l=f):l=t;if(b&&3===a.nodeType)if(c(a)){const e=r.getParentElement(l,function(e){return this._isMaintainedNode(e.parentNode)||e.parentNode===g}.bind(r));b.appendChild(e),t=e.cloneNode(!1),p.push(t),g.insertBefore(t,g.firstChild)}else b=null}if(x||a!==y)n=x?i(a):a.cloneNode(!1),n&&(l.insertBefore(n,l.firstChild),1!==a.nodeType||r.isBreak(a)||(u=n)),e(a,u);else{b=c(a);const e=r.createTextNode(1===y.nodeType?"":y.substringData(v,y.length-v)),s=r.createTextNode(1===y.nodeType?"":y.substringData(0,v));if(b){b=b.cloneNode(!1);const e=c(l);if(e&&e.parentNode!==g){let t=e,i=null;for(;t.parentNode!==g;){for(l=i=t.parentNode.cloneNode(!1);t.childNodes[0];)i.appendChild(t.childNodes[0]);t.appendChild(i),t=t.parentNode}t.parentNode.insertBefore(e,t.parentNode.firstChild)}b=b.cloneNode(!1)}else d(t.parentNode)&&!b&&(t=t.cloneNode(!1),g.appendChild(t),p.push(t));for(r.onlyZeroWidthSpace(e)||l.insertBefore(e,l.firstChild),f=l,m=[];f!==g&&null!==f;)n=d(f)?null:i(f),n&&1===f.nodeType&&m.push(n),f=f.parentNode;const o=m.pop()||l;for(_=f=o;m.length>0;)f=m.pop(),_.appendChild(f),_=f;o!==l?(t.insertBefore(o,t.firstChild),l=f):l=t,r.isBreak(a)&&t.appendChild(a.cloneNode(!1)),b?(b.insertBefore(t,b.firstChild),g.insertBefore(b,g.firstChild),b=null):g.insertBefore(t,g.firstChild),y=s,v=s.data.length,x=!0,l.insertBefore(y,l.firstChild)}}}(e,g),o&&!s&&!a.v)return{container:n,offset:l};if(s=s&&o)for(let e=0;e<p.length;e++){let t=p[e],i=r.createTextNode(t.textContent);g.replaceChild(i,t),e===p.length-1&&(y=i,v=i.textContent.length)}else if(o)for(let e=0;e<p.length;e++)this._stripRemoveNode(p[e]);if(s||0!==g.childNodes.length){r.removeEmptyNode(g,t),r.onlyZeroWidthSpace(g.textContent)?(y=g.firstChild,v=y.textContent.length):r.onlyZeroWidthSpace(y)&&(y=g,v=0);const i={s:0,e:0},n=r.getNodePath(y,g,i);v+=i.s;const l=r.mergeSameTags(g,n,null,!0);e.parentNode.replaceChild(g,e),y=r.getNodeFromPath(n,g),v+=l.a}else e.childNodes?y=e.childNodes[0]:(y=r.createTextNode(r.zeroWidthSpace),e.appendChild(y));return{container:y,offset:v}},actionCall:function(e,t,i){if(t){if(/submenu/.test(t)&&(null===i.nextElementSibling||i!==this.submenuActiveButton))return void this.callPlugin(e,this.submenuOn.bind(this,i),i);if(/dialog/.test(t))return void this.callPlugin(e,this.plugins[e].open.bind(this),i);if(/command/.test(t))this.callPlugin(e,this.plugins[e].action.bind(this),i);else if(/container/.test(t)&&(null===i.nextElementSibling||i!==this.containerActiveButton))return void this.callPlugin(e,this.containerOn.bind(this,i),i)}else e&&this.commandHandler(i,e);/submenu/.test(t)?this.submenuOff():(this.submenuOff(),this.containerOff())},commandHandler:function(t,i){switch(i){case"selectAll":const n=e.element.wysiwyg,s=r.getChildElement(n.firstChild,(function(e){return 0===e.childNodes.length||3===e.nodeType}),!1)||n.firstChild,o=r.getChildElement(n.lastChild,(function(e){return 0===e.childNodes.length||3===e.nodeType}),!0)||n.lastChild;this.setRange(s,0,o,o.textContent.length),this.focus();break;case"codeView":this.toggleCodeView(),r.toggleClass(t,"active");break;case"fullScreen":this.toggleFullScreen(t),r.toggleClass(t,"active");break;case"indent":case"outdent":this.indent(i);break;case"undo":this.history.undo();break;case"redo":this.history.redo();break;case"removeFormat":this.removeFormat(),this.focus();break;case"print":this.print();break;case"preview":this.preview();break;case"showBlocks":this.toggleDisplayBlocks(),r.toggleClass(t,"active");break;case"save":if("function"==typeof l.callBackSave)l.callBackSave(this.getContents(!1));else{if("function"!=typeof g.save)throw Error("[SUNEDITOR.core.commandHandler.fail] Please register call back function in creation option. (callBackSave : Function)");g.save()}e.tool.save&&e.tool.save.setAttribute("disabled",!0);break;default:i=this._defaultCommand[i.toLowerCase()]||i,this.commandMap[i]||(this.commandMap[i]=t);const a=r.hasClass(this.commandMap[i],"active")?null:r.createElement(i);let c=i;/^SUB$/i.test(i)&&r.hasClass(this.commandMap.SUP,"active")?c="SUP":/^SUP$/i.test(i)&&r.hasClass(this.commandMap.SUB,"active")&&(c="SUB"),this.nodeChange(a,null,[c],!1),this.focus()}},removeFormat:function(){this.nodeChange(null,null,null,null)},indent:function(e){const t=this.getSelectedElements(),i=[],n="indent"!==e;for(let e,l,s=0,o=t.length;s<o;s++)e=t[s],r.isListCell(e)&&c.plugins.list?(n||e.previousElementSibling)&&i.push(e):(l=/\d+/.test(e.style.marginLeft)?r.getNumber(e.style.marginLeft,0):0,n?l-=25:l+=25,r.setStyle(e,"marginLeft",l<=0?"":l+"px"));i.length>0&&c.plugins.list.editInsideList.call(c,n,i),this._lastEffectNode=null,d._applyTagEffects(),this.history.push(!1)},toggleDisplayBlocks:function(){r.toggleClass(e.element.wysiwyg,"se-show-block"),this._resourcesStateChange()},toggleCodeView:function(){const t=this._variable.isCodeView,i=this.codeViewDisabledButtons;for(let e=0,n=i.length;e<n;e++)i[e].disabled=!t;this.controllersOff(),t?(this._setCodeDataToEditor(),e.element.wysiwygFrame.scrollTop=0,e.element.code.style.display="none",e.element.wysiwygFrame.style.display="block",this._variable._codeOriginCssText=this._variable._codeOriginCssText.replace(/(\s?display(\s+)?:(\s+)?)[a-zA-Z]+(?=;)/,"display: none"),this._variable._wysiwygOriginCssText=this._variable._wysiwygOriginCssText.replace(/(\s?display(\s+)?:(\s+)?)[a-zA-Z]+(?=;)/,"display: block"),"auto"!==l.height||l.codeMirrorEditor||(e.element.code.style.height="0px"),this._variable.isCodeView=!1,this._variable.isFullScreen||(this._notHideToolbar=!1,/balloon|balloon-always/i.test(l.mode)&&(e.element._arrow.style.display="",this._isInline=!1,this._isBalloon=!0,d._hideToolbar())),this._resourcesStateChange(),this._checkComponents(),this.focus(),this.history.push(!1)):(this._setEditorDataToCodeView(),this._variable._codeOriginCssText=this._variable._codeOriginCssText.replace(/(\s?display(\s+)?:(\s+)?)[a-zA-Z]+(?=;)/,"display: block"),this._variable._wysiwygOriginCssText=this._variable._wysiwygOriginCssText.replace(/(\s?display(\s+)?:(\s+)?)[a-zA-Z]+(?=;)/,"display: none"),"auto"!==l.height||l.codeMirrorEditor||(e.element.code.style.height=e.element.code.scrollHeight>0?e.element.code.scrollHeight+"px":"auto"),l.codeMirrorEditor&&l.codeMirrorEditor.refresh(),this._variable.isCodeView=!0,this._variable.isFullScreen||(this._notHideToolbar=!0,this._isBalloon&&(e.element._arrow.style.display="none",e.element.toolbar.style.left="",this._isInline=!0,this._isBalloon=!1,d._showToolbarInline())),this._variable._range=null,e.element.code.focus()),this._checkPlaceholder()},_setCodeDataToEditor:function(){const t=this._getCodeView();if(l.fullPage){const e=(new this._w.DOMParser).parseFromString(t,"text/html"),i=e.head.children;for(let t=0,n=i.length;t<n;t++)/script/i.test(i[t].tagName)&&(e.head.removeChild(i[t]),t--,n--);this._wd.head.innerHTML=e.head.innerHTML,this._wd.body.innerHTML=this.convertContentsForEditor(e.body.innerHTML);const n=e.body.attributes;for(let e=0,t=n.length;e<t;e++)"contenteditable"!==n[e].name&&this._wd.body.setAttribute(n[e].name,n[e].value);r.hasClass(this._wd.body,"sun-editor-editable")||r.addClass(this._wd.body,"sun-editor-editable")}else e.element.wysiwyg.innerHTML=t.length>0?this.convertContentsForEditor(t):"<p><br></p>"},_setEditorDataToCodeView:function(){const t=this.convertHTMLForCodeView(e.element.wysiwyg);let i="";if(l.fullPage){const e=r.getAttributesToString(this._wd.body,null);i="<!DOCTYPE html>\n<html>\n"+this._wd.head.outerHTML.replace(/>(?!\n)/g,">\n")+"<body "+e+">\n"+t+"</body>\n</html>"}else i=t;e.element.code.style.display="block",e.element.wysiwygFrame.style.display="none",this._setCodeView(i)},toggleFullScreen:function(t){const i=e.element.topArea,n=e.element.toolbar,o=e.element.editorArea,c=e.element.wysiwygFrame,u=e.element.code,h=this._variable;h.isFullScreen?(h.isFullScreen=!1,c.style.cssText=h._wysiwygOriginCssText,u.style.cssText=h._codeOriginCssText,n.style.cssText="",o.style.cssText=h._editorAreaOriginCssText,i.style.cssText=h._originCssText,s.body.style.overflow=h._bodyOverflow,l.stickyToolbar>-1&&r.removeClass(n,"se-toolbar-sticky"),h._fullScreenAttrs.sticky&&(h._fullScreenAttrs.sticky=!1,e.element._stickyDummy.style.display="block",r.addClass(n,"se-toolbar-sticky")),this._isInline=h._fullScreenAttrs.inline,this._isBalloon=h._fullScreenAttrs.balloon,this._isInline&&d._showToolbarInline(),d.onScroll_window(),r.removeClass(t.firstElementChild,"se-icon-reduction"),r.addClass(t.firstElementChild,"se-icon-expansion")):(h.isFullScreen=!0,h._fullScreenAttrs.inline=this._isInline,h._fullScreenAttrs.balloon=this._isBalloon,(this._isInline||this._isBalloon)&&(this._isInline=!1,this._isBalloon=!1),i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.style.zIndex="2147483647",""!==e.element._stickyDummy.style.display&&(h._fullScreenAttrs.sticky=!0,e.element._stickyDummy.style.display="none",r.removeClass(n,"se-toolbar-sticky")),h._bodyOverflow=s.body.style.overflow,s.body.style.overflow="hidden",h._editorAreaOriginCssText=o.style.cssText,h._wysiwygOriginCssText=c.style.cssText,h._codeOriginCssText=u.style.cssText,o.style.cssText=n.style.cssText="",c.style.cssText=(c.style.cssText.match(/\s?display(\s+)?:(\s+)?[a-zA-Z]+;/)||[""])[0],u.style.cssText=(u.style.cssText.match(/\s?display(\s+)?:(\s+)?[a-zA-Z]+;/)||[""])[0],n.style.width=c.style.height=u.style.height="100%",n.style.position="relative",n.style.display="block",h.innerHeight_fullScreen=a.innerHeight-n.offsetHeight,o.style.height=h.innerHeight_fullScreen+"px",r.removeClass(t.firstElementChild,"se-icon-expansion"),r.addClass(t.firstElementChild,"se-icon-reduction"),l.iframe&&"auto"===l.height&&(o.style.overflow="auto",this._iframeAutoHeight()))},print:function(){const t=r.createElement("IFRAME");t.style.display="none",s.body.appendChild(t);const i=r.getIframeDocument(t),n=this.getContents(!0);if(l.iframe){const t=r.getIframeDocument(e.element.wysiwygFrame),s=l.fullPage?r.getAttributesToString(t.body,["contenteditable"]):'class="sun-editor-editable"';i.write("<!DOCTYPE html><html><head>"+t.head.innerHTML+"<style>"+r.getPageStyle(e.element.wysiwygFrame)+"</style></head><body "+s+">"+n+"</body></html>")}else{const e=r.createElement("DIV"),t=r.createElement("STYLE");t.innerHTML=r.getPageStyle(),e.className="sun-editor-editable",e.innerHTML=n,i.head.appendChild(t),i.body.appendChild(e)}try{if(t.focus(),-1!==a.navigator.userAgent.indexOf("MSIE")||s.documentMode||a.StyleMedia)try{t.contentWindow.document.execCommand("print",!1,null)}catch(e){t.contentWindow.print()}else t.contentWindow.print()}catch(e){throw Error("[SUNEDITOR.core.print.fail] error: "+e)}finally{r.removeItem(t)}},preview:function(){const t=this.getContents(!0),i=a.open("","_blank");if(i.mimeType="text/html",l.iframe){const n=r.getIframeDocument(e.element.wysiwygFrame),s=l.fullPage?r.getAttributesToString(n.body,["contenteditable"]):'class="sun-editor-editable"';i.document.write("<!DOCTYPE html><html><head>"+n.head.innerHTML+"<style>body {overflow: auto !important;}</style></head><body "+s+">"+t+"</body></html>")}else i.document.write('<!DOCTYPE html><html><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1"><title>'+n.toolbar.preview+"</title><style>"+r.getPageStyle()+'</style></head><body class="sun-editor-editable">'+t+"</body></html>")},setContents:function(t){const i=this.convertContentsForEditor(t);if(this._resetComponents(),c._variable.isCodeView){const e=this.convertHTMLForCodeView(i);c._setCodeView(e)}else e.element.wysiwyg.innerHTML=i,c.history.push(!1)},getContents:function(t){const i=e.element.wysiwyg.innerHTML,n=r.createElement("DIV");n.innerHTML=i;const s=r.getListChildren(n,(function(e){return/FIGCAPTION/i.test(e.nodeName)}));for(let e=0,t=s.length;e<t;e++)s[e].removeAttribute("contenteditable");if(l.fullPage&&!t){const e=r.getAttributesToString(this._wd.body,["contenteditable"]);return"<!DOCTYPE html><html>"+this._wd.head.outerHTML+"<body "+e+">"+n.innerHTML+"</body></html>"}return n.innerHTML},cleanHTML:function(e,t){const i=new this._w.RegExp("^(meta|script|link|style|[a-z]+:[a-z]+)$","i"),n=this._d.createRange().createContextualFragment(e).childNodes;let l="";for(let e=0,t=n.length;e<t;e++)i.test(n[e].nodeName)||(l+=1===n[e].nodeType?n[e].outerHTML:3===n[e].nodeType?n[e].textContent:"");return l=l.replace(/<(script|style).*>(\n|.)*<\/(script|style)>/g,"").replace(/(<[a-zA-Z0-9]+)[^>]*(?=>)/g,function(e,t){let i=null;const n=this._attributesTagsWhitelist[t.match(/(?!<)[a-zA-Z]+/)[0].toLowerCase()];if(i=n?e.match(n):e.match(this._attributesWhitelistRegExp),i)for(let e=0,n=i.length;e<n;e++)/^class="(?!(__se__|se-))/.test(i[e])||(t+=" "+i[e]);return t}.bind(this)).replace(/<\/?(span[^>^<]*)>/g,""),r._tagConvertor(l?t?l.replace("string"==typeof t?r.createTagsWhitelist(t):t,""):l:e)},addDocEvent:function(e,t,i){s.addEventListener(e,t,i),l.iframe&&this._wd.addEventListener(e,t)},removeDocEvent:function(e,t){s.removeEventListener(e,t),l.iframe&&this._wd.removeEventListener(e,t)},convertContentsForEditor:function(e){let t="",i=this._d.createRange().createContextualFragment(e).childNodes;for(let e,n=0,l=i.length;n<l;n++)if(e=i[n].outerHTML||i[n].textContent,3===i[n].nodeType){const i=e.split(/\n/g);let n="";for(let e=0,l=i.length;e<l;e++)n=i[e].trim(),n.length>0&&(t+="<p>"+n+"</p>")}else t+=e.replace(/<(?!span|font|b|strong|var|i|em|u|ins|s|strike|del|sub|sup|mark|a|label)[^>^<]+>\s+(?=<)/g,(function(e){return e.trim()}));return 0===t.length&&(t="<p>"+((e=r._HTMLConvertor(e)).length>0?e:"<br>")+"</p>"),r._tagConvertor(t.replace(this.editorTagsWhitelistRegExp,""))},convertHTMLForCodeView:function(e){let t="";const i=this._w.RegExp,n=new i("^(BLOCKQUOTE|PRE|TABLE|THEAD|TBODY|TR|TH|TD|OL|UL|IMG|IFRAME|VIDEO|AUDIO|FIGURE|FIGCAPTION|HR|BR|CANVAS|SELECT)$","i"),l=r.isFormatElement.bind(r),s="string"==typeof e?this._d.createRange().createContextualFragment(e):e;let o=1*this._variable.codeIndent;return o=o>0?new this._w.Array(o+1).join(" "):"",function e(s,a,c){const d=s.childNodes,u=n.test(s.nodeName),h=u?a:"";for(let p,g,m,f=0,_=d.length;f<_;f++){if(p=d[f],m=n.test(p.nodeName),g=m?"\n":"",c=!l(p)||u||/^(TH|TD)$/i.test(s.nodeName)?"":"\n",3===p.nodeType){t+=r._HTMLConvertor(/^\n+$/.test(p.data)?"":p.data);continue}if(0===p.childNodes.length){t+=(/^(HR)$/i.test(p.nodeName)?"\n":"")+h+p.outerHTML+g;continue}p.innerHTML=p.innerHTML;const _=p.nodeName.toLowerCase();t+=(c||(u?"":g))+(h||m?a:"")+p.outerHTML.match(i("<"+_+"[^>]*>","i"))[0]+g,e(p,a+o,""),t+=(m?a:"")+"</"+_+">"+(c||g||u?"\n":/^(TH|TD)$/i.test(p.nodeName)?"\n":"")}}(s,"","\n"),t.trim()+"\n"},_charCount:function(t,i){const n=e.element.charCounter;if(!n)return!0;(!t||t<0)&&(t=0);const s=l.maxCharCount;if(a.setTimeout((function(){n.textContent=e.element.wysiwyg.textContent.length})),s>0){let l=!1;const o=e.element.wysiwyg.textContent.length;if(o>s){c._editorRange();const e=c.getRange(),t=e.endOffset-1,i=c.getSelectionNode().textContent;c.getSelectionNode().textContent=i.slice(0,e.endOffset-1)+i.slice(e.endOffset,i.length),c.setRange(e.endContainer,t,e.endContainer,t),l=!0}else o+t>s&&(l=!0);if(l)return i&&!r.hasClass(n,"se-blink")&&(r.addClass(n,"se-blink"),a.setTimeout((function(){r.removeClass(n,"se-blink")}),600)),!1}return!0},_checkComponents:function(){this.plugins.image&&(this.initPlugins.image?this.plugins.image.checkImagesInfo.call(this):this.callPlugin("image",this.plugins.image.checkImagesInfo.bind(this))),this.plugins.video&&(this.initPlugins.video?this.plugins.video.checkVideosInfo.call(this):this.callPlugin("video",this.plugins.video.checkVideosInfo.bind(this)))},_resetComponents:function(){this._variable._imagesInfo=[],this._variable._imageIndex=0,this._variable._videosCnt=0},_setCodeView:function(t){l.codeMirrorEditor?l.codeMirrorEditor.getDoc().setValue(t):e.element.code.value=t},_getCodeView:function(){return l.codeMirrorEditor?l.codeMirrorEditor.getDoc().getValue():e.element.code.value},_init:function(n,o){this._ww=l.iframe?e.element.wysiwygFrame.contentWindow:a,this._wd=s,a.setTimeout(function(){if(this._checkComponents(),this._imagesInfoInit=!1,this._imagesInfoReset=!1,this.history.reset(!0),l.iframe&&(this._wd=e.element.wysiwygFrame.contentDocument,e.element.wysiwyg=this._wd.body,"auto"===l.height&&(this._iframeAuto=this._wd.body),this._iframeAutoHeight()),"function"==typeof g.onload)return g.onload(c,n)}.bind(this)),this.editorTagsWhitelistRegExp=r.createTagsWhitelist(l._editorTagsWhitelist),this.pasteTagsWhitelistRegExp=r.createTagsWhitelist(l.pasteTagsWhitelist);const u=l.attributesWhitelist,h={};let p,m,f="";if(u){const e=a.Object.keys(u);for(let t,i=0,n=e.length;i<n;i++)t=e[i],"all"===t?f=u[t]+"|":h[t]=new a.RegExp("((?:"+u[t]+')s*=s*"[^"]*")',"ig")}this._attributesWhitelistRegExp=new a.RegExp("((?:"+f+'contenteditable|colspan|rowspan|target|href|src|class|type|data-format|data-size|data-file-size|data-file-name|data-origin|data-align|data-image-link|data-rotate|data-proportion|data-percentage|origin-size)s*=s*"[^"]*")',"ig"),this._attributesTagsWhitelist=h,this.codeViewDisabledButtons=e.element.toolbar.querySelectorAll('.se-toolbar button:not([class~="code-view-enabled"])'),this._isInline=/inline/i.test(l.mode),this._isBalloon=/balloon|balloon-always/i.test(l.mode),this._isBalloonAlways=/balloon-always/i.test(l.mode),this.commandMap={STRONG:e.tool.bold,INS:e.tool.underline,EM:e.tool.italic,DEL:e.tool.strike,SUB:e.tool.subscript,SUP:e.tool.superscript,OUTDENT:e.tool.outdent,INDENT:e.tool.indent},this.activePlugins=[];for(let e in i)p=i[e],m=t[e],p.active&&m&&c.callPlugin(e,null,m);this._variable._originCssText=e.element.topArea.style.cssText,this._placeholder=e.element.placeholder,n?o&&(this.context.element.wysiwyg.innerHTML=o):this.context.element.wysiwyg.innerHTML=this.convertContentsForEditor(e.element.originElement.value),this._checkPlaceholder(),this.history=function(e,t){const i=window,n=e.context.element,l=e.util,s=e.context.tool.undo,o=e.context.tool.redo;let a=null,r=0,c=[];function d(){const i=c[r];n.wysiwyg.innerHTML=i.contents,e.setRange(l.getNodeFromPath(i.s.path,n.wysiwyg),i.s.offset,l.getNodeFromPath(i.e.path,n.wysiwyg),i.e.offset),e.focus(),0===r?(s&&s.setAttribute("disabled",!0),o&&o.removeAttribute("disabled")):r===c.length-1?(s&&s.removeAttribute("disabled"),o&&o.setAttribute("disabled",!0)):(s&&s.removeAttribute("disabled"),o&&o.removeAttribute("disabled")),e._checkComponents(),e._charCount(0,!1),e._resourcesStateChange(),t()}function u(){const i=e.getContents(!0);if(c[r]&&i===c[r].contents)return;r++;const n=e.getRange();c.length>r&&(c=c.slice(0,r),o&&o.setAttribute("disabled",!0)),c[r]={contents:i,s:{path:l.getNodePath(n.startContainer,null),offset:n.startOffset},e:{path:l.getNodePath(n.endContainer,null),offset:n.endOffset}},1===r&&s&&s.removeAttribute("disabled"),e._checkComponents(),e._charCount(0,!1),t()}return{stack:c,push:function(t){i.setTimeout(e._resourcesStateChange),t&&!a||(i.clearTimeout(a),t)?a=i.setTimeout((function(){i.clearTimeout(a),a=null,u()}),350):u()},undo:function(){r>0&&(r--,d())},redo:function(){c.length-1>r&&(r++,d())},go:function(e){r=e<0?c.length-1:e,d()},reset:function(i){s&&s.setAttribute("disabled",!0),o&&o.setAttribute("disabled",!0),e.context.tool.save&&e.context.tool.save.setAttribute("disabled",!0),c.splice(0),r=0,c[r]={contents:e.getContents(!0),s:{path:[0,0],offset:0},e:{path:[0,0],offset:0}},i||t()},_destroy:function(){a&&i.clearTimeout(a),c=null}}}(this,d._onChange_historyStack)},_resourcesStateChange:function(){c._iframeAutoHeight(),c._checkPlaceholder()},_iframeAutoHeight:function(){this._iframeAuto&&(e.element.wysiwygFrame.style.height=this._iframeAuto.offsetHeight+"px")},_checkPlaceholder:function(){if(this._placeholder){if(this._variable.isCodeView)return void(this._placeholder.style.display="none");const t=e.element.wysiwyg;!r.onlyZeroWidthSpace(t.textContent)||t.querySelector(".se-component, pre, blockquote, hr, li, table, img, iframe, video")||(t.innerText.match(/\n/g)||"").length>1?this._placeholder.style.display="none":this._placeholder.style.display="block"}}},d={_directionKeyCode:new a.RegExp("^(8|13|3[2-9]|40|46)$"),_nonTextKeyCode:new a.RegExp("^(8|13|1[6-9]|20|27|3[3-9]|40|45|46|11[2-9]|12[0-3]|144|145)$"),_historyIgnoreKeyCode:new a.RegExp("^(1[6-9]|20|27|3[3-9]|40|45|11[2-9]|12[0-3]|144|145)$"),_onButtonsCheck:new a.RegExp("^(STRONG|INS|EM|DEL|SUB|SUP)$"),_frontZeroWidthReg:new a.RegExp(r.zeroWidthSpace+"+",""),_keyCodeShortcut:{65:"A",66:"B",83:"S",85:"U",73:"I",89:"Y",90:"Z",219:"[",221:"]"},_shortcutCommand:function(e,t){let i=null;switch(d._keyCodeShortcut[e]){case"A":i="selectAll";break;case"B":i="STRONG";break;case"S":t&&(i="DEL");break;case"U":i="INS";break;case"I":i="EM";break;case"Z":i=t?"redo":"undo";break;case"Y":i="redo";break;case"[":i="outdent";break;case"]":i="indent"}return!!i&&(c.commandHandler(c.commandMap[i],i),!0)},_applyTagEffects:function(){let t=c.getSelectionNode();if(t===c._lastEffectNode)return;c._lastEffectNode=t;const n=c.commandMap,s=this._onButtonsCheck,o=[],a=[],d=c.activePlugins,u=d.length;let h="";for(;t.firstChild;)t=t.firstChild;for(let e=t;!r.isWysiwygDiv(e)&&e;e=e.parentNode)if(1===e.nodeType&&!r.isBreak(e)){h=e.nodeName.toUpperCase(),a.push(h);for(let t,n=0;n<u;n++)t=d[n],-1===o.indexOf(t)&&i[t].active.call(c,e)&&o.push(t);r.isFormatElement(e)?(-1===o.indexOf("OUTDENT")&&n.OUTDENT&&(r.isListCell(e)||e.style.marginLeft&&r.getNumber(e.style.marginLeft,0)>0)&&(o.push("OUTDENT"),n.OUTDENT.removeAttribute("disabled")),-1===o.indexOf("INDENT")&&n.INDENT&&r.isListCell(e)&&!e.previousElementSibling&&(o.push("INDENT"),n.INDENT.setAttribute("disabled",!0))):s.test(h)&&(o.push(h),r.addClass(n[h],"active"))}for(let e in n)o.indexOf(e)>-1||(d.indexOf(e)>-1?i[e].active.call(c,null):n.OUTDENT&&/^OUTDENT$/i.test(e)?n.OUTDENT.setAttribute("disabled",!0):n.INDENT&&/^INDENT$/i.test(e)?n.INDENT.removeAttribute("disabled"):r.removeClass(n[e],"active"));c._variable.currentNodes=a.reverse(),l.showPathLabel&&(e.element.navigation.textContent=c._variable.currentNodes.join(" > "))},_cancelCaptionEdit:function(){this.setAttribute("contenteditable",!1),this.removeEventListener("blur",d._cancelCaptionEdit)},onMouseDown_toolbar:function(e){let t=e.target;if(r.getParentElement(t,".se-submenu"))e.stopPropagation(),c._notHideToolbar=!0;else{e.preventDefault();let i=t.getAttribute("data-command"),n=t.className;for(;!i&&!/se-menu-list/.test(n)&&!/se-toolbar/.test(n);)t=t.parentNode,i=t.getAttribute("data-command"),n=t.className;i!==c._submenuName&&i!==c._containerName||e.stopPropagation()}},onClick_toolbar:function(e){e.preventDefault(),e.stopPropagation();let t=e.target,i=t.getAttribute("data-display"),n=t.getAttribute("data-command"),l=t.className;for(;!n&&!/se-menu-list/.test(l)&&!/se-toolbar/.test(l);)t=t.parentNode,n=t.getAttribute("data-command"),i=t.getAttribute("data-display"),l=t.className;(n||i)&&(t.disabled||(c.hasFocus||c.focus(),c._editorRange(),c.actionCall(n,i,t)))},onMouseDown_wysiwyg:function(t){if("false"===e.element.wysiwyg.getAttribute("contenteditable"))return;const i=r.getParentElement(t.target,r.isCell);if(i){const e=c.plugins.table;e&&i!==e._fixedCell&&!e._shift&&c.callPlugin("table",(function(){e.onTableCellMultiSelect.call(c,i,!1)}))}c._isBalloon&&d._hideToolbar(),g.onMouseDown&&g.onMouseDown(t,c)},onClick_wysiwyg:function(t){const i=t.target;if("false"===e.element.wysiwyg.getAttribute("contenteditable"))return;if(t.stopPropagation(),/^FIGURE$/i.test(i.nodeName)){const e=i.querySelector("IMG"),n=i.querySelector("IFRAME");if(e)return t.preventDefault(),void c.selectComponent(e,"image");if(n)return t.preventDefault(),void c.selectComponent(n,"video")}const n=r.getParentElement(i,"FIGCAPTION");if(n&&(!n.getAttribute("contenteditable")||"false"===n.getAttribute("contenteditable"))&&(t.preventDefault(),n.setAttribute("contenteditable",!0),n.focus(),c._isInline&&!c._inlineToolbarAttr.isShow)){d._showToolbarInline();const e=function(){d._hideToolbar(),n.removeEventListener("blur",e)};n.addEventListener("blur",e)}c._editorRange(),a.setTimeout(c._editorRange.bind(c));const l=c.getSelectionNode(),s=r.getFormatElement(l),o=r.getRangeFormatElement(l);if(!c.getRange().collapsed||s&&s!==o||"false"===i.getAttribute("contenteditable"))d._applyTagEffects();else{if(r.isList(o)){const e=r.createElement("LI"),t=l.nextElementSibling;e.appendChild(l),o.insertBefore(e,t)}else c.execCommand("formatBlock",!1,r.isRangeFormatElement(o)?"DIV":"P");t.preventDefault(),c.focus()}c._isBalloon&&a.setTimeout(d._toggleToolbarBalloon),g.onClick&&g.onClick(t,c)},_balloonDelay:null,_showToolbarBalloonDelay:function(){d._balloonDelay&&a.clearTimeout(d._balloonDelay),d._balloonDelay=a.setTimeout(function(){a.clearTimeout(this._balloonDelay),this._balloonDelay=null,this._showToolbarBalloon()}.bind(d),350)},_toggleToolbarBalloon:function(){c._editorRange();const e=c.getRange();"table"===c.currentControllerName||!c._isBalloonAlways&&e.collapsed?d._hideToolbar():d._showToolbarBalloon(e)},_showToolbarBalloon:function(t){if(!c._isBalloon)return;const i=t||c.getRange(),n=e.element.toolbar,l=c.getSelection();let s;if(l.focusNode===l.anchorNode)s=l.focusOffset<l.anchorOffset;else{const e=r.getListChildNodes(i.commonAncestorContainer);s=r.getArrayIndex(e,l.focusNode)<r.getArrayIndex(e,l.anchorNode)}let o=i.getClientRects();o=o[s?0:o.length-1];let u=0,h=0,p=e.element.topArea;for(;p;)u+=p.scrollLeft,h+=p.scrollTop,p=p.parentElement;const g=e.element.topArea.offsetWidth,m=d._getStickyOffsetTop();let f=0,_=e.element.topArea;for(;_&&!/^(BODY|HTML)$/i.test(_.nodeName);)f+=_.offsetLeft,_=_.offsetParent;if(n.style.visibility="hidden",n.style.display="block",!o){const t=c.getSelectionNode();if(r.isFormatElement(t)){const e=r.createTextNode(r.zeroWidthSpace);c.insertNode(e,null),c.setRange(e,1,e,1),c._editorRange(),o=c.getRange().getClientRects(),o=o[s?0:o.length-1]}if(!o){const i=r.getOffset(t,e.element.wysiwygFrame);o={left:i.left,top:i.top,right:i.left,bottom:i.top+t.offsetHeight,noText:!0},u=0,h=0}s=!0}const b=a.Math.round(e.element._arrow.offsetWidth/2),y=n.offsetWidth,v=n.offsetHeight,x=/iframe/i.test(e.element.wysiwygFrame.nodeName)?e.element.wysiwygFrame.getClientRects()[0]:null;x&&(o={left:o.left+x.left,top:o.top+x.top,right:o.right+x.right-x.width,bottom:o.bottom+x.bottom-x.height}),d._setToolbarOffset(s,o,n,f,g,u,h,m,b),y===n.offsetWidth&&v===n.offsetHeight||d._setToolbarOffset(s,o,n,f,g,u,h,m,b),n.style.visibility=""},_setToolbarOffset:function(t,i,n,l,s,o,c,d,u){const h=n.offsetWidth,p=i.noText&&!t?0:n.offsetHeight,g=(t?i.left:i.right)-l-h/2+o,m=g+h-s,f=(t?i.top-p-u:i.bottom+u)-(i.noText?0:d)+c;let _=g<0?1:m<0?g:g-m-1-1;n.style.left=a.Math.floor(_)+"px",n.style.top=a.Math.floor(f)+"px",t?(r.removeClass(e.element._arrow,"se-arrow-up"),r.addClass(e.element._arrow,"se-arrow-down"),e.element._arrow.style.top=p+"px"):(r.removeClass(e.element._arrow,"se-arrow-down"),r.addClass(e.element._arrow,"se-arrow-up"),e.element._arrow.style.top=-u+"px");const b=a.Math.floor(h/2+(g-_));e.element._arrow.style.left=(b+u>n.offsetWidth?n.offsetWidth-u:b<u?u:b)+"px"},_showToolbarInline:function(){if(!c._isInline)return;const t=e.element.toolbar;t.style.visibility="hidden",t.style.display="block",c._inlineToolbarAttr.width=t.style.width=l.toolbarWidth,c._inlineToolbarAttr.top=t.style.top=-1-t.offsetHeight+"px","function"==typeof g.showInline&&g.showInline(t,e,c),d.onScroll_window(),c._inlineToolbarAttr.isShow=!0,t.style.visibility=""},_hideToolbar:function(){c._notHideToolbar||c._variable.isFullScreen||(e.element.toolbar.style.display="none",c._inlineToolbarAttr.isShow=!1)},_onShortcutKey:!1,onKeyDown_wysiwyg:function(t){const i=t.keyCode,n=t.shiftKey,l=t.ctrlKey||t.metaKey,s=t.altKey;if(d._directionKeyCode.test(i)||a.setTimeout(c._resourcesStateChange),c._isBalloon&&d._hideToolbar(),l&&d._shortcutCommand(i,n))return d._onShortcutKey=!0,t.preventDefault(),t.stopPropagation(),!1;d._onShortcutKey&&(d._onShortcutKey=!1);const o=c.getSelectionNode(),u=c.getRange(),h=!u.collapsed||u.startContainer!==u.endContainer,p=c._resizingName;let m=r.getFormatElement(o)||o,f=r.getRangeFormatElement(m);switch(i){case 8:if(!h){if(p){t.preventDefault(),t.stopPropagation(),c.plugins[p].destroy.call(c);break}if(r.isWysiwygDiv(o.parentNode)&&r.isFormatElement(o)&&!r.isListCell(o)&&0===o.childNodes.length){if(t.preventDefault(),t.stopPropagation(),o.innerHTML="<br>",!o.nextElementSibling){const e=o.attributes;for(;e[0];)o.removeAttribute(e[0].name);c.execCommand("formatBlock",!1,"P")}return!1}}const i=u.commonAncestorContainer;if(m=r.getFormatElement(u.startContainer),f=r.getRangeFormatElement(m),f&&m&&!r.isCell(f)&&!/^FIGCAPTION$/i.test(f.nodeName)){if(r.isListCell(m)&&r.isList(f)&&(r.isListCell(f.parentNode)||m.previousElementSibling)&&(o===m||3===o.nodeType&&(!o.previousSibling||r.isList(o.previousSibling)))&&(r.getFormatElement(u.startContainer)!==r.getFormatElement(u.endContainer)?f.contains(u.startContainer):0===u.startOffset&&u.collapsed)){if(u.startContainer!==u.endContainer)t.preventDefault(),c.removeNode(),3===u.startContainer.nodeType&&c.setRange(u.startContainer,u.startContainer.textContent.length,u.startContainer,u.startContainer.textContent.length),c.history.push(!0);else{let e=m.previousElementSibling||f.parentNode;if(r.isListCell(e)){t.preventDefault();const i=e.lastElementChild;r.isList(i)&&(e=i.lastElementChild);let n=e===f.parentNode?f.previousSibling:e.lastChild;n||(n=r.createTextNode(r.zeroWidthSpace),f.parentNode.insertBefore(n,f.parentNode.firstChild));const l=3===n.nodeType?n.textContent.length:1,s=m.childNodes;let o=n,a=s[0];for(;a=s[0];)e.insertBefore(a,o.nextSibling),o=a;r.removeItem(m),0===f.children.length&&r.removeItem(f),c.setRange(n,l,n,l),c.history.push(!0)}}break}if(!h&&0===u.startOffset){let e=!0,n=i;for(;n&&n!==f&&!r.isWysiwygDiv(n);){if(n.previousSibling){e=!1;break}n=n.parentNode}if(e&&f.parentNode){t.preventDefault(),c.detachRangeFormatElement(f,r.isListCell(m)?[m]:null,null,!1,!1),c.history.push(!0);break}}}if(!h&&0===u.startOffset&&(r.isComponent(i.previousSibling)||3===i.nodeType&&!i.previousSibling&&0===u.startOffset&&0===u.endOffset&&r.isComponent(m.previousSibling))){const e=m.previousSibling;r.removeItem(e)}break;case 46:if(p){t.preventDefault(),t.stopPropagation(),c.plugins[p].destroy.call(c);break}if((r.isFormatElement(o)||null===o.nextSibling)&&u.startOffset===o.textContent.length){let e=m.nextElementSibling;if(r.isComponent(e)){t.preventDefault(),r.onlyZeroWidthSpace(m)&&r.removeItem(m),(r.hasClass(e,"se-component")||/^IMG$/i.test(e.nodeName))&&(t.stopPropagation(),r.hasClass(e,"se-image-container")||/^IMG$/i.test(e.nodeName)?(e=/^IMG$/i.test(e.nodeName)?e:e.querySelector("img"),c.selectComponent(e,"image")):r.hasClass(e,"se-video-container")&&c.selectComponent(e.querySelector("iframe"),"video"));break}}if(m=r.getFormatElement(u.startContainer),f=r.getRangeFormatElement(m),r.isListCell(m)&&r.isList(f)&&(o===m||3===o.nodeType&&(!o.nextSibling||r.isList(o.nextSibling))&&(r.getFormatElement(u.startContainer)!==r.getFormatElement(u.endContainer)?f.contains(u.endContainer):u.endOffset===o.textContent.length&&u.collapsed))){u.startContainer!==u.endContainer&&c.removeNode();let e=r.getArrayItem(m.children,r.isList,!1);if(e=e||m.nextElementSibling||f.parentNode.nextElementSibling,e&&(r.isList(e)||r.getArrayItem(e.children,r.isList,!1))){let i,n;if(t.preventDefault(),r.isList(e)){const t=e.firstElementChild;for(n=t.childNodes,i=n[0];n[0];)m.insertBefore(n[0],e);r.removeItem(t)}else{for(i=e.firstChild,n=e.childNodes;n[0];)m.appendChild(n[0]);r.removeItem(e)}c.setRange(i,0,i,0),c.history.push(!0)}break}break;case 9:if(t.preventDefault(),l||s||r.isWysiwygDiv(o))break;c.controllersOff();const g=!u.collapsed||c.isEdgePoint(u.startContainer,u.startOffset),_=c.getSelectedElements(),b=[];let y=[],v=r.isListCell(_[0]),x=r.isListCell(_[_.length-1]),C={sc:null,so:null,ec:null,eo:null};for(let e,t=0,i=_.length;t<i;t++)if(e=_[t],r.isListCell(e)){if(!e.previousElementSibling&&!n)continue;b.push(e)}else y.push(e);if(b.length>0&&g&&c.plugins.list){const e=c.plugins.list.editInsideList.call(c,n,b);v&&(C.sc=e.sc,C.so=e.so),x&&(C.ec=e.ec,C.eo=e.eo)}else{const e=r.getParentElement(o,r.isCell);if(e&&g){const t=r.getParentElement(e,"table"),i=r.getListChildren(t,r.isCell);let l=n?r.prevIdx(i,e):r.nextIdx(i,e);l!==i.length||n||(l=0),-1===l&&n&&(l=i.length-1);const s=i[l];if(!s)return!1;c.setRange(s,0,s,0);break}y=y.concat(b),v=x=null}if(y.length>0)if(n){const e=y.length-1;for(let t,i=0;i<=e;i++)t=y[i].firstChild,t&&(/^\s{1,4}$/.test(t.textContent)?r.removeItem(t):/^\s{1,4}/.test(t.textContent)&&(t.textContent=t.textContent.replace(/^\s{1,4}/,"")));const t=r.getChildElement(y[0],"text",!1),i=r.getChildElement(y[e],"text",!0);!v&&t&&(C.sc=t,C.so=0),!x&&i&&(C.ec=i,C.eo=i.textContent.length)}else{const e=r.createTextNode(new a.Array(c._variable.tabSize+1).join(""));if(1===y.length){const t=c.insertNode(e);v||(C.sc=e,C.so=t.endOffset),x||(C.ec=e,C.eo=t.endOffset)}else{const t=y.length-1;for(let i,n=0;n<=t;n++)i=y[n].firstChild,i&&(r.isBreak(i)?y[n].insertBefore(e.cloneNode(!1),i):i.textContent=e.textContent+i.textContent);const i=r.getChildElement(y[0],"text",!1),n=r.getChildElement(y[t],"text",!0);!v&&i&&(C.sc=i,C.so=0),!x&&n&&(C.ec=n,C.eo=n.textContent.length)}}c.setRange(C.sc,C.so,C.ec,C.eo),c.history.push(!1);break;case 13:const w=r.getFreeFormatElement(o);if(!n&&w){t.preventDefault();const e=o===w,i=c.getSelection(),n=o.childNodes,l=i.focusOffset,s=o.previousElementSibling,a=o.nextSibling;if(e&&u.collapsed&&n.length-1<=l+1&&r.isBreak(n[l])&&(!n[l+1]||(!n[l+2]||r.onlyZeroWidthSpace(n[l+2].textContent))&&3===n[l+1].nodeType&&r.onlyZeroWidthSpace(n[l+1].textContent))&&l>0&&r.isBreak(n[l-1])||!e&&r.onlyZeroWidthSpace(o.textContent)&&r.isBreak(s)&&(r.isBreak(s.previousSibling)||!r.onlyZeroWidthSpace(s.previousSibling.textContent))&&(!a||!r.isBreak(a)&&r.onlyZeroWidthSpace(a.textContent))){e?r.removeItem(n[l-1]):r.removeItem(o);const t=c.appendFormatTag(w,r.isFormatElement(w.nextElementSibling)?w.nextElementSibling:null);r.copyFormatAttributes(t,w),c.setRange(t,1,t,1);break}if(e){c.execCommand("insertHTML",!1,"<BR><BR>");let e=i.focusNode;const t=i.focusOffset;e=w===e?e.childNodes[t-l>1?t-1:t]:e.previousSibling,c.setRange(e,1,e,1)}else{const e=i.focusNode.nextSibling,t=r.createElement("BR");c.insertNode(t);const n=t.previousSibling,l=t.nextSibling;r.isBreak(e)||r.isBreak(n)||l&&!r.onlyZeroWidthSpace(l)?c.setRange(l,0,l,0):(t.parentNode.insertBefore(t.cloneNode(!1),t),c.setRange(t,1,t,1))}d._onShortcutKey=!0;break}if(h)break;if(f&&m&&!r.isCell(f)&&!/^FIGCAPTION$/i.test(f.nodeName)){const e=c.getRange();if((3!==e.commonAncestorContainer.nodeType||!e.commonAncestorContainer.nextElementSibling)&&r.onlyZeroWidthSpace(m.innerText.trim())){t.preventDefault();let e=null;if(r.isListCell(f.parentNode)){f=m.parentNode.parentNode.parentNode;const t=r.splitElement(m,null,r.getElementDepth(m)-2);e=r.createElement("LI"),f.insertBefore(e,t)}else{const t=r.isCell(f.parentNode)?"DIV":r.isList(f.parentNode)?"LI":r.isFormatElement(f.nextElementSibling)?f.nextElementSibling.nodeName:r.isFormatElement(f.previousElementSibling)?f.previousElementSibling.nodeName:"P";e=r.createElement(t);const i=c.detachRangeFormatElement(f,[m],null,!0,!0);i.cc.insertBefore(e,i.ec)}e.innerHTML="<br>",r.copyFormatAttributes(e,m),r.removeItemAllParents(m,null),c.setRange(e,1,e,1);break}}if(f&&r.getParentElement(f,"FIGCAPTION")&&r.getParentElement(f,r.isList)&&(t.preventDefault(),m=c.appendFormatTag(m,null),c.setRange(m,0,m,0)),p){t.preventDefault(),t.stopPropagation();const i=e[p],n=i._container,l=n.previousElementSibling||n.nextElementSibling;let s=null;r.isListCell(n.parentNode)?s=r.createElement("BR"):(s=r.createElement(r.isFormatElement(l)?l.nodeName:"P"),s.innerHTML="<br>"),n.parentNode.insertBefore(s,n),c.callPlugin(p,(function(){const e=c.plugins.resizing.call_controller_resize.call(c,i._element,p);c.plugins[p].onModifyMode.call(c,i._element,e)}))}}if(n&&/16/.test(i)){t.preventDefault(),t.stopPropagation();const e=c.plugins.table;if(e&&!e._shift&&!e._ref){const t=r.getParentElement(m,r.isCell);if(t)return void e.onTableCellMultiSelect.call(c,t,!0)}}const _=!(l||s||h||d._nonTextKeyCode.test(i));if(!c._charCount(1,_)&&_)return t.preventDefault(),t.stopPropagation(),!1;g.onKeyDown&&g.onKeyDown(t,c)},onKeyUp_wysiwyg:function(e){if(d._onShortcutKey)return;c._editorRange();const t=c.getRange(),i=e.keyCode,n=e.ctrlKey||e.metaKey||91===i||92===i,l=e.altKey;let s=c.getSelectionNode();if(c._isBalloon&&(c._isBalloonAlways&&27!==i||!t.collapsed)){if(!c._isBalloonAlways)return void d._showToolbarBalloon();d._showToolbarBalloonDelay()}if(8===i&&r.isWysiwygDiv(s)&&""===s.textContent){e.preventDefault(),e.stopPropagation(),s.innerHTML="";const t=r.createElement(r.isFormatElement(c._variable.currentNodes[0])?c._variable.currentNodes[0]:"P");return t.innerHTML="<br>",s.appendChild(t),c.setRange(t,0,t,0),d._applyTagEffects(),c._checkComponents(),void c.history.push(!1)}const o=r.getFormatElement(s),a=r.getRangeFormatElement(s);(!o&&t.collapsed||o===a)&&(c.execCommand("formatBlock",!1,r.isRangeFormatElement(a)?"DIV":"P"),c.focus(),s=c.getSelectionNode()),d._directionKeyCode.test(i)&&d._applyTagEffects(),c._checkComponents();const u=!n&&!l&&!d._nonTextKeyCode.test(i);if(u&&3===s.nodeType&&r.zeroWidthRegExp.test(s.textContent)){let e=t.startOffset,i=t.endOffset;const n=(s.textContent.substring(0,i).match(d._frontZeroWidthReg)||"").length;e=t.startOffset-n,i=t.endOffset-n,s.textContent=s.textContent.replace(r.zeroWidthRegExp,""),c.setRange(s,e<0?0:e,s,i<0?0:i)}if(!c._charCount(1,u)&&1===e.key.length)return e.preventDefault(),e.stopPropagation(),!1;!n&&!l&&!d._historyIgnoreKeyCode.test(i)&&c.history.push(!0),g.onKeyUp&&g.onKeyUp(e,c)},onScroll_wysiwyg:function(e){c.controllersOff(),c._isBalloon&&d._hideToolbar(),g.onScroll&&g.onScroll(e,c)},onFocus_wysiwyg:function(e){c.hasFocus=!0,c._isInline&&d._showToolbarInline(),g.onFocus&&g.onFocus(e,c)},onBlur_wysiwyg:function(e){c.hasFocus=!1,(c._isInline||c._isBalloon)&&d._hideToolbar(),g.onBlur&&g.onBlur(e,c)},onMouseDown_resizingBar:function(t){t.stopPropagation(),c._variable.resizeClientY=t.clientY,e.element.resizeBackground.style.display="block",s.addEventListener("mousemove",d._resize_editor),s.addEventListener("mouseup",(function t(){e.element.resizeBackground.style.display="none",s.removeEventListener("mousemove",d._resize_editor),s.removeEventListener("mouseup",t)}))},_resize_editor:function(t){const i=e.element.editorArea.offsetHeight+(t.clientY-c._variable.resizeClientY);e.element.wysiwygFrame.style.height=e.element.code.style.height=(i<c._variable.minResizingSize?c._variable.minResizingSize:i)+"px",c._variable.resizeClientY=t.clientY},onResize_window:function(){if(c.controllersOff(),0!==e.element.toolbar.offsetWidth)return c._variable.isFullScreen?(c._variable.innerHeight_fullScreen+=a.innerHeight-e.element.toolbar.offsetHeight-c._variable.innerHeight_fullScreen,void(e.element.editorArea.style.height=c._variable.innerHeight_fullScreen+"px")):void(c._variable.isCodeView&&c._isInline?d._showToolbarInline():(c._iframeAutoHeight(),c._sticky&&(e.element.toolbar.style.width=e.element.topArea.offsetWidth-2+"px",d.onScroll_window())))},onScroll_window:function(){if(c._variable.isFullScreen||0===e.element.toolbar.offsetWidth||l.stickyToolbar<0)return;const t=e.element,i=t.editorArea.offsetHeight,n=(this.scrollY||s.documentElement.scrollTop)+l.stickyToolbar,o=d._getStickyOffsetTop()-(c._isInline?t.toolbar.offsetHeight:0);n<o?d._offStickyToolbar():n+c._variable.minResizingSize>=i+o?(c._sticky||d._onStickyToolbar(),t.toolbar.style.top=i+o+l.stickyToolbar-n-c._variable.minResizingSize+"px"):n>=o&&d._onStickyToolbar()},_getStickyOffsetTop:function(){let t=e.element.topArea,i=0;for(;t;)i+=t.offsetTop,t=t.offsetParent;return i},_onStickyToolbar:function(){const t=e.element;c._isInline||(t._stickyDummy.style.height=t.toolbar.offsetHeight+"px",t._stickyDummy.style.display="block"),t.toolbar.style.top=l.stickyToolbar+"px",t.toolbar.style.width=c._isInline?c._inlineToolbarAttr.width:t.toolbar.offsetWidth+"px",r.addClass(t.toolbar,"se-toolbar-sticky"),c._sticky=!0},_offStickyToolbar:function(){const t=e.element;t._stickyDummy.style.display="none",t.toolbar.style.top=c._isInline?c._inlineToolbarAttr.top:"",t.toolbar.style.width=c._isInline?c._inlineToolbarAttr.width:"",t.editorArea.style.marginTop="",r.removeClass(t.toolbar,"se-toolbar-sticky"),c._sticky=!1},_codeViewAutoHeight:function(){e.element.code.style.height=e.element.code.scrollHeight+"px"},onPaste_wysiwyg:function(e){const t=e.clipboardData;if(!t)return!0;const i=c._charCount(t.getData("text/plain").length,!0),n=c.cleanHTML(t.getData("text/html"),c.pasteTagsWhitelistRegExp);return("function"!=typeof g.onPaste||g.onPaste(e,n,i,c))&&i?void(n?(e.stopPropagation(),e.preventDefault(),c.execCommand("insertHTML",!1,n)):c.history.push(!0)):(e.preventDefault(),e.stopPropagation(),!1)},onCut_wysiwyg:function(){a.setTimeout((function(){c._resourcesStateChange(),c._charCount(0,!1),c.history.push(!1)}))},onDragOver_wysiwyg:function(e){e.preventDefault()},onDrop_wysiwyg:function(t){const i=t.dataTransfer;if(!i)return!0;const n=i.files;if(n.length>0&&c.plugins.image)d._setDropLocationSelection(t),c.callPlugin("image",(function(){e.image.imgInputFile.files=n,c.plugins.image.onRender_imgInput.call(c),e.image.imgInputFile.files=null}));else{if(!c._charCount(i.getData("text/plain").length,!0))return t.preventDefault(),t.stopPropagation(),!1;{const e=c.cleanHTML(i.getData("text/html"),c.pasteTagsWhitelistRegExp);e&&(d._setDropLocationSelection(t),c.execCommand("insertHTML",!1,e))}}g.onDrop&&g.onDrop(t,c)},_setDropLocationSelection:function(e){e.stopPropagation(),e.preventDefault();const t=c.getRange();c.setRange(t.startContainer,t.startOffset,t.endContainer,t.endOffset)},_onChange_historyStack:function(){d._applyTagEffects(),e.tool.save&&e.tool.save.removeAttribute("disabled"),g.onChange&&g.onChange(c.getContents(!0),c)},_addEvent:function(){const t=l.iframe?c._ww:e.element.wysiwyg;e.element.toolbar.addEventListener("mousedown",d.onMouseDown_toolbar,!1),e.element.toolbar.addEventListener("click",d.onClick_toolbar,!1),t.addEventListener("mousedown",d.onMouseDown_wysiwyg,!1),t.addEventListener("click",d.onClick_wysiwyg,!1),t.addEventListener("keydown",d.onKeyDown_wysiwyg,!1),t.addEventListener("keyup",d.onKeyUp_wysiwyg,!1),t.addEventListener("paste",d.onPaste_wysiwyg,!1),t.addEventListener("cut",d.onCut_wysiwyg,!1),t.addEventListener("dragover",d.onDragOver_wysiwyg,!1),t.addEventListener("drop",d.onDrop_wysiwyg,!1),t.addEventListener("scroll",d.onScroll_wysiwyg,!1),t.addEventListener("focus",d.onFocus_wysiwyg,!1),t.addEventListener("blur",d.onBlur_wysiwyg,!1),c.plugins.table&&t.addEventListener("touchstart",d.onMouseDown_wysiwyg,{passive:!0,useCapture:!1}),"auto"!==l.height||l.codeMirrorEditor||(e.element.code.addEventListener("keydown",d._codeViewAutoHeight,!1),e.element.code.addEventListener("keyup",d._codeViewAutoHeight,!1),e.element.code.addEventListener("paste",d._codeViewAutoHeight,!1)),e.element.resizingBar&&(/\d+/.test(l.height)?e.element.resizingBar.addEventListener("mousedown",d.onMouseDown_resizingBar,!1):r.addClass(e.element.resizingBar,"se-resizing-none")),a.removeEventListener("resize",d.onResize_window),a.removeEventListener("scroll",d.onScroll_window),a.addEventListener("resize",d.onResize_window,!1),l.stickyToolbar>-1&&a.addEventListener("scroll",d.onScroll_window,!1)},_removeEvent:function(){const t=l.iframe?c._ww:e.element.wysiwyg;e.element.toolbar.removeEventListener("mousedown",d.onMouseDown_toolbar),e.element.toolbar.removeEventListener("click",d.onClick_toolbar),t.removeEventListener("click",d.onClick_wysiwyg),t.removeEventListener("keydown",d.onKeyDown_wysiwyg),t.removeEventListener("keyup",d.onKeyUp_wysiwyg),t.removeEventListener("paste",d.onPaste_wysiwyg),t.removeEventListener("cut",d.onCut_wysiwyg),t.removeEventListener("dragover",d.onDragOver_wysiwyg),t.removeEventListener("drop",d.onDrop_wysiwyg),t.removeEventListener("scroll",d.onScroll_wysiwyg),t.removeEventListener("mousedown",d.onMouseDown_wysiwyg),t.removeEventListener("touchstart",d.onMouseDown_wysiwyg,{passive:!0,useCapture:!1}),t.removeEventListener("focus",d.onFocus_wysiwyg),t.removeEventListener("blur",d.onBlur_wysiwyg),e.element.code.removeEventListener("keydown",d._codeViewAutoHeight),e.element.code.removeEventListener("keyup",d._codeViewAutoHeight),e.element.code.removeEventListener("paste",d._codeViewAutoHeight),e.element.resizingBar&&e.element.resizingBar.removeEventListener("mousedown",d.onMouseDown_resizingBar),a.removeEventListener("resize",d.onResize_window),a.removeEventListener("scroll",d.onScroll_window)}},g={core:c,util:r,onload:null,onScroll:null,onMouseDown:null,onClick:null,onKeyDown:null,onKeyUp:null,onDrop:null,onChange:null,onPaste:null,onFocus:null,onBlur:null,showInline:null,imageUploadHandler:null,onImageUploadBefore:null,onImageUpload:null,onImageUploadError:null,setOptions:function(s){d._removeEvent(),c.plugins=s.plugins||c.plugins;const o=[s,s].reduce((function(e,t){for(let i in t)if("plugins"===i&&t[i]&&e[i]){let n=e[i],l=t[i];n=n.length?n:a.Object.keys(n).map((function(e){return n[e]})),l=l.length?l:a.Object.keys(l).map((function(e){return l[e]})),e[i]=l.filter((function(e){return-1===n.indexOf(e)})).concat(n)}else e[i]=t[i];return e}),{}),r=h._setOptions(o,e,c.plugins,s);r.callButtons&&(t=r.callButtons,c.initPlugins={}),r.plugins&&(c.plugins=i=r.plugins);const u=e.element.wysiwyg.innerHTML,g=e.element,m={_top:g.topArea,_relative:g.relative,_toolBar:g.toolbar,_editorArea:g.editorArea,_wysiwygArea:g.wysiwygFrame,_codeArea:g.code,_placeholder:g.placeholder,_resizingBar:g.resizingBar,_navigation:g.navigation,_charCounter:g.charCounter,_loading:g.loading,_resizeBack:g.resizeBackground,_stickyDummy:g._stickyDummy,_arrow:g._arrow};l=o,c.lang=n=l.lang,c.context=e=p(e.element.originElement,m,l),c._imagesInfoReset=!0,c._init(!0,u),d._addEvent(),c._charCount(0,!1),d._offStickyToolbar(),d.onResize_window(),c.focus()},noticeOpen:function(e){c.addModule([o]),o.open.call(c,e)},noticeClose:function(){c.addModule([o]),o.close.call(c)},save:function(){e.element.originElement.value=c.getContents(!1)},getContext:function(){return e},getContents:function(e){return c.getContents(e)},getImagesInfo:function(){return c._variable._imagesInfo},insertImage:function(e){c.plugins.image&&e&&(c.initPlugins.image?c.plugins.image.submitAction.call(c,e):c.callPlugin("image",c.plugins.image.submitAction.bind(c,e)),c.focus())},insertHTML:function(e){if(!e.nodeType||1!==e.nodeType){const t=r.createElement("DIV");t.innerHTML=e,e=t.firstChild||t.content.firstChild}let t=null;(r.isFormatElement(e)||/^(IMG|IFRAME)$/i.test(e.nodeName))&&(t=r.getFormatElement(c.getSelectionNode())),r.isComponent(e)?c.insertComponent(e,!1):c.insertNode(e,t),c.focus()},setContents:function(e){c.setContents(e)},appendContents:function(t){const i=c.convertContentsForEditor(t);if(c._variable.isCodeView)c._setCodeView(c._getCodeView()+"\n"+c.convertHTMLForCodeView(i));else{const t=r.createElement("DIV");t.innerHTML=i;const n=e.element.wysiwyg,l=t.children;for(let e=0,t=l.length;e<t;e++)n.appendChild(l[e])}c.history.push(!1)},disabled:function(){e.tool.cover.style.display="block",e.element.wysiwyg.setAttribute("contenteditable",!1),l.codeMirrorEditor?l.codeMirrorEditor.setOption("readOnly",!0):e.element.code.setAttribute("disabled","disabled")},enabled:function(){e.tool.cover.style.display="none",e.element.wysiwyg.setAttribute("contenteditable",!0),l.codeMirrorEditor?l.codeMirrorEditor.setOption("readOnly",!1):e.element.code.removeAttribute("disabled")},show:function(){const t=e.element.topArea.style;"none"===t.display&&(t.display=l.display)},hide:function(){e.element.topArea.style.display="none"},destroy:function(){c.history._destroy(),d._removeEvent(),r.removeItem(e.element.topArea),a.Object.keys(c).forEach((function(e){delete c[e]})),a.Object.keys(d).forEach((function(e){delete d[e]})),a.Object.keys(e).forEach((function(t){delete e[t]})),a.Object.keys(t).forEach((function(e){delete t[e]})),a.Object.keys(this).forEach(function(e){delete this[e]}.bind(this))},toolbar:{disabled:function(){e.tool.cover.style.display="block"},enabled:function(){e.tool.cover.style.display="none"},show:function(){c._isInline?d._showToolbarInline():(e.element.toolbar.style.display="",e.element._stickyDummy.style.display="")},hide:function(){c._isInline?d._hideToolbar():(e.element.toolbar.style.display="none",e.element._stickyDummy.style.display="none")}}};return c._init(!1,null),d._addEvent(),c._charCount(0,!1),c.functions=g,g},m={init:function(e){return{create:function(t,i){return this.create(t,i,e)}.bind(this)}},create:function(e,t,i){"object"!=typeof t&&(t={}),i&&(t=[i,t].reduce((function(e,t){for(let i in t)if("plugins"===i&&t[i]&&e[i]){let n=e[i],l=t[i];n=n.length?n:Object.keys(n).map((function(e){return n[e]})),l=l.length?l:Object.keys(l).map((function(e){return l[e]})),e[i]=l.filter((function(e){return-1===n.indexOf(e)})).concat(n)}else e[i]=t[i];return e}),{}));const n="string"==typeof e?document.getElementById(e):e;if(!n){if("string"==typeof e)throw Error('[SUNEDITOR.create.fail] The element for that id was not found (ID:"'+e+'")');throw Error("[SUNEDITOR.create.fail] suneditor requires textarea's element or id value")}const l=h.init(n,t);if(l.constructed._top.id&&document.getElementById(l.constructed._top.id))throw Error('[SUNEDITOR.create.fail] The ID of the suneditor you are trying to create already exists (ID:"'+l.constructed._top.id+'")');return n.style.display="none",l.constructed._top.style.display="block","object"==typeof n.nextElementSibling?n.parentNode.insertBefore(l.constructed._top,n.nextElementSibling):n.parentNode.appendChild(l.constructed._top),g(p(n,l.constructed,l.options),l.pluginCallButtons,l.plugins,l.options.lang,t)}};window.SUNEDITOR=m.init({plugins:a})}});